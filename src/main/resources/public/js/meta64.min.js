console.log("running module: attachment.js");
var attachment=function(){function d(c){util.checkSuccess("Delete attachment",c)&&(view.refreshTree(null,!1),a.closeUploadPg())}function b(c){util.checkSuccess("Upload from URL",c)&&(view.refreshTree(null,!1),a.closeUploadPg())}var a={uploadNode:null,deleteAttachment:function(){confirmPg.areYouSure("Confirm Delete Attachment","Delete the Attachment on the Node?","Yes, delete.",function(){util.json("deleteAttachment",{nodeId:a.uploadNode.id},d)})},uploadFileNow:function(){var c=$("#uploadFromUrl").val();
c?util.json("uploadFromUrl",{nodeId:a.uploadNode.id,sourceUrl:c},b):($("#uploadFormNodeId").attr("value",a.uploadNode.id),c=$.ajax({url:postTargetUrl+"upload",type:"POST",data:new FormData($("#uploadForm")[0]),enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1}),c.done(function(){view.refreshTree(null,!1);a.closeUploadPg()}),c.fail(function(){alert("Upload failed.")}))},openUploadPg:function(){var c=meta64.getHighlightedNode();c?(a.uploadNode=c,meta64.changePage(uploadPg)):(a.uploadNode=
null,alert("No node is selected."))},closeUploadPg:function(){meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()}};console.log("Module ready: attachment.js");return a}();console.log("running module: cnst.js");var cnst=function(){var d={ANON:"anonymous",COOKIE_LOGIN_USR:cookiePrefix+"loginUsr",COOKIE_LOGIN_PWD:cookiePrefix+"loginPwd",BR:"<div class='vert-space'></div>",INSERT_ATTACHMENT:"{{insert-attachment}}",NEW_ON_TOOLBAR:!1,INS_ON_TOOLBAR:!1};console.log("Module ready: cnst.js");return d}();console.log("running module: edit.js");
var edit=function(){var d,b,a=function(a){util.checkSuccess("Save node",a);view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},c=function(a){util.checkSuccess("Rename node",a);view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},e=function(a){util.checkSuccess("Export",a)&&(alert("Export Successful."),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},h=function(a){util.checkSuccess("Import",a)&&(alert("Import Successful."),
view.refreshTree(null,!1),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},f=function(a){console.log("insertBookResponse running.");util.checkSuccess("Insert Book",a);view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},g=function(a){util.checkSuccess("Delete node",a)&&(meta64.clearSelectedNodes(),view.refreshTree(null,!1))},k=function(a){util.checkSuccess("Move nodes",a);l.nodesToMove=null;view.refreshTree(null,!1)},m=function(a){util.checkSuccess("Change node position",
a);view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},n=function(a){util.checkSuccess("Insert node",a);meta64.newChildNodeId=a.newNode.id;meta64.initNode(a.newNode);meta64.highlightNode(a.newNode,!0);edit.runEditNode(a.newNode.uid)},p=function(a){util.checkSuccess("Make node referencable",a)&&alert("This node is now referencable, and can be accessed by unique ID")},q=function(a){util.checkSuccess("Create subnode",a);meta64.newChildNodeId=a.newNode.id;console.log("new child identifier: "+
meta64.newChildNodeId);meta64.initNode(a.newNode);edit.runEditNode(a.newNode.uid)},l={nodesToMove:null,editingUnsavedNode:!1,editNode:null,nodeInsertTarget:null,startEditingNewNode:function(){l.editingUnsavedNode=!1;l.editNode=null;l.saveNewNode("")},startEditingNewNodeWithName:function(){l.editingUnsavedNode=!0;l.editNode=null;meta64.changePage(editNodePg)},editMode:function(){meta64.editMode=meta64.editMode?!1:!0;var a=$("#editModeButton");a.toggleClass("ui-icon-edit",meta64.editMode);a.toggleClass("ui-icon-forbidden",
!meta64.editMode);render.renderPageFromData();view.scrollToSelectedNode()},makeNodeReferencable:function(){util.json("makeNodeReferencable",{nodeId:l.editNode.id},p)},cancelEdit:function(){meta64.treeDirty&&view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},saveNode:function(){l.editingUnsavedNode?l.saveNewNode():l.saveExistingNode()},saveNewNode:function(a){a||(a=util.getRequiredElement("#newNodeNameId").val());meta64.userName!=d.createdBy&&"admin"!=d.createdBy&&
(b=!0);meta64.treeDirty=!0;l.nodeInsertTarget?util.json("insertNode",{parentId:d.id,targetName:l.nodeInsertTarget.name,newNodeName:a},n):util.json("createSubNode",{nodeId:d.id,newNodeName:a},q)},saveExistingNode:function(){for(var c=[],e=0,d=0;;){var g="editNodeTextContent"+e;if(meta64.fieldIdToPropMap.hasOwnProperty(g)){var h=meta64.fieldIdToPropMap[g],g=$("#"+g).val();g!==h.value&&(c.push({name:h.name,value:g}),d++)}else break;e++}0<d?(util.json("saveNode",{nodeId:l.editNode.id,properties:c,sendNotification:b},
a),b=!1):alert("You didn't change any information!")},moveNodeUp:function(a){var c=meta64.uidToNodeMap[a];c?(a=meta64.getOrdinalOfNode(c),console.log("ordinal="+a),-1==a&&0>=a||util.json("setNodePosition",{parentNodeId:meta64.currentNodeId,nodeId:c.name,siblingId:meta64.currentNodeData.children[a-1].name},m)):console.log("idToNodeMap does not contain "+a)},moveNodeDown:function(a){var c=meta64.uidToNodeMap[a];c?(a=meta64.getOrdinalOfNode(c),console.log("ordinal="+a),-1==a&&a>=meta64.currentNodeData.children.length-
1||util.json("setNodePosition",{parentNodeId:meta64.currentNodeData.node.id,nodeId:meta64.currentNodeData.children[a+1].name,siblingId:c.name},m)):console.log("idToNodeMap does not contain "+a)},openExportPg:function(){meta64.changePage(exportPg)},openRenameNodePg:function(){meta64.changePage(renameNodePg)},renameNode:function(){var a=$("#newNodeNameEditField").val();if(util.emptyString(a))alert("Please enter a new node name.");else{var b=meta64.getHighlightedNode();b?util.json("renameNode",{nodeId:b.id,
newName:a},c):alert("Select a node to rename.")}},exportNodes:function(){var a=meta64.getHighlightedNode(),c=util.getRequiredElement("#exportTargetNodeName").val();util.emptyString(c)?alert("Please enter a name for the export file."):a&&util.json("exportToXml",{nodeId:a.id,targetFileName:c},e)},openImportPg:function(){meta64.changePage(importPg)},importNodes:function(){var a=meta64.getHighlightedNode(),c=util.getRequiredElement("#importTargetNodeName").val();util.emptyString(c)?alert("Please enter a name for the import file."):
a&&util.json("import",{nodeId:a.id,sourceFileName:c},h)},runEditNode:function(a){var c=meta64.uidToNodeMap[a];c?(l.editingUnsavedNode=!1,l.editNode=c,meta64.changePage(editNodePg)):(l.editNode=null,alert("Unknown nodeId in editNodeClick: "+a))},populateEditNodePg:function(){view.initEditPathDisplayById("#editNodePathDisplay");var a="",c=0;meta64.fieldIdToPropMap={};if(l.editNode)$.each(l.editNode.properties,function(b,e){if(render.allowPropertyToDisplay(e.name)){var g="editNodeTextContent"+c;meta64.fieldIdToPropMap[g]=
e;var d=e.values&&0<e.values.length,h=render.isReadOnlyProperty(e.name),f=render.isBinaryProperty(e.name);if(h||f)g="RdOnly_"+g;var k="";if(!h&&!f){var k=render.makeTag("a",{onClick:"props.clearProperty('"+g+"');","class":"ui-btn ui-btn-inline ui-icon-back ui-btn-icon-left"},"Clear"),l="",m="";e.name!==jcrCnst.CONTENT&&(m=render.makeTag("a",{onClick:"props.deleteProperty('"+e.name+"');","class":"ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left"},"Del"),l=render.makeTag("a",{onClick:"props.addSubProperty('"+
g+"');","class":"ui-btn ui-btn-inline ui-icon-star ui-btn-icon-left"},"Add Multi"));k=l+k+m;k=0<k.length?render.makeHorizontalFieldSet(k):""}d?(console.log("Property multi-type: name="+e.name+" count="+e.values.length),k+=props.makeMultiPropEditor(g,e,h,f)):(console.log("Property single-type: "+e.name),k+=render.makeTag("label",{"for":g},render.sanitizePropertyName(e.name)),d=f?"[binary]":e.value,k=h||f?k+render.makeTag("textarea",{id:g,readonly:"readonly",disabled:"disabled"},d?d:""):k+render.makeTag("textarea",
{id:g},d?d:""));a+=render.makeTag("div",{"class":"ui-field-contain"},k);c++}else console.log("Hiding property: "+e.name)});else var b=render.makeTag("label",{"for":"newNodeNameId"},"New Node Name")+render.makeTag("textarea",{id:"newNodeNameId"},""),a=a+render.makeTag("div",{"class":"ui-field-contain"},b);util.setHtmlEnhanced($("#propertyEditFieldContainer"),a);b=l.editingUnsavedNode?"You may leave this field blank and a unique ID will be assigned. You only need to provide a name if you want this node to have a more meaningful URL.":
"";$("#editNodeInstructions").html(b);util.setVisibility("#addPropertyButton",!l.editingUnsavedNode);util.setVisibility("#makeNodeReferencableButton",!l.editingUnsavedNode)},insertNode:function(a){if(d=meta64.currentNode){var c=null;if(c=a?meta64.uidToNodeMap[a]:meta64.getHighlightedNode())l.nodeInsertTarget=c,l.startEditingNewNode()}else console.log("Unknown parent")},createSubNodeUnderHighlight:function(){(d=meta64.getHighlightedNode())?(l.nodeInsertTarget=null,l.startEditingNewNode()):alert("Tap a node to insert under.")},
createSubNode:function(a){if(a){if(d=meta64.uidToNodeMap[a],!d){console.log("Unknown nodeId in createSubNode: "+a);return}}else d=meta64.currentNode;l.nodeInsertTarget=null;l.startEditingNewNode()},deleteSelNodes:function(){var a=meta64.getSelectedNodeIdsArray();a&&0!=a.length?confirmPg.areYouSure("Confirm Delete","Delete "+a.length+" node(s) ?","Yes, delete.",function(){util.json("deleteNodes",{nodeIds:a},g)}):alert("You have not selected any nodes. Select nodes to delete first.")},moveSelNodes:function(){var a=
meta64.getSelectedNodeIdsArray();a&&0!=a.length?confirmPg.areYouSure("Confirm Move","Move "+a.length+" node(s) to a new location ?","Yes, move.",function(){l.nodesToMove=a;meta64.selectedNodes={};alert("Ok, ready to move nodes. To finish moving, go select the target location, then click 'Finish Moving'");meta64.refreshAllGuiEnablement()}):alert("You have not selected any nodes. Select nodes to delete first.")},finishMovingSelNodes:function(){confirmPg.areYouSure("Confirm Move","Move "+l.nodesToMove.length+
" node(s) to selected location ?","Yes, move.",function(){var a=meta64.getHighlightedNode();util.json("moveNodes",{targetNodeId:a.id,targetChildId:null!=a?a.id:null,nodeIds:l.nodesToMove},k)})},insertBookWarAndPeace:function(){confirmPg.areYouSure("Confirm","Insert book War and Peace?","Yes, insert book.",function(){var a=meta64.getHighlightedNode();a?util.json("insertBook",{nodeId:a.id,bookName:"War and Peace"},f):alert("No node is selected.")})}};console.log("Module ready: edit.js");return l}();console.log("running module: jcrCnst.js");
var jcrCnst=function(){console.log("Module ready: jcrCnst.js");return{PRIMARY_TYPE:"jcr:primaryType",POLICY:"rep:policy",MIXIN_TYPES:"jcr:mixinTypes",EMAIL_CONTENT:"jcr:content",EMAIL_RECIP:"recip",EMAIL_SUBJECT:"subject",CREATED:"jcr:created",CREATED_BY:"jcr:createdBy",CONTENT:"jcr:content",UUID:"jcr:uuid",LAST_MODIFIED:"jcr:lastModified",LAST_MODIFIED_BY:"jcr:lastModifiedBy",USER:"user",PWD:"pwd",EMAIL:"email",CODE:"code",BIN_VER:"binVer",BIN_DATA:"jcrData",BIN_MIME:"jcr:mimeType",IMG_WIDTH:"imgWidth",
IMG_HEIGHT:"imgHeight"}}();console.log("running module: meta64.js");
var meta64=function(){var d=!1,b={userName:"anonymous",deviceWidth:0,deviceHeight:0,homeNodeId:"",homeNodePath:"",isAdminUser:!1,isAnonUser:!0,anonUserLandingPageNode:null,treeDirty:!1,uidToNodeMap:{},idToNodeMap:{},nextUid:1,identToUidMap:{},parentUidToFocusNodeMap:{},editMode:!1,MODE_ADVANCED:"advanced",MODE_SIMPLE:"simple",editModeOption:"simple",showProperties:!1,simpleModeNodePrefixBlackList:{"rep:":!0},simpleModePropertyBlackList:{},readOnlyPropertyList:{},binaryPropertyList:{},fieldIdToPropMap:{},
selectedNodes:{},newChildNodeId:"",currentNodeData:null,currentNode:null,currentNodeUid:null,currentNodeId:null,currentNodePath:null,inSimpleMode:function(){return b.editModeOption===b.MODE_SIMPLE},jqueryChangePage:function(a){$.mobile.pageContainer.pagecontainer("change",a)},changePage:function(a){render.buildPage(a);$.mobile.pageContainer.pagecontainer("change","#"+a.domId)},popup:function(){render.buildPage(popupMenuPg);$("#"+popupMenuPg.domId).popup("open")},isNodeBlackListed:function(a){if(!b.inSimpleMode())return!1;
for(var c in b.simpleModeNodePrefixBlackList)if(b.simpleModeNodePrefixBlackList.hasOwnProperty(c)&&a.name.startsWith(c))return!0;return!1},getSelectedNodeUidsArray:function(){var a=[],c=0,e;for(e in b.selectedNodes)b.selectedNodes.hasOwnProperty(e)&&(a[c++]=e);return a},getSelectedNodeIdsArray:function(){var a=[],c=0,e;b.selectedNodes?console.log("selectedNode count: "+b.selectedNodes.length):console.log("no selected nodes.");for(e in b.selectedNodes)if(b.selectedNodes.hasOwnProperty(e)){var d=b.uidToNodeMap[e];
d?a[c++]=d.id:console.log("unable to find uidToNodeMap for uid="+e)}return a},getSelectedNodesArray:function(){var a=[],c=0,e;for(e in b.selectedNodes)b.selectedNodes.hasOwnProperty(e)&&(a[c++]=b.uidToNodeMap[e]);return a},clearSelectedNodes:function(){b.selectedNodes={}},updateNodeInfoResponse:function(a,c){var b="",d=!1;a.owners&&$.each(a.owners,function(a,c){0<b.length&&(b+=",");c===meta64.userName&&(d=!0);b+=c});if(0<b.length){c.owner=b;var f=$("#ownerDisplay"+c.uid);f.html(" (Manager: "+b+")");
d?util.changeOrAddClass(f,"created-by-other","created-by-me"):util.changeOrAddClass(f,"created-by-me","created-by-other")}},updateNodeInfo:function(a){util.json("getNodePrivileges",{nodeId:a.id,includeAcl:!1,includeOwners:!0}).done(function(c){b.updateNodeInfoResponse(c,a)})},getNodeFromId:function(a){return b.idToNodeMap[a]},getPathOfUid:function(a){var c=b.uidToNodeMap[a];return c?c.path:"[path error. invalid uid: "+a+"]"},addClickListeners:function(){$("#openLoginPgButton").on("click",user.openLoginPg);
$("#navHomeButton").on("click",nav.navHome);$("#navUpLevelButton").on("click",nav.navUpLevel);$("#deletePropertyButton").on("click",props.deleteProperty);$("#editModeButton").on("click",edit.editMode)},openDonatePg:function(){meta64.jqueryChangePage("#donatePg")},getHighlightedNode:function(){return b.parentUidToFocusNodeMap[b.currentNodeUid]},highlightRowById:function(a,c){var e=b.getNodeFromId(a);e?b.highlightNode(e,c):console.log("highlightRowById failed to find id: "+a)},highlightNode:function(a,
c){if(a){var e=!1,d=b.parentUidToFocusNodeMap[b.currentNodeUid];d&&(d.uid===a.uid?e=!0:(d=d.uid+"_row",d=$("#"+d),util.changeOrAddClass(d,"active-row","inactive-row")));e||(b.parentUidToFocusNodeMap[b.currentNodeUid]=a,d=a.uid+"_row",d=$("#"+d),util.changeOrAddClass(d,"inactive-row","active-row"));c&&view.scrollToSelectedNode()}},refreshAllGuiEnablement:function(){util.getPropertyCount(b.selectedNodes);var a=b.getHighlightedNode();util.setEnablement($("#navHomeButton"),b.currentNode&&!nav.displayingHome());
util.setEnablement($("#navUpLevelButton"),b.currentNode&&nav.parentVisibleToUser());var c=b.currentNode&&!b.isAnonUser;util.setEnablement($("#propsToggleButton"),c);util.setEnablement($("#deletePropertyButton"),!b.isAnonUser);c=b.currentNode&&!b.isAnonUser;util.setEnablement($("#editModeButton"),c);util.setEnablement($("#insNodeButton"),!b.isAnonUser&&null!=a);util.setEnablement($("#createNodeButton"),!b.isAnonUser&&null!=a);util.setVisibility("#menuButton",!b.isAnonUser);util.setVisibility("#openSignupPgButton",
b.isAnonUser);util.setVisibility("#mainMenuSearchButton",!b.isAnonUser&&null!=a);util.setVisibility("#mainMenuTimelineButton",!b.isAnonUser&&null!=a);util.setVisibility("#mainNavBar",!b.isAnonUser)},getSingleSelectedNode:function(){for(var a in b.selectedNodes)if(b.selectedNodes.hasOwnProperty(a))return b.uidToNodeMap[a];return null},getOrdinalOfNode:function(a){if(!b.currentNodeData||!b.currentNodeData.children)return-1;for(var c=0;c<b.currentNodeData.children.length;c++)if(a.id===b.currentNodeData.children[c].id)return c;
return-1},setCurrentNodeData:function(a){b.currentNodeData=a;b.currentNode=a.node;b.currentNodeUid=a.node.uid;b.currentNodeId=a.node.id;b.currentNodePath=a.node.path},anonPageLoadResponse:function(a){a.renderNodeResponse?(util.setVisibility("#mainNodeContent",!0),util.setVisibility("#mainNodeStatusBar",!0),render.renderPageFromData(a.renderNodeResponse),b.refreshAllGuiEnablement()):(util.setVisibility("#mainNodeContent",!1),util.setVisibility("#mainNodeStatusBar",!1),console.log("setting listview to: "+
a.content),util.setHtmlEnhanced($("#listView"),a.content));render.renderMainPageControls()},initNode:function(a){a?(a.uid=util.getUidForId(b.identToUidMap,a.id),a.properties=props.setPreferredPropertyOrder(a.properties),b.uidToNodeMap[a.uid]=a,b.idToNodeMap[a.id]=a):console.log("initNode has null node")},initConstants:function(){util.addAll(b.simpleModePropertyBlackList,[jcrCnst.PRIMARY_TYPE,jcrCnst.POLICY]);util.addAll(b.readOnlyPropertyList,[jcrCnst.UUID,jcrCnst.MIXIN_TYPES,jcrCnst.CREATED,jcrCnst.CREATED_BY,
jcrCnst.LAST_MODIFIED,jcrCnst.LAST_MODIFIED_BY,jcrCnst.IMG_WIDTH,jcrCnst.IMG_HEIGHT,jcrCnst.BIN_VER,jcrCnst.BIN_DATA,jcrCnst.BIN_MIME]);util.addAll(b.binaryPropertyList,[jcrCnst.BIN_DATA])},initApp:function(){d||(console.log("initApp running."),d=!0,b.initConstants(),b.displaySignupMessage(),$(window).on("orientationchange",b.orientationHandler),$(window).bind("beforeunload",function(){return"Leave Meta64 ?"}),b.addClickListeners(),b.deviceWidth=$(window).width(),b.deviceHeight=$(window).height(),
user.refreshLogin(),setInterval(function(){var a=$(window).width();a!=b.deviceWidth&&(console.log("Screen width changed: "+a),b.deviceWidth=a,b.deviceHeight=$(window).height(),b.screenSizeChange())},1500),b.refreshAllGuiEnablement())},displaySignupMessage:function(){"ok"===$("#signupCodeResponse").text()&&alert("Signup complete. You may now login.")},screenSizeChange:function(){b.currentNodeData&&(meta64.currentNode.imgId&&render.adjustImageSize(meta64.currentNode),$.each(b.currentNodeData.children,
function(a,c){c.imgId&&render.adjustImageSize(c)}))},orientationHandler:function(a){},loadAnonPageHome:function(a){util.json("anonPageLoad",{ignoreUrl:a},b.anonPageLoadResponse)}};console.log("Module ready: meta64.js");return b}();console.log("running module: nav.js");
var nav=function(){var d={displayingHome:function(){return meta64.isAnonUser?meta64.currentNodeId===meta64.anonUserLandingPageNode:meta64.currentNodeId===meta64.homeNodeId},parentVisibleToUser:function(){return!d.displayingHome()},showSearchPage:function(){meta64.changePage(searchResultsPg)},upLevelResponse:function(b,a){b&&b.node?(render.renderPageFromData(b),meta64.highlightRowById(a,!0),meta64.refreshAllGuiEnablement()):(alert("No data is visible to you above this node."),util.setEnablementByName("navUpLevel",
!1))},navUpLevel:function(){d.parentVisibleToUser()&&util.json("renderNode",{nodeId:meta64.currentNodeId,upLevel:1}).done(function(b){d.upLevelResponse(b,meta64.currentNodeId)})},getSelectedDomElement:function(){var b=meta64.getHighlightedNode();return b&&(b=meta64.uidToNodeMap[b.uid])?util.domElm(b.uid+"_row"):null},clickOnNodeRow:function(b,a){var c=meta64.uidToNodeMap[a];c?(meta64.highlightNode(c,!1),meta64.editMode&&!c.owner&&(console.log("calling updateNodeInfo"),meta64.updateNodeInfo(c)),meta64.refreshAllGuiEnablement()):
console.log("clickOnNodeRow recieved uid that doesn't map to any node. uid="+a)},openNode:function(b){var a=meta64.uidToNodeMap[b];meta64.highlightNode(a,!0);a?view.refreshTree(a.id,!1):alert("Unknown nodeId in openNode: "+b)},toggleNodeSel:function(b){if(util.getRequiredElement()){var a=$("#"+b+"_sel"),c=a.attr("class"),e=c.contains("ui-btn-b");e?(util.changeOrAddClass(a,"ui-btn-b","ui-btn-a"),e=!1):(util.changeOrAddClass(a,"ui-btn-a","ui-btn-b"),e=!0);console.log("Classes: "+c);e?meta64.selectedNodes[b]=
!0:delete meta64.selectedNodes[b];a.enhanceWithin();view.updateStatusBar();meta64.refreshAllGuiEnablement()}else console.log("Unable to find Sel button for uid: "+b)},navHomeResponse:function(b){meta64.clearSelectedNodes();render.renderPageFromData(b);util.scrollToTop();meta64.refreshAllGuiEnablement()},navHome:function(){meta64.isAnonUser?meta64.loadAnonPageHome(!0):util.json("renderNode",{nodeId:meta64.homeNodeId},d.navHomeResponse)}};console.log("Module ready: nav.js");return d}();console.log("running module: changePasswordPg.js");
var changePasswordPg=function(){console.log("Module ready: changePasswordPg.js");return{domId:"changePasswordPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Login</h2>"),b=render.makePasswordField("Password","changePassword1")+render.makePasswordField("Repeat Password","changePassword2"),a=render.makeButton("Change Password","changePasswordActionButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelChangePasswordButton",
"a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#changePasswordPg"),d);$("#changePasswordActionButton").on("click",user.changePassword)},init:function(){util.delayedFocus("#changePassword1")}}}();console.log("running module: confirmPg.js");
var confirmPg=function(){var d,b,a,c;console.log("Module ready: confirmPg.js");return{domId:"confirmPg",areYouSure:function(e,h,f,g){d=e;b=h;a=f;c=g;meta64.changePage(confirmPg)},build:function(){var a;a="<h3 id='confirmPgTitle'></h3><p id='confirmPgMessage'></p>"+render.makeBackButton("Yes","confirmPgYesButton","b");a+=render.makeBackButton("No","confirmPgNoButton","a");a=render.makeTag("div",{"data-role":"content"},a);util.setHtmlEnhanced($("#confirmPg"),a)},init:function(){$("#confirmPgTitle").text(d);
$("#confirmPgMessage").text(b);$("#confirmPgYesButton").off("click");$("#confirmPgYesButton").text(a).on("click",function(){c();$(this).off("click")})}}}();console.log("running module: editNodePg.js");
var editNodePg=function(){console.log("Module ready: editNodePg.js");return{domId:"editNodePg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Edit Node</h2>"),b=render.makeButton("Save","saveNodeButton","b","ui-btn-icon-left ui-icon-check"),a=render.makeButton("Add Property","addPropertyButton","a"),c=render.makeButton("Make Node Referencable","makeNodeReferencableButton","a"),e=render.makeButton("Close","cancelEditButton","a"),b=render.makeHorzControlGroup(b+
a+c+e),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},"<div id='editNodePathDisplay' class='path-display-in-editor'></div><div id='editNodeInstructions'></div><div id='propertyEditFieldContainer'></div>"+b),d=d+b;util.setHtmlEnhanced($("#editNodePg"),d);$("#saveNodeButton").on("click",edit.saveNode);$("#cancelEditButton").on("click",edit.cancelEdit);$("#addPropertyButton").on("click",props.addProperty);$("#makeNodeReferencableButton").on("click",edit.makeNodeReferencable)},
init:function(){edit.populateEditNodePg()}}}();console.log("running module: editPropertyPg.js");
var editPropertyPg=function(){console.log("Module ready: editPropertyPg.js");return{domId:"editPropertyPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Edit Node Property</h2>"),b=render.makeButton("Save","savePropertyButton","b","ui-btn-icon-left ui-icon-check"),a=render.makeBackButton("Cancel","editPropertyPgCloseButton","a"),b=render.makeHorzControlGroup(b+a),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},"<div id='editPropertyPathDisplay' class='path-display-in-editor'></div><div id='addPropertyFieldContainer' class='ui-field-contain'></div>"+
b),d=d+b;util.setHtmlEnhanced($("#editPropertyPg"),d);$("#savePropertyButton").on("click",props.saveProperty)},init:function(){props.populatePropertyEdit()}}}();console.log("running module: exportPg.js");
var exportPg=function(){console.log("Module ready: exportPg.js");return{domId:"exportPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Export to XML</h2>"),b=render.makeEditField("Export to File Name","exportTargetNodeName"),a=render.makeButton("Export","exportNodesButton","b"),c=render.makeBackButton("Close","cancelExportButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main",
"class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#exportPg"),d);$("#exportNodesButton").on("click",edit.exportNodes)}}}();console.log("running module: importPg.js");
var importPg=function(){console.log("Module ready: importPg.js");return{domId:"importPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Import from XML</h2>"),b=render.makeEditField("Import Target Node Name","importTargetNodeName"),a=render.makeButton("Import","importNodesButton","b"),c=render.makeBackButton("Close","cancelImportButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",
{role:"main","class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#importPg"),d);$("#importNodesButton").on("click",edit.importNodes)}}}();console.log("running module: loginPg.js");
var loginPg=function(){console.log("Module ready: loginPg.js");return{domId:"loginPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Login</h2>"),b=render.makeEditField("User","userName")+render.makePasswordField("Password","password"),a=render.makeButton("Login","loginButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelLoginButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},
b+a),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#loginPg"),d);$("#loginButton").on("click",user.login);util.bindEnterKey("#userName",user.login);util.bindEnterKey("#password",user.login)},init:function(){util.delayedFocus("#userName")}}}();console.log("running module: messagePg.js");
var messagePg=function(){var d,b,a;console.log("Module ready: messagePg.js");return{domId:"messagePg",showMessage:function(c,e,h){d=c;b=e;a=h;meta64.changePage(messagePg)},build:function(){var a;a="<h3 id='messagePgTitle'></h3><p id='messagePgMessage'></p>"+render.makeBackButton("Ok","messagePgOkButton","b");a=render.makeTag("div",{"data-role":"content"},a);util.setHtmlEnhanced($("#messagePg"),a)},init:function(){$("#messagePgTitle").text(d);$("#messagePgMessage").html(b);$("#messagePgOkButton").off("click");
if(a)$("#messagePgOkButton").text(_buttonText).on("click",function(){a();$(this).off("click")})}}}();console.log("running module: popupMenuPg.js");
var popupMenuPg=function(){function d(a,b){return render.makeTag("div",{style:"margin: 0px; padding: 0px;","data-role":"collapsible","data-iconpos":"right","data-shadow":"false","data-corners":"false"},"<h2 style='margin: 0px; padding: 0px;'>"+a+"</h2>"+render.makeTag("ul",{style:"margin: 0px; padding: 0px;","data-role":"listview","data-inset":"true","data-shadow":"false","data-corners":"false"},b))}function b(a,b,d){a=render.makeTag("a",{id:b,onclick:d},a);return render.makeTag("li",{"data-icon":"false"},
a)}var a={domId:"popupMenuPg",build:function(){var a=b("Change Password","changePasswordPgButton","user.changePasswordPg();")+b("Preferences","accountPreferencesPgButton","prefs.accountPreferencesPg();")+b("Insert Book: War and Peace","insertBookWarAndPeaceButton"," edit.insertBookWarAndPeace();")+b("Donate","donatePgButton","meta64.openDonatePg();"),a=d("My Account",a),e=b("Attachments","manageAttachmentsButton","attachment.openUploadPg();")+b("Sharing","editNodeSharingButton","share.editNodeSharing();")+
b("Move","moveSelNodesButton","edit.moveSelNodes();")+b("Finish Moving","finishMovingSelNodesButton","edit.finishMovingSelNodes();")+b("Rename","renameNodePgButton","edit.openRenameNodePg();")+b("Delete","deleteSelNodesButton","edit.deleteSelNodes();")+b("Import","openImportPgButton","edit.openImportPg();")+b("Export","openExportPgButton","edit.openExportPg();"),e=d("Edit",e),h=b("Toggle Properties","propsToggleButton","props.propsToggle();")+b("Refresh","refreshPageButton","view.refreshPage();")+
b("Show URL","showFullNodeUrlButton","render.showNodeUrl();"),h=d("View Options",h),a=render.makeTag("div",{style:"margin: 0; min-width: 300px; position: fixed; top: 2em; left: 2em;","data-role":"collapsible-set"},a+e+h);util.setHtmlEnhanced($("#popupMenuPg"),a)},init:function(){var c=util.getPropertyCount(meta64.selectedNodes),b=meta64.getHighlightedNode(),d=!util.nullOrUndef(edit.nodesToMove)&&!a.isAnonUser;util.setEnablement($("#changePasswordPgButton"),!meta64.isAnonUser);util.setEnablement($("#accountPreferencesPgButton"),
!meta64.isAnonUser);util.setEnablement($("#insertBookWarAndPeaceButton"),meta64.isAdminUser&&null!=b,meta64.isAdminUser);util.setEnablement($("#donatePgButton"),!0);util.setEnablement($("#manageAttachmentsButton"),null!=b&&!meta64.isAnonUser);util.setEnablement($("#editNodeSharingButton"),null!=b&&!meta64.isAnonUser);util.setEnablement($("#moveSelNodesButton"),null!=b&&!meta64.isAnonUser);util.setEnablement($("#renameNodePgButton"),null!=b&&!meta64.isAnonUser);util.setEnablement($("#finishMovingSelNodesButton"),
d,d);util.setEnablement($("#openExportPgButton"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#openImportPgButton"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#deleteSelNodesButton"),c)}};console.log("Module ready: popupMenuPg.js");return a}();console.log("running module: prefsPg.js");
var prefsPg=function(){console.log("Module ready: prefsPg.js");return{domId:"prefsPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Account Peferences</h2>"),b=render.makeRadioButton("Simple","editModeRadioGroup","editModeSimple",!0)+render.makeRadioButton("Advanced","editModeRadioGroup","editModeAdvanced",!1),b=render.makeHorzControlGroup("<legend>Edit Mode:</legend>"+b),a=render.makeButton("Save","savePreferencesButton","b","ui-btn-icon-left ui-icon-check"),
c=render.makeBackButton("Cancel","cancelPreferencesPgButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#prefsPg"),d);$("#savePreferencesButton").on("click",prefs.savePreferences)}}}();console.log("running module: renameNodePg.js");
var renameNodePg=function(){console.log("Module ready: renameNodePg.js");return{domId:"renameNodePg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Rename Node</h2>"),b=render.makeEditField("Enter new name for the node","newNodeNameEditField"),a=render.makeButton("Rename","renameNodeButton","b"),c=render.makeBackButton("Close","cancelRenameNodeButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",
{role:"main","class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#renameNodePg"),d);$("#renameNodeButton").on("click",edit.renameNode)}}}();console.log("running module: searchPg.js");
var searchPg=function(){console.log("Module ready: searchPg.js");return{domId:"searchPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Search</h2>"),b=render.makeEditField("Search","searchText"),a=render.makeButton("Search","searchNodesButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelSearchButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",{"class":"ui-field-contain"},b+a),b=render.makeTag("div",
{role:"main","class":"ui-content dialog-content"},""+b),d=d+b;util.setHtmlEnhanced($("#searchPg"),d);$("#searchNodesButton").on("click",srch.searchNodes);util.bindEnterKey("#searchText",srch.searchNodes)},init:function(){util.delayedFocus("#searchText")}}}();console.log("running module: searchResultsPg.js");
var searchResultsPg=function(){console.log("Module ready: searchResultsPg.js");return{domId:"searchResultsPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},render.makeButton("Back to Content","cancelSearchResultsButton","b")+"<h2>"+BRANDING_TITLE+" - Search Results</h2>"),b=render.makeTag("div",{role:"main","class":"ui-content"},"<div id='searchResultsView'></div>"),d=d+b;util.setHtmlEnhanced($("#searchResultsPg"),d);$("#cancelSearchResultsButton").on("click",function(){meta64.jqueryChangePage("#mainPage");
view.scrollToSelectedNode()})},init:function(){srch.populateSearchResultsPage()}}}();console.log("running module: shareToPersonPg.js");
var shareToPersonPg=function(){console.log("Module ready: shareToPersonPg.js");return{domId:"shareToPersonPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Share Node to Person</h2>"),b=render.makeEditField("User to Share With","shareToUserName"),a=render.makeButton("Share","shareNodeToPersonButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelShareNodeToPersonButton","a"),a=render.makeHorzControlGroup(a+c),b=render.makeTag("div",
{"class":"ui-field-contain"},b+a),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},"Enter the username of the person you want to share this node with:"+b),d=d+b;util.setHtmlEnhanced($("#shareToPersonPg"),d);$("#shareNodeToPersonButton").on("click",share.shareNodeToPerson)}}}();console.log("running module: sharingPg.js");
var sharingPg=function(){console.log("Module ready: sharingPg.js");return{domId:"sharingPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Node Sharing</h2>"),b=render.makeButton("Share with Person","shareNodeToPersonPgButton","a"),a=render.makeButton("Share to Public","shareNodeToPublicButton","a"),c=render.makeBackButton("Close","cancelSharingButton","a"),b=render.makeHorzControlGroup(b+a+c),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},
"<div id='shareNodeNameDisplay'></div><div id='sharingListFieldContainer'></div>"+b),d=d+b;util.setHtmlEnhanced($("#sharingPg"),d);$("#shareNodeToPersonPgButton").on("click",share.shareNodeToPersonPg);$("#shareNodeToPublicButton").on("click",share.shareNodeToPublic)},init:function(){share.reload()}}}();console.log("running module: signupPg.js");
var signupPg=function(){var d={domId:"signupPg",build:function(){var b=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Signup</h2>"),a=render.makeEditField("User","signupUserName")+render.makePasswordField("Password","signupPassword")+render.makeEditField("Email","signupEmail")+render.makeEditField("Captcha","signupCaptcha"),c=render.makeTag("div",{"class":"captcha-image"},render.makeTag("img",{id:"captchaImage","class":"captcha",src:""},"",!1)),e=render.makeButton("Signup",
"signupButton","b","ui-btn-icon-left ui-icon-check"),h=render.makeButton("Try Different Image","tryAnotherCaptchaButton","a"),f=render.makeBackButton("Close","cancelSignupButton","a"),e=render.makeHorzControlGroup(e+h+f),a=render.makeTag("div",{"class":"ui-field-contain"},a+c+e),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content",id:d.domId+"-main"},""+a),b=b+a;util.setHtmlEnhanced($("#signupPg"),b);$("#tryAnotherCaptchaButton").on("click",user.tryAnotherCaptcha);$("#signupButton").on("click",
user.signup)},init:function(){user.pageInitSignupPg();util.delayedFocus("#signupUserName")}};console.log("Module ready: signupPg.js");return d}();console.log("running module: uploadPg.js");
var uploadPg=function(){console.log("Module ready: uploadPg.js");return{domId:"uploadPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Upload File Attachment</h2>"),b=render.makeTag("div",{id:"uploadPathDisplay","class":"path-display-in-editor"},""),a=render.makeTag("input",{type:"file",name:"file"},"",!0)+render.makeTag("input",{id:"uploadFormNodeId",type:"hidden",name:"nodeId"}),a=render.makeTag("form",{id:"uploadForm",method:"POST",enctype:"multipart/form-data"},
a),a=render.makeTag("div",{id:"uploadFieldContainer"},"<p>Upload from your computer</p>"+a),c=render.makeEditField("Upload From URL","uploadFromUrl"),c=render.makeTag("div",{},c),e=render.makeButton("Upload","uploadButton","b","ui-btn-icon-left ui-icon-check"),h=render.makeButton("Delete","deleteAttachmentButton","a"),f=render.makeBackButton("Close","closeUploadButton","a"),e=render.makeHorzControlGroup(e+h+f),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},b+a+"<div><h3>-- OR --</h3></div>"+
c+e);util.setHtmlEnhanced($("#uploadPg"),d+b);$("#uploadButton").on("click",attachment.uploadFileNow);$("#deleteAttachmentButton").on("click",attachment.deleteAttachment)},init:function(){$("#uploadFromUrl").val("");$("#uploadPathDisplay").html("Path: "+render.formatPath(attachment.uploadNode))}}}();console.log("running module: prefs.js");
var prefs=function(){var d={savePreferencesResponse:function(b){util.checkSuccess("Saving Preferences",b)&&(meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},savePreferences:function(){meta64.editModeOption=$("#editModeSimple").is(":checked")?meta64.MODE_SIMPLE:meta64.MODE_ADVANCED;util.json("saveUserPreferences",{userPreferences:{advancedMode:meta64.editModeOption===meta64.MODE_ADVANCED}},d.savePreferencesResponse)},populatePreferencesPg:function(){$("#editModeSimple").prop("checked",meta64.editModeOption===
meta64.MODE_SIMPLE).checkboxradio("refresh");$("#editModeAdvanced").prop("checked",meta64.editModeOption===meta64.MODE_ADVANCED).checkboxradio("refresh")},accountPreferencesPg:function(){meta64.changePage(prefsPg);d.populatePreferencesPg()}};console.log("Module ready: prefs.js");return d}();console.log("running module: props.js");
var props=function(){var d=function(a){util.checkSuccess("Save properties",a);edit.editNode.properties.push(a.propertySaved);meta64.changePage(editNodePg);meta64.treeDirty=!0},b={propsToggle:function(){meta64.showProperties=meta64.showProperties?!1:!0;var a=$("#propsToggleButton");a.toggleClass("ui-icon-grid",meta64.showProperties);a.toggleClass("ui-icon-forbidden",!meta64.showProperties);render.renderPageFromData();view.scrollToSelectedNode();meta64.jqueryChangePage("#mainPage")},deleteProperty:function(a){confirmPg.areYouSure("Confirm Delete",
"Delete the Property","Yes, delete.",function(){b.deletePropertyImmediate(a)})},deletePropertyImmediate:function(a){util.json("deleteProperty",{nodeId:edit.editNode.id,propName:a}).done(function(c){util.checkSuccess("Delete property",c)&&(props.deletePropertyFromLocalData(a),meta64.changePage(editNodePg),meta64.treeDirty=!0)})},addProperty:function(){meta64.changePage(editPropertyPg)},populatePropertyEdit:function(){var a;a=""+render.makeTag("label",{"for":"addPropertyNameTextContent"},"Name");a+=
render.makeTag("textarea",{name:"addPropertyNameTextContent",id:"addPropertyNameTextContent",placeholder:"Enter property name"},"");a+=render.makeTag("label",{"for":"addPropertyValueTextContent"},"Value");a+=render.makeTag("textarea",{name:"addPropertyValueTextContent",id:"addPropertyValueTextContent",placeholder:"Enter property text"},"");view.initEditPathDisplayById("#editPropertyPathDisplay");util.setHtmlEnhanced($("#addPropertyFieldContainer"),a)},saveProperty:function(){var a=$("#addPropertyNameTextContent").val(),
c=$("#addPropertyValueTextContent").val();util.json("saveProperty",{nodeId:edit.editNode.id,propertyName:a,propertyValue:c},d)},addSubProperty:function(a){a=meta64.fieldIdToPropMap[a];util.isObject(a.values)||(a.values=[],a.values.push(a.value),a.value=null);a.values.push("");edit.populateEditNodePg()},clearProperty:function(a){var c=$("#"+a);0!=c.length&&c.val("");for(var b=0;1E3>b;){c=$("#"+a+"_subProp"+b);if(0==c.length)break;c.val("");b++}},deletePropertyFromLocalData:function(a){for(var c=0;c<
edit.editNode.properties.length;c++)if(a===edit.editNode.properties[c].name){edit.editNode.properties.splice(c,1);break}},makeMultiPropEditor:function(a,c,b,d){var f="",g=c.values;g&&0!=g.length||(g=[],g.push(""));for(var k=0;k<g.length;k++){console.log("prop multi-val["+k+"]="+g[k]);var m=a+"_subProp"+k,f=f+render.makeTag("label",{"for":m},(0==k?c.name:"*")+"."+k),n=d?"[binary]":g[k],f=d||b?f+render.makeTag("textarea",{id:m,readonly:"readonly",disabled:"disabled"},n?n:""):f+render.makeTag("textarea",
{id:m},n?n:"")}return f},setPreferredPropertyOrder:function(a){if(a){var c=[];$.each(a,function(a,b){b.name===jcrCnst.CONTENT?c.unshift(b):c.push(b)});return c}},renderProperties:function(a){if(a){var b="<table data-role='table' class='prop-table ui-responsive ui-shadow table-stripe property-text'>",e=0,b=b+"<thead><tr><th></th><th></th></tr></thead>",b=b+"<tbody>";$.each(a,function(a,d){if(render.allowPropertyToDisplay(d.name)){var g=render.isBinaryProperty(d.name);e++;b+="<tr class='prop-table-row'>";
b+="<td class='prop-table-name-col'>"+render.sanitizePropertyName(d.name)+"</td>";b=g?b+"<td class='prop-table-val-col'>[binary]</td>":d.values?b+("<td class='prop-table-val-col'>"+props.renderPropertyValues(d.values)+"</td>"):b+("<td class='prop-table-val-col'>"+render.markdown(d.value)+"</td>");b+="</tr>"}else console.log("Hiding property: "+d.name)});return 0==e?"":b+="</tbody></table>"}},getNodeProperty:function(a,b){if(!b||!b.properties)return null;for(var e=0;e<b.properties.length;e++){var d=
b.properties[e];if(d.name===a)return d}return null},getNodePropertyVal:function(a,c){var e=b.getNodeProperty(a,c);return e?e.value:null},renderProperty:function(a){return a.values?b.renderPropertyValues(a.values):a.value&&0!=a.value.length?render.markdown(a.value):""},renderPropertyValues:function(a){var b="<div>";$.each(a,function(a,d){b+=render.markdown(d)+cnst.BR});return b+="</div>"}};console.log("Module ready: props.js");return b}();console.log("running module: render.js");
var render=function(){var d,b={buildPage:function(a){a.built||(a.build(),a.built=!0);a.init&&a.init()},renderNodeContent:function(a,c,e,d,f){var g="",k;k=""+b.getTopRightImageTag(a);e&&meta64.editMode&&(g+="<div class='path-display'>Path: "+b.formatPath(a)+"</div>",g+="<div>",a.createdBy&&(g+="<span class='"+(a.createdBy===meta64.userName?"created-by-me":"created-by-other")+"'>Created By: "+a.createdBy+"</span>"),g+="<span id='ownerDisplay"+a.uid+"'></span>",a.lastModified&&(g+="  Modified: "+a.lastModified),
g+="</div>");!c||!meta64.editMode||a.id===a.path&&e||(g+="ID: "+a.id+cnst.BR);d&&!e&&a.name&&(g+="Name: "+a.name+" [uid="+a.uid+"]");g&&(k+=b.makeTag("div",{"class":"header-text"},g));if(meta64.showProperties)(c=props.renderProperties(a.properties))&&(k+=c);else if(c=props.getNodeProperty(jcrCnst.CONTENT,a))c=props.renderProperty(c),0<c.length&&(k+=b.makeTag("div",{"class":"jcr-content"},b.markdown(c)));f&&a.hasBinary&&(a.binaryIsImage?a=b.makeImageTag(a):(a=b.makeTag("a",{href:b.getUrlForNodeAttachment(a)},
"[Download Attachment]"),a=b.makeTag("div",{"class":"binary-link"},a)),k=k.contains(cnst.INSERT_ATTACHMENT)?k.replaceAll(cnst.INSERT_ATTACHMENT,a):k+a);return k},renderNodeAsListItem:function(a,c,e,d){var f=a.uid,g=a.id===meta64.newChildNodeId;d=0<c&&1<d;c=c<e-1;e=a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");e=meta64.isAdminUser||!e;var k=meta64.getHighlightedNode();!g&&k&&k.uid===f&&(g=!0);d=b.makeRowButtonBarHtml(f,d,c,e);c=b.getNodeBkgImageStyle(a);return b.makeTag("div",
{"class":"node-table-row"+(g?" active-row":" inactive-row"),onClick:"nav.clickOnNodeRow(this, '"+f+"');",id:f+"_row",style:c},d+b.makeTag("div",{id:f+"_content"},b.renderNodeContent(a,!0,!0,!0,!0)))},showNodeUrl:function(){var a=meta64.getHighlightedNode();if(a){var b=window.location.origin+"?id="+a.path;meta64.jqueryChangePage("#mainPage");b="URL using path: <br>"+b;(a=props.getNodePropertyVal("jcr:uuid",a))&&(b+="<p>URL for UUID: <br>"+window.location.origin+"?id="+a);messagePg.showMessage("Full External URL of Node",
b)}else alert("You must first click on a node.")},getTopRightImageTag:function(a){a=props.getNodePropertyVal("img.top.right",a);var c="";a&&(c=b.makeTag("img",{src:a,"class":"top-right-image"},"",!1));return c},getNodeBkgImageStyle:function(a){a=props.getNodePropertyVal("img.node.bkg",a);var b="";a&&(b="background-image: url("+a+");");return b},makeRowButtonBarHtml:function(a,c,e,d){var f=selButton=createSubNodeButton=editNodeButton=moveNodeUpButton=moveNodeDownButton=insertNodeButton="";b.nodeHasChildren(a)&&
(f=b.makeTag("a",{onClick:"nav.openNode('"+a+"');","class":"ui-btn ui-btn-b ui-btn-inline ui-icon-plus ui-mini ui-btn-icon-left"},"Open"));meta64.editMode&&(selButton=b.makeTag("a",{id:a+"_sel",onClick:"nav.toggleNodeSel('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-check ui-mini ui-btn-icon-left "+(meta64.selectedNodes[a]?"ui-btn-b":"ui-btn-a")},"Sel"),cnst.NEW_ON_TOOLBAR&&(createSubNodeButton=b.makeTag("a",{onClick:"edit.createSubNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-star ui-mini ui-btn-icon-left"},
"New")),cnst.INS_ON_TOOLBAR&&(insertNodeButton=b.makeTag("a",{onClick:"edit.insertNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-bars ui-mini ui-btn-icon-left"},"Ins")));meta64.editMode&&d&&(editNodeButton=b.makeTag("a",{onClick:"edit.runEditNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-edit ui-mini ui-btn-icon-left"},"Edit"),meta64.currentNode.childrenOrdered&&(c&&(moveNodeUpButton=b.makeTag("a",{onClick:"edit.moveNodeUp('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-arrow-u ui-mini ui-btn-icon-left"},
"Up")),e&&(moveNodeDownButton=b.makeTag("a",{onClick:"edit.moveNodeDown('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-arrow-d ui-mini ui-btn-icon-left"},"Dn"))));a=selButton+f+insertNodeButton+createSubNodeButton+editNodeButton+moveNodeUpButton+moveNodeDownButton;return 0<a.length?b.makeHorizontalFieldSet(a,"compact-field-contain"):""},makeHorizontalFieldSet:function(a,c){var e=b.makeTag("fieldset",{"data-role":"controlgroup","data-type":"horizontal"},a);return b.makeTag("div",{"class":"ui-field-contain"+
(c?" "+c:"")},e)},makeHorzControlGroup:function(a){return b.makeTag("div",{"data-role":"controlgroup","data-type":"horizontal"},a)},makeRadioButton:function(a,c,e,d){return b.makeTag("input",{type:"radio",name:c,id:e,checked:d?"checked":"unchecked"},"",!0)+b.makeTag("label",{"for":e},a)},nodeHasChildren:function(a){var b=meta64.uidToNodeMap[a];if(b)return b.hasChildren;console.log("Unknown nodeId in nodeHasChildren: "+a);return!1},formatPath:function(a){var b=a.path,b=meta64.isAdminUser?b:b.replaceAll("/root",
"");return b+=" ["+a.primaryTypeName+"]"},markdown:function(a){d||(d=(new Markdown.getSanitizingConverter).makeHtml);return"<div data-ajax='false'>"+d(a)+"</div>"},renderMainPageControls:function(){var a="";0<srch.numSearchResults()&&(a+=render.makeTag("a",{onClick:"nav.showSearchPage();","class":"ui-btn ui-btn-inline ui-icon-search ui-btn-icon-left"},"Back to Search Results"));var b=0<a.length;b&&util.setHtmlEnhanced($("#mainPageControls"),a);util.setVisibility("#mainPageControls",b)},renderPageFromData:function(a){var c=
!1;a?c=!0:a=meta64.currentNodeData;if(a&&a.node){util.setVisibility("#listView",!0);b.renderMainPageControls();meta64.treeDirty=!1;c&&(meta64.uidToNodeMap={},meta64.idToNodeMap={},meta64.selectedNodes={},meta64.initNode(a.node),meta64.setCurrentNodeData(a));var e="",d=b.getNodeBkgImageStyle(a.node),f=b.renderNodeContent(a.node,!0,!0,!0,!0);if(0<f.length){var g=a.node.uid,d=b.makeTag("div",{"class":"node-table-row page-parent-node inactive-row",onClick:"nav.clickOnNodeRow(this, '"+g+"');",id:g+"_row",
style:d},f);$("#mainNodeContent").show();$("#mainNodeContent").html(d)}else $("#mainNodeContent").hide();$("#mainNodeContent").trigger("updatelayout");view.updateStatusBar();b.renderMainPageControls();if(a.children){var k=a.children.length,m=0;$.each(a.children,function(a,d){var g=b.generateRow(a,d,c,k,m);0!=g.length&&(e+=g,m++)})}0!=e.length||meta64.isAnonUser||(e=b.makeTag("a",{onClick:"edit.createSubNode();","class":"ui-btn ui-btn-inline ui-icon-star ui-btn-icon-left"},"Create Content"));util.setHtmlEnhancedById("#listView",
e);meta64.screenSizeChange();meta64.getHighlightedNode()||util.scrollToTop()}else util.setVisibility("#listView",!1),$("#mainNodeContent").html("No default content is available.")},generateRow:function(a,c,d,h,f){if(meta64.isNodeBlackListed(c))return"";d&&meta64.initNode(c);f++;return b.renderNodeAsListItem(c,a,h,f)},getUrlForNodeAttachment:function(a){return postTargetUrl+"bin/file-name?nodeId="+encodeURIComponent(a.path)+"&ver="+a.binVer},adjustImageSize:function(a){var b=$("#"+a.imgId);b&&a.width&&
a.height&&(a.width>meta64.deviceWidth-80?(b.attr("width","100%"),b.attr("height","auto")):(b.attr("width",a.width),b.attr("height",a.height)))},makeImageTag:function(a){var c=b.getUrlForNodeAttachment(a);a.imgId="imgUid_"+a.uid;if(a.width&&a.height){if(a.width>meta64.deviceWidth-50){var d=meta64.deviceWidth-50;return b.makeTag("img",{src:c,id:a.imgId,width:d+"px",height:d*a.height/a.width+"px"},null,!1)}return b.makeTag("img",{src:c,id:a.imgId,width:a.width+"px",height:a.height+"px"},null,!1)}return b.makeTag("img",
{src:c,id:a.imgId},null,!1)},makeTag:function(a,b,d,h){"undefined"===typeof h&&(h=!0);var f="<"+a;b&&(f+=" ",$.each(b,function(a,b){f=b.contains("'")?f+(a+'="'+b+'" '):f+(a+"='"+b+"' ")}));return f=h?f+(">"+d+"</"+a+">"):f+"/>"},makeEditField:function(a,c){return b.makeTag("label",{"for":c},a)+b.makeTag("input",{type:"text",name:c,id:c},"",!0)},makePasswordField:function(a,c){return b.makeTag("label",{"for":c},a)+b.makeTag("input",{type:"password",name:c,id:c},"",!0)},makeButton:function(a,b,d,h){d=
"ui-btn ui-btn-inline ui-btn-"+d;h&&(d+=" "+h);return render.makeTag("a",{id:b,"class":d},a)},makeBackButton:function(a,b,d){return render.makeTag("a",{id:b,"class":"ui-btn ui-icon-carat-l ui-btn-inline ui-btn-"+d,"data-rel":"back"},a)},allowPropertyToDisplay:function(a){return null==meta64.simpleModePropertyBlackList[a]},isReadOnlyProperty:function(a){return meta64.readOnlyPropertyList[a]},isBinaryProperty:function(a){return meta64.binaryPropertyList[a]},sanitizePropertyName:function(a){return"simple"===
meta64.editModeOption?a===jcrCnst.CONTENT?"Content":a:a}};console.log("Module ready: render.js");return b}();console.log("running module: search.js");
var srch=function(){var d=function(a){b.searchResults=a;meta64.changePage(searchResultsPg)},b={searchResults:null,highlightRowNode:null,identToUidMap:{},uidToNodeMap:{},numSearchResults:function(){return null!=srch.searchResults&&null!=srch.searchResults.searchResults&&null!=srch.searchResults.searchResults.length?srch.searchResults.searchResults.length:0},searchNodes:function(){if(util.ajaxReady("searchNodes")){var a=meta64.getHighlightedNode();if(a){var b=$.trim($("#searchText").val());util.emptyString(b)?
alert("Enter search text."):util.json("nodeSearch",{nodeId:a.id,searchText:b,modSortDesc:!1},d)}else alert("No node is selected to search under.")}},timeline:function(){var a=meta64.getHighlightedNode();a?util.json("nodeSearch",{nodeId:a.id,searchText:"",modSortDesc:!0},d):alert("No node is selected to search under.")},searchPg:function(){meta64.changePage(searchPg)},initSearchNode:function(a){a.uid=util.getUidForId(b.identToUidMap,a.id);b.uidToNodeMap[a.uid]=a},populateSearchResultsPage:function(a){a||
(a=b.searchResults);var c="",d=a.searchResults.length,h=0;$.each(a.searchResults,function(a,g){meta64.isNodeBlackListed(g)||(b.initSearchNode(g),h++,c+=b.renderSearchResultAsListItem(g,a,d,h))});util.setHtmlEnhanced($("#searchResultsView"),c)},renderSearchResultAsListItem:function(a,c,d,h){c=a.uid;a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");return render.makeTag("div",{"class":"node-table-row inactive-row",onClick:"srch.clickOnSearchResultRow(this, '"+c+"');",id:c+
"_srch_row"},b.makeButtonBarHtml(c)+render.makeTag("div",{id:c+"_srch_content"},render.renderNodeContent(a,!0,!0,!0,!0)))},makeButtonBarHtml:function(a){a=render.makeTag("a",{onClick:"srch.clickSearchNode('"+a+"');","class":"ui-btn ui-mini ui-btn-b ui-btn-inline ui-icon-carat-l ui-btn-icon-left"},"Go to Node");return render.makeHorizontalFieldSet(a,"compact-field-contain")},clickOnSearchResultRow:function(a,c){b.unhighlightRow();b.highlightRowNode=b.uidToNodeMap[c];util.changeOrAddClass(a,"inactive-row",
"active-row")},clickSearchNode:function(a){srch.highlightRowNode=srch.uidToNodeMap[a];view.refreshTree(srch.highlightRowNode.id,!0);meta64.jqueryChangePage("#mainPage")},unhighlightRow:function(){if(b.highlightRowNode){var a=util.domElm(b.highlightRowNode.uid+"_srch_row");a&&util.changeOrAddClass(a,"active-row","inactive-row")}}};console.log("Module ready: search.js");return b}();console.log("running module: user.js");
var share=function(){var d=function(a){c.populateSharingPg(a)},b=function(a,b){var c="";$.each(b.privileges,function(b,d){var h=render.makeTag("a",{onClick:"share.removePrivilege('"+a+"', '"+d.privilegeName+"');","class":"ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left"},"Remove"),h=render.makeHorizontalFieldSet(h),h=h+("<b>"+a+"</b> has privilege <b>"+d.privilegeName+"</b> on this node.");c+=render.makeTag("div",{"class":"privilege-entry"},h)});return c},a=function(a){util.json("getNodePrivileges",
{nodeId:c.sharingNode.path,includeAcl:!0,includeOwners:!0},d)},c={sharingNode:null,populateSharingPg:function(a){var c="<h2>Access Control Entries</h2>";$.each(a.aclEntries,function(a,d){c+="<h4>User: "+d.principalName+"</h4>";c+=render.makeTag("div",{"class":"privilege-list"},b(d.principalName,d))});""===c&&(c="Node is not shared with anyone.");util.setHtmlEnhanced($("#sharingListFieldContainer"),c)},removePrivilege:function(b,d){util.json("removePrivilege",{nodeId:c.sharingNode.id,principal:b,privilege:d},
a)},shareNodeToPersonPg:function(){meta64.changePage(shareToPersonPg)},shareNodeToPerson:function(){var a=$("#shareToUserName").val();a?util.json("addPrivilege",{nodeId:c.sharingNode.id,principal:a,privileges:["read","write","addChildren","nodeTypeManagement"]},c.reloadFromShareWithPerson):alert("Please enter a username")},shareNodeToPublic:function(){console.log("Sharing node to public.");util.json("addPrivilege",{nodeId:c.sharingNode.id,principal:"everyone",privileges:["read"]},c.reload)},editNodeSharing:function(){var a=
meta64.getHighlightedNode();a?(c.sharingNode=a,meta64.changePage(sharingPg)):alert("No node is selected.")},reloadFromShareWithPerson:function(a){util.checkSuccess("Share Node with Person",a)&&meta64.changePage(sharingPg)},reload:function(){console.log("Loading node sharing info.");util.json("getNodePrivileges",{nodeId:c.sharingNode.id,includeAcl:!0,includeOwners:!0},d)}};console.log("Module ready: share.js");return c}();console.log("running module: user.js");
var user=function(){var d=function(a){var b=BRANDING_TITLE;meta64.isAnonUser||(b+=" - "+a.userName);$("#headerUserName").html(b);a=meta64.isAnonUser;$("#openLoginPgButton").text(a?"Login":"Logout")},b=function(a){a.rootNode&&(meta64.homeNodeId=a.rootNode.id,meta64.homeNodePath=a.rootNode.path);meta64.userName=a.userName;meta64.isAdminUser="admin"===a.userName;meta64.isAnonUser="anonymous"===a.userName;meta64.anonUserLandingPageNode=a.anonUserLandingPageNode;meta64.editModeOption=a.userPreferences.advancedMode?
meta64.MODE_ADVANCED:meta64.MODE_SIMPLE},a=function(a,c,e,h){util.checkSuccess("Login",a)?("anonymous"!=c&&(f.writeCookie(cnst.COOKIE_LOGIN_USR,c),f.writeCookie(cnst.COOKIE_LOGIN_PWD,e)),meta64.jqueryChangePage("#mainPage"),b(a),a.userPreferences.lastNode?console.log("lastNode: "+a.userPreferences.lastNode):console.log("lastNode is null."),c=null,c=util.emptyString(a.homeNodeOverride)?a.userPreferences.lastNode?a.userPreferences.lastNode:meta64.homeNodeId:a.homeNodeOverride,view.refreshTree(c,!1),
d(a)):h&&(alert("Cookie login failed."),$.removeCookie(cnst.COOKIE_LOGIN_USR),$.removeCookie(cnst.COOKIE_LOGIN_PWD),location.reload())},c=function(a){meta64.jqueryChangePage("#mainPage");location.reload()},e=function(a){util.checkSuccess("Change password",a)&&alert("Password changed successfully.")},h=function(a){util.checkSuccess("Signup new user",a)&&(user.populateLoginPgFromCookies(),meta64.changePage(loginPg),alert("User Information Accepted. \n\nCheck your email for signup confirmation. (Can take up to 1 minute)"))},
f={openSignupPg:function(){meta64.changePage(signupPg)},writeCookie:function(a,b){$.cookie(a,b,{expires:365,path:"/"})},populateLoginPgFromCookies:function(){var a=$.cookie(cnst.COOKIE_LOGIN_USR),b=$.cookie(cnst.COOKIE_LOGIN_PWD);a&&$("#userName").val(a);b&&$("#password").val(b)},openLoginPg:function(){meta64.isAnonUser?(f.populateLoginPgFromCookies(),util.setVisibility("#loginCredentialFields",meta64.isAnonUser),meta64.changePage(loginPg)):f.logout()},signup:function(){var a=util.getRequiredElement("#signupUserName").val(),
b=util.getRequiredElement("#signupPassword").val(),c=util.getRequiredElement("#signupEmail").val(),d=util.getRequiredElement("#signupCaptcha").val();util.anyEmpty(a,b,c,d)?alert("Sorry, you cannot leave any fields blank."):util.json("signup",{userName:a,password:b,email:c,captcha:d},h)},pageInitSignupPg:function(){user.tryAnotherCaptcha()},tryAnotherCaptcha:function(){var a=util.currentTimeMillis(),a=postTargetUrl+"captcha?t="+a;$("#captchaImage").attr("src",a)},refreshLogin:function(){var c=$.cookie(cnst.COOKIE_LOGIN_USR),
e=$.cookie(cnst.COOKIE_LOGIN_PWD),f=!util.emptyString(c)&&!util.emptyString(e),h=c?c:"{session}",p=e?e:"{session}",c=util.json("login",{userName:h,password:p,usingCookies:f,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime});f?c.done(function(b){a(b,h,p,f)}):c.done(function(a){b(a);d(a);meta64.loadAnonPageHome(!1)})},login:function(){var b=$.trim($("#userName").val()),c=$.trim($("#password").val());util.json("login",{userName:b,password:c,tzOffset:(new Date).getTimezoneOffset(),
dst:util.daylightSavingsTime}).done(function(d){a(d,b,c)})},logout:function(){$.removeCookie(cnst.COOKIE_LOGIN_USR);$.removeCookie(cnst.COOKIE_LOGIN_PWD);util.json("logout",{},c)},changePassword:function(){var a=util.getRequiredElement("#changePassword1").val(),b=util.getRequiredElement("#changePassword2").val();a&&4<=a.length&&a===b?util.json("changePassword",{newPassword:a},e):alert("Sorry, invalid password(s).")},changePasswordPg:function(){meta64.changePage(changePasswordPg)}};console.log("Module ready: user.js");
return f}();console.log("running module: util.js");
var util=function(){Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)});"function"!=typeof String.prototype.contains&&(String.prototype.contains=function(a){return-1!=
this.indexOf(a)});"function"!=typeof String.prototype.replaceAll&&(String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),b)});var d=0,b={daylightSavingsTime:(new Date).dst()?!0:!1,json:function(a,b,e){d++;a=$.ajax({url:postTargetUrl+a,contentType:"application/json",type:"post",dataType:"json",cache:!1,data:JSON.stringify(b)});a.done(function(a){"function"==typeof e&&e(a)});a.fail(function(a,b){alert("Server request failed.")});
a.complete(function(){d--});return a},ajaxReady:function(a){return 0<d?(console.log("Ignoring requests: "+a+". Ajax currently in progress."),!1):!0},isAjaxWaiting:function(){return 0<d},delayedFocus:function(a){setTimeout(function(){$(a).focus()},500)},checkSuccess:function(a,b){b.success||alert(a+" failed: "+b.message);return b.success},addAll:function(a,b){for(var d=0;d<b.length;d++)b[d]?a[b[d]]=!0:console.error("null element in addAll at idx="+d)},nullOrUndef:function(a){return null===a||void 0===
a},getUidForId:function(a,b){var d=a[b];d||(d=meta64.nextUid++,a[b]=d);return d},getPreviousPage:function(){var a="#"+$.mobile.activePage.prev('div[data-role="page"]')[0].id;alert("prevPage="+a);return a},domElm:function(a){if(a.contains("#"))return console.log("do not use # in domElm"),null;var b=document.getElementById(a);b&&0!=b.length||console.log("domElm Error. Required element id not found: "+a);return b},getRequiredElement:function(a){var b=$(a);null==b&&console.log("getRequiredElement. Required element id not found: "+
a);return b},isObject:function(a){return a&&0!=a.length},currentTimeMillis:function(){return(new Date).getMilliseconds()},emptyString:function(a){return!a||0==a.length},setEnablement:function(a,c,d){"undefined"===typeof d||d?b.setVisibility(a,!0):b.setVisibility(a,!1);c&&a.removeClass("ui-state-disabled");c||a.addClass("ui-state-disabled")},hookSliderChanges:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a]+"SliderChange",d=window[b];"function"!==typeof d&&alert("Function not found: "+
b);if(!hookSlider("#"+arguments[a]+"Slider",d)){alert("Failed to hook slider: "+arguments[a]);break}}},hookSlider:function(a,c){b.getRequiredElement(a).change(c);return!0},bindEnterKey:function(a,c){b.bindKey(a,c,13)},bindKey:function(a,b,d){$(a).keypress(function(a){if(a.which==d)return b(),!1})},anyEmpty:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!b||0==b.length)return!0}return!1},changeOrAddClass:function(a,b,d){a=$(a);a.toggleClass(b,!1);a.toggleClass(d,!0)},changeOrAddClass__mine:function(a,
b,d){if(a.className&&0!=a.className.length){for(var h=a.className.split(" "),f="",g=!1,k=0;k<h.length;k++){var m=h[k];if(m===d){if(g)continue;g=!0}else if(m===b){if(g)continue;m=d;g=!0}0<f.length&&(f+=" ");f+=m}g||(0<f.length&&(f+=" "),f+=d);a.className=f}else console.log("no existing className is available on element, so assigning to "+d),a.className=d},verifyType:function(a,b,d){return typeof a!==b?(alert(d),!1):!0},setHtmlEnhancedById:function(a,c){var d=b.getRequiredElement(a);d?($(d).html(c),
$(d).enhanceWithin()):console.log("setting failed.")},setHtmlEnhanced:function(a,b){a.html(b);a.enhanceWithin()},getPropertyCount:function(a){var b=0,d;for(d in a)a.hasOwnProperty(d)&&b++;return b},printObject:function(a){var b="";$.each(a,function(a,d){b+=a+" , "+d+"\n"});return b},printProperties:function(a){if(a){var b="";$.each(a,function(a,d){b+=a+"\n"});return b}console.error("printProperties recieved null.")},scrollToTop:function(){window.scrollTo(0,0)},printKeys:function(a){var b="";$.each(a,
function(a,d){0<b.length&&(b+=",");b+=a});return b},setVisibility:function(a,b){b?$(a).show():$(a).hide();$(a).trigger("updatelayout")}};console.log("Module ready: util.js");return b}();console.log("running module: view.js");
var view=function(){var d={updateStatusBar:function(){if(meta64.currentNodeData){var b="";meta64.editModeOption===meta64.MODE_ADVANCED&&(b+="count: "+meta64.currentNodeData.children.length);meta64.editMode&&(b+=" Selections: "+util.getPropertyCount(meta64.selectedNodes));var a=0<b.length;util.setVisibility("#mainNodeStatusBar",a);a&&util.setHtmlEnhanced($("#mainNodeStatusBar"),b)}},refreshTreeResponse:function(b,a,c){render.renderPageFromData(b);a&&c&&b.displayedParent?meta64.highlightRowById(a,!0):
d.scrollToSelectedNode();meta64.refreshAllGuiEnablement()},refreshTree:function(b,a){b||(b=meta64.currentNodeId);util.json("renderNode",{nodeId:b,renderParentIfLeaf:a?!0:!1}).done(function(c){d.refreshTreeResponse(c,b,a)})},refreshPage:function(){meta64.jqueryChangePage("#mainPage");view.refreshTree(null,!1)},scrollToSelectedNode:function(){setTimeout(function(){var b=nav.getSelectedDomElement();if(b){var a=meta64.getHighlightedNode(),b=0==meta64.getOrdinalOfNode(a)?0:$("#"+b.id).offset().top-$("#mainPageHeader").height();
$("html, body").animate({scrollTop:b})}},1E3)},initEditPathDisplayById:function(b){var a=edit.editNode;b=$(b);edit.editingUnsavedNode?b.hide():(b.html("Path: "+render.formatPath(a)),b.show());b.trigger("updatelayout")}};console.log("Module ready: view.js");return d}();
