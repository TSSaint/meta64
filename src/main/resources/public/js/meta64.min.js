console.log("running module: nav.js");
var nav=function(){var d={displayingHome:function(){return meta64.isAnonUser?meta64.currentNodeId===meta64.anonUserLandingPageNode:meta64.currentNodeId===meta64.homeNodeId},parentVisibleToUser:function(){return!d.displayingHome()},upLevelResponse:function(a,b){a&&a.node?(render.renderPageFromData(a),meta64.highlightRowById(b,!0),meta64.refreshAllGuiEnablement()):messagePg.alert("No data is visible to you above this node.")},navUpLevel:function(){if(d.parentVisibleToUser()){var a=util.json("renderNode",
{nodeId:meta64.currentNodeId,upLevel:1});a.completes.then(function(){d.upLevelResponse(a.response,meta64.currentNodeId)})}},getSelectedDomElement:function(){var a=meta64.getHighlightedNode();return a&&(a=meta64.uidToNodeMap[a.uid])?(console.log("found highlighted node.id="+a.id),util.domElm(a.uid+"_row")):null},getSelectedPolyElement:function(){var a=meta64.getHighlightedNode();return a&&(a=meta64.uidToNodeMap[a.uid])?(console.log("found highlighted node.id="+a.id),util.polyElm(a.uid+"_row")):null},
clickOnNodeRow:function(a,b){var c=meta64.uidToNodeMap[b];c?(meta64.highlightNode(c,!1),meta64.editMode&&!c.owner&&(console.log("calling updateNodeInfo"),meta64.updateNodeInfo(c)),meta64.refreshAllGuiEnablement()):console.log("clickOnNodeRow recieved uid that doesn't map to any node. uid="+b)},openNode:function(a){var b=meta64.uidToNodeMap[a];meta64.highlightNode(b,!0);b?view.refreshTree(b.id,!1):messagePg.alert("Unknown nodeId in openNode: "+a)},toggleNodeSel:function(a){util.polyElm(a+"_sel").node.active?
meta64.selectedNodes[a]=!0:delete meta64.selectedNodes[a];view.updateStatusBar();meta64.refreshAllGuiEnablement()},navHomeResponse:function(a){meta64.clearSelectedNodes();render.renderPageFromData(a);view.scrollToTop();meta64.refreshAllGuiEnablement()},navHome:function(){meta64.isAnonUser?meta64.loadAnonPageHome(!0):util.json("renderNode",{nodeId:meta64.homeNodeId},d.navHomeResponse)}};console.log("Module ready: nav.js");return d}();console.log("running module: user.js");
var user=function(){var d=function(a){var b=BRANDING_TITLE;meta64.isAnonUser||(b+=" - "+a.userName);$("#headerAppName").html(b)},a=function(a){a.rootNode&&(meta64.homeNodeId=a.rootNode.id,meta64.homeNodePath=a.rootNode.path);meta64.userName=a.userName;meta64.isAdminUser="admin"===a.userName;meta64.isAnonUser="anonymous"===a.userName;meta64.anonUserLandingPageNode=a.anonUserLandingPageNode;meta64.editModeOption=a.userPreferences.advancedMode?meta64.MODE_ADVANCED:meta64.MODE_SIMPLE;console.log("from server: meta64.editModeOption="+
meta64.editModeOption)},b=function(b,e,c,f){util.checkSuccess("Login",b)?(console.log("loginResponse: usr="+e+" homeNodeOverride: "+b.homeNodeOverride),"anonymous"!=e&&(g.writeCookie(cnst.COOKIE_LOGIN_USR,e),g.writeCookie(cnst.COOKIE_LOGIN_PWD,c),g.writeCookie(cnst.COOKIE_LOGIN_STATE,"1")),meta64.cancelDialog(loginPg.domId),meta64.selectTab("mainTabName"),a(b),b.userPreferences.lastNode?console.log("lastNode: "+b.userPreferences.lastNode):console.log("lastNode is null."),e=null,util.emptyString(b.homeNodeOverride)?
b.userPreferences.lastNode?(console.log("loading lastNode="+b.userPreferences.lastNode),e=b.userPreferences.lastNode):(console.log("loading homeNodeId="+meta64.homeNodeId),e=meta64.homeNodeId):(console.log("loading homeNodeOverride="+b.homeNodeOverride),e=b.homeNodeOverride),view.refreshTree(e,!1),d(b)):f&&(messagePg.alert("Cookie login failed."),$.removeCookie(cnst.COOKIE_LOGIN_USR),$.removeCookie(cnst.COOKIE_LOGIN_PWD),$.writeCookie(cnst.COOKIE_LOGIN_STATE,"0"),location.reload())},c=function(a){window.location.href=
window.location.origin},e=function(a){util.checkSuccess("Change password",a)&&messagePg.alert("Password changed successfully.")},f=function(a){util.checkSuccess("Signup new user",a)&&(meta64.changePage(loginPg),loginPg.populateFromCookies(),messagePg.alert("User Information Accepted. \n\nCheck your email for signup confirmation. (Can take up to 1 minute)"))},g={twitterLogin:function(){messagePg.alert("not yet implemented.")},openSignupPg:function(){meta64.changePage(signupPg)},writeCookie:function(a,
b){$.cookie(a,b,{expires:365,path:"/"})},openLoginPg:function(){meta64.openDialog(loginPg)},signup:function(){var a=util.getInputVal("signupUserName"),b=util.getInputVal("signupPassword"),e=util.getInputVal("signupEmail"),c=util.getInputVal("signupCaptcha");util.anyEmpty(a,b,e,c)?messagePg.alert("Sorry, you cannot leave any fields blank."):util.json("signup",{userName:a,password:b,email:e,captcha:c},f)},pageInitSignupPg:function(){user.tryAnotherCaptcha()},tryAnotherCaptcha:function(){var a=util.currentTimeMillis(),
a=postTargetUrl+"captcha?t="+a;$("#captchaImage").attr("src",a)},refreshLogin:function(){console.log("refreshLogin.");var e,c,f=!1;if("true"===$("#loginSessionReady").text())console.log("    loginSessionReady = true"),c=e="",f=!0;else{console.log("    loginSessionReady = false");if("0"===$.cookie(cnst.COOKIE_LOGIN_STATE)){meta64.loadAnonPageHome(!1);return}var g=$.cookie(cnst.COOKIE_LOGIN_USR),p=$.cookie(cnst.COOKIE_LOGIN_PWD),f=!util.emptyString(g)&&!util.emptyString(p);console.log("cookieUser="+
g+" usingCookies = "+f);e=g?g:"";c=p?p:""}console.log("refreshLogin with name: "+e);var q=util.json("login",{userName:e,password:c,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime});q.completes.then(function(){if(f)b(q.response,e,c,f);else{var g=q.response;console.log("refreshLoginResponse");g.success&&(a(g),d(g));meta64.loadAnonPageHome(!1)}})},login:function(){meta64.cancelDialog(loginPg.domId);var a=util.getInputVal("userName").trim(),e=util.getInputVal("password").trim(),c=
util.json("login",{userName:a,password:e,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime});c.completes.then(function(){b(c.response,a,e)})},logout:function(a){meta64.isAnonUser||($(window).off("beforeunload"),a&&user.writeCookie(cnst.COOKIE_LOGIN_STATE,"0"),util.json("logout",{},c))},changePassword:function(){var a=util.getInputVal("changePassword1").trim(),b=util.getInputVal("changePassword2").trim();a&&4<=a.length&&a===b?util.json("changePassword",{newPassword:a},e):messagePg.alert("Invalid password(s).")}};
console.log("Module ready: user.js");return g}();console.log("running module: search.js");
var srch=function(){var d={searchPageTitle:"Search Results",timelinePageTitle:"Timeline",searchResults:null,timelineResults:null,highlightRowNode:null,identToUidMap:{},uidToNodeMap:{},numSearchResults:function(){return null!=srch.searchResults&&null!=srch.searchResults.searchResults&&null!=srch.searchResults.searchResults.length?srch.searchResults.searchResults.length:0},searchNodesResponse:function(a){d.searchResults=a;meta64.changePage(searchResultsPg)},timelineResponse:function(a){d.timelineResults=
a;meta64.changePage(timelinePg)},searchNodes:function(){if(util.ajaxReady("searchNodes")){var a=meta64.getHighlightedNode();if(a){var b=util.getInputVal("searchText").trim();util.emptyString(b)?messagePg.alert("Enter search text."):util.json("nodeSearch",{nodeId:a.id,searchText:b,modSortDesc:!1},d.searchNodesResponse)}else messagePg.alert("No node is selected to search under.")}},timeline:function(){var a=meta64.getHighlightedNode();a?util.json("nodeSearch",{nodeId:a.id,searchText:"",modSortDesc:!0},
d.timelineResponse):messagePg.alert("No node is selected to 'timeline' under.")},searchPg:function(){meta64.changePage(searchPg)},initSearchNode:function(a){a.uid=util.getUidForId(d.identToUidMap,a.id);d.uidToNodeMap[a.uid]=a},populateSearchResultsPage:function(a,b){var c="",e=a.searchResults.length,f=0;$.each(a.searchResults,function(a,b){meta64.isNodeBlackListed(b)||(d.initSearchNode(b),f++,c+=d.renderSearchResultAsListItem(b,a,e,f))});util.setHtmlEnhanced(b,c)},renderSearchResultAsListItem:function(a,
b,c,e){b=a.uid;console.log("renderSearchResult: "+b);a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");c=b+"_srch_row";e=d.makeButtonBarHtml(""+b);console.log("buttonBarHtml="+e);a=render.renderNodeContent(a,!0,!0,!0,!0);return render.tag("div",{"class":"node-table-row inactive-row",onClick:"srch.clickOnSearchResultRow(this, '"+b+"');",id:c},e+render.tag("div",{id:b+"_srch_content"},a))},makeButtonBarHtml:function(a){a=render.makeButton("Go to Node",a,"srch.clickSearchNode('"+
a+"');");return render.makeHorizontalFieldSet(a)},clickOnSearchResultRow:function(a,b){d.unhighlightRow();d.highlightRowNode=d.uidToNodeMap[b];util.changeOrAddClass(a,"inactive-row","active-row")},clickSearchNode:function(a){srch.highlightRowNode=srch.uidToNodeMap[a];view.refreshTree(srch.highlightRowNode.id,!0);meta64.selectTab("mainTabName")},unhighlightRow:function(){if(d.highlightRowNode){var a=util.domElm(d.highlightRowNode.uid+"_srch_row");a&&util.changeOrAddClass(a,"active-row","inactive-row")}}};
console.log("Module ready: search.js");return d}();console.log("running module: user.js");
var share=function(){var d=function(a){e.populateSharingPg(a)},a=function(a){srch.searchNodesResponse(a)},b=function(a,b){var e="";$.each(b.privileges,function(b,c){var d=render.makeButton("Remove","removePrivButton","share.removePrivilege('"+a+"', '"+c.privilegeName+"');"),d=render.makeHorizontalFieldSet(d),d=d+("<b>"+a+"</b> has privilege <b>"+c.privilegeName+"</b> on this node.");e+=render.tag("div",{"class":"privilege-entry"},d)});return e},c=function(a){util.json("getNodePrivileges",{nodeId:e.sharingNode.path,
includeAcl:!0,includeOwners:!0},d)},e={sharingNode:null,populateSharingPg:function(a){var c="";$.each(a.aclEntries,function(a,e){c+="<h4>User: "+e.principalName+"</h4>";c+=render.tag("div",{"class":"privilege-list"},b(e.principalName,e))});c+=render.tag("input",{type:"checkbox",name:"allowPublicCommenting",id:"allowPublicCommenting"},"",!1);c+=render.tag("label",{"for":"allowPublicCommenting"},"Allow public commenting under this node.",!0);util.setHtmlEnhanced("sharingListFieldContainer",c);util.setCheckboxVal("#allowPublicCommenting",
a.publicAppend);$("#allowPublicCommenting").bind("change",e.publicCommentingChanged)},publicCommentingChanged:function(){var a=$("#allowPublicCommenting").is(":checked");meta64.treeDirty=!0;util.json("addPrivilege",{nodeId:e.sharingNode.id,publicAppend:a?"true":"false"})},removePrivilege:function(a,b){meta64.treeDirty=!0;util.json("removePrivilege",{nodeId:e.sharingNode.id,principal:a,privilege:b},c)},shareNodeToPersonPg:function(){meta64.changePage(shareToPersonPg)},shareNodeToPerson:function(){var a=
util.getInputVal("shareToUserName");a?(meta64.treeDirty=!0,util.json("addPrivilege",{nodeId:e.sharingNode.id,principal:a,privileges:["read","write","addChildren","nodeTypeManagement"]},e.reloadFromShareWithPerson)):messagePg.alert("Please enter a username")},shareNodeToPublic:function(){console.log("Sharing node to public.");meta64.treeDirty=!0;util.json("addPrivilege",{nodeId:e.sharingNode.id,principal:"everyone",privileges:["read"]},e.reload)},editNodeSharing:function(){var a=meta64.getHighlightedNode();
a?(e.sharingNode=a,meta64.changePage(sharingPg)):messagePg.alert("No node is selected.")},reloadFromShareWithPerson:function(a){util.checkSuccess("Share Node with Person",a)&&meta64.changePage(sharingPg)},reload:function(){console.log("Loading node sharing info.");util.json("getNodePrivileges",{nodeId:e.sharingNode.id,includeAcl:!0,includeOwners:!0},d)},findSharedNodes:function(){var b=meta64.getHighlightedNode();null!=b&&(srch.searchPageTitle="Shared Nodes",util.json("getSharedNodes",{nodeId:b.id},
a))},closeSharingDlg:function(){meta64.goToMainPage()}};console.log("Module ready: share.js");return e}();console.log("running module: cnst.js");var cnst=function(){var d={ANON:"anonymous",COOKIE_LOGIN_USR:cookiePrefix+"loginUsr",COOKIE_LOGIN_PWD:cookiePrefix+"loginPwd",COOKIE_LOGIN_STATE:cookiePrefix+"loginState",BR:"<div class='vert-space'></div>",INSERT_ATTACHMENT:"{{insert-attachment}}",NEW_ON_TOOLBAR:!0,INS_ON_TOOLBAR:!0};console.log("Module ready: cnst.js");return d}();console.log("running module: meta64.js");
var meta64=function(){var d=!1,a={nextGuid:0,userName:"anonymous",deviceWidth:0,deviceHeight:0,homeNodeId:"",homeNodePath:"",isAdminUser:!1,isAnonUser:!0,anonUserLandingPageNode:null,treeDirty:!1,uidToNodeMap:{},idToNodeMap:{},nextUid:1,identToUidMap:{},parentUidToFocusNodeMap:{},editMode:!1,MODE_ADVANCED:"advanced",MODE_SIMPLE:"simple",editModeOption:"simple",showProperties:!1,simpleModeNodePrefixBlackList:{"rep:":!0},simpleModePropertyBlackList:{},readOnlyPropertyList:{},binaryPropertyList:{},fieldIdToPropMap:{},
selectedNodes:{},currentNodeData:null,currentNode:null,currentNodeUid:null,currentNodeId:null,currentNodePath:null,dialogMap:{},dataObjMap:{},dialogStack:[],updateMainMenuPanel:function(){popupMenuPg.build();popupMenuPg.init()},registerDialog:function(b){a.dialogMap[b.domId]=b},registerDataObject:function(b){b.guid=++a.nextGuid;a.dataObjMap[b.guid]=b},getObjectByGuid:function(b){var c=a.dataObjMap[b];c||console.log("data object not found: guid="+b);return c},runCallback:function(a){a=meta64.getObjectByGuid(a);
a.callback&&a.callback()},inSimpleMode:function(){return a.editModeOption===a.MODE_SIMPLE},goToMainPage:function(b,c){a.jqueryChangePage("mainTabName");c&&(a.treeDirty=!0);b||a.treeDirty?(a.treeDirty?view.refreshTree(null,!0):render.renderPageFromData(),a.refreshAllGuiEnablement()):view.scrollToSelectedNode()},selectTab:function(a){document.querySelector("#mainIronPages").select(a)},changePage:function(b,c){if("undefined"===typeof b.tabId)return console.log("oops, wrong object type passed to changePage function."),
null;if("popup"!=b.tabId){var e=document.querySelector("#mainPaperTabs");e.select(b.tabId)}if("popup"==b.tabId){null==c&&console.log("Warning: No data for popup: "+b.tabId);var e=util.polyElm("modalsContainer"),d=c?b.domId+"-"+c.guid:b.domId,g=document.createElement("paper-dialog");g.setAttribute("modal","modal");g.setAttribute("id",d);e.node.appendChild(g);Polymer.dom.flush();Polymer.updateStyles();render.buildPage(b,c);console.log("Showing dialog: "+d);e=util.polyElm(d);e.node.refit();e.node.constrain();
e.node.center();e.node.open()}else"dialogsTabName"==b.tabId?(render.buildPage(b),a.setTopDialogStackItem(b),e=document.querySelector("#dialogIronPages"),e.select(b.domId),b.visible=!0,util.setVisibility("#"+b.domId,b.visible)):render.buildPage(b)},setTopDialogStackItem:function(b){var c=a.dialogStack.indexOfObject(b);0!=c&&(-1!=c&&a.dialogStack.splice(c,1),0==a.dialogStack.length?a.dialogStack.push(b):a.dialogStack.splice(0,0,b),console.log("DialogStack: "+a.dialogPath()))},dialogPath:function(){for(var b=
"",c=0;c<a.dialogStack.length;c++)b+="/"+a.dialogStack[c].domId;return b},openDialog:function(b){return a.changePage(b)},cancelDialog:function(b){1==a.dialogStack.length&&(meta64.selectTab("mainTabName"),view.scrollToSelectedNode());var c=a.dialogMap[b];null==c?console.log("unable to find dialog page for: "+b):(b=a.dialogStack.indexOfObject(c),-1!=b&&a.dialogStack.splice(b,1),c.visible=!1,util.setVisibility("#"+c.domId,c.visible),0<a.dialogStack.length&&a.changePage(a.dialogStack[0]))},popup:function(){render.buildPage(popupMenuPg);
$("#"+popupMenuPg.domId).popup("open")},isNodeBlackListed:function(b){if(!a.inSimpleMode())return!1;for(var c in a.simpleModeNodePrefixBlackList)if(a.simpleModeNodePrefixBlackList.hasOwnProperty(c)&&b.name.startsWith(c))return!0;return!1},getSelectedNodeUidsArray:function(){var b=[],c=0,e;for(e in a.selectedNodes)a.selectedNodes.hasOwnProperty(e)&&(b[c++]=e);return b},getSelectedNodeIdsArray:function(){var b=[],c=0,e;a.selectedNodes?console.log("selectedNode count: "+a.selectedNodes.length):console.log("no selected nodes.");
for(e in a.selectedNodes)if(a.selectedNodes.hasOwnProperty(e)){var d=a.uidToNodeMap[e];d?b[c++]=d.id:console.log("unable to find uidToNodeMap for uid="+e)}return b},getSelectedNodesArray:function(){var b=[],c=0,e;for(e in a.selectedNodes)a.selectedNodes.hasOwnProperty(e)&&(b[c++]=a.uidToNodeMap[e]);return b},clearSelectedNodes:function(){a.selectedNodes={}},updateNodeInfoResponse:function(a,c){var e="",d=!1;a.owners&&$.each(a.owners,function(a,b){0<e.length&&(e+=",");b===meta64.userName&&(d=!0);e+=
b});if(0<e.length){c.owner=e;var g=$("#ownerDisplay"+c.uid);g.html(" (Manager: "+e+")");d?util.changeOrAddClass(g,"created-by-other","created-by-me"):util.changeOrAddClass(g,"created-by-me","created-by-other")}},updateNodeInfo:function(b){var c=util.json("getNodePrivileges",{nodeId:b.id,includeAcl:!1,includeOwners:!0});c.completes.then(function(){a.updateNodeInfoResponse(c.response,b)})},getNodeFromId:function(b){return a.idToNodeMap[b]},getPathOfUid:function(b){var c=a.uidToNodeMap[b];return c?c.path:
"[path error. invalid uid: "+b+"]"},getHighlightedNode:function(){return a.parentUidToFocusNodeMap[a.currentNodeUid]},highlightRowById:function(b,c){var e=a.getNodeFromId(b);e?a.highlightNode(e,c):console.log("highlightRowById failed to find id: "+b)},highlightNode:function(b,c){if(b){var e=!1,d=a.parentUidToFocusNodeMap[a.currentNodeUid];d&&(d.uid===b.uid?e=!0:(d=d.uid+"_row",d=$("#"+d),util.changeOrAddClass(d,"active-row","inactive-row")));e||(a.parentUidToFocusNodeMap[a.currentNodeUid]=b,d=b.uid+
"_row",d=$("#"+d),util.changeOrAddClass(d,"inactive-row","active-row"));c&&view.scrollToSelectedNode()}},refreshAllGuiEnablement:function(){var b=util.getPropertyCount(a.selectedNodes),c=a.getHighlightedNode();util.setEnablement("navLogoutButton",!a.isAnonUser);util.setEnablement("navLoginButton",a.isAnonUser);util.setEnablement("openSignupPgButton",a.isAnonUser);util.setEnablement("navHomeButton",!0);util.setEnablement("propsToggleButton",a.currentNode&&!a.isAnonUser);util.setEnablement("deletePropertyButton",
!a.isAnonUser);var e=a.currentNode&&!a.isAnonUser;util.setEnablement("editModeButton",e);util.setEnablement("moveSelNodesButton",!a.isAnonUser&&0<b);util.setEnablement("deleteSelNodesButton",!a.isAnonUser&&0<b);util.setEnablement("clearSelectionsButton",!a.isAnonUser&&0<b);util.setEnablement("moveSelNodesButton",!a.isAnonUser&&0<b);util.setEnablement("finishMovingSelNodesButton",!a.isAnonUser&&null!=edit.nodesToMove);util.setEnablement("changePasswordPgButton",!a.isAnonUser);util.setEnablement("accountPreferencesPgButton",
!a.isAnonUser);util.setEnablement("insertBookWarAndPeaceButton",a.isAdminUser);util.setEnablement("manageAttachmentsButton",!a.isAnonUser&&null!=c);util.setEnablement("editNodeSharingButton",!a.isAnonUser&&null!=c);util.setEnablement("renameNodePgButton",!a.isAnonUser&&null!=c);util.setEnablement("searchPgButton",!a.isAnonUser&&null!=c);util.setEnablement("timelineButton",!a.isAnonUser&&null!=c);util.setEnablement("showServerInfoButton",a.isAdminUser);util.setEnablement("showFullNodeUrlButton",null!=
c);util.setEnablement("refreshPageButton",!a.isAnonUser);util.setEnablement("findSharedNodesButton",!a.isAnonUser&&null!=c);util.setVisibility("editModeButton",e);util.setVisibility("insertBookWarAndPeaceButton",a.isAdminUser);util.setVisibility("propsToggleButton",!a.isAnonUser);util.setVisibility("openLoginPgButton",a.isAnonUser);util.setVisibility("navLogoutButton",!a.isAnonUser);util.setVisibility("openSignupPgButton",a.isAnonUser);util.setVisibility("mainMenuSearchButton",!a.isAnonUser&&null!=
c);util.setVisibility("mainMenuTimelineButton",!a.isAnonUser&&null!=c);Polymer.dom.flush();Polymer.updateStyles()},getSingleSelectedNode:function(){for(var b in a.selectedNodes)if(a.selectedNodes.hasOwnProperty(b))return a.uidToNodeMap[b];return null},getOrdinalOfNode:function(b){if(!a.currentNodeData||!a.currentNodeData.children)return-1;for(var c=0;c<a.currentNodeData.children.length;c++)if(b.id===a.currentNodeData.children[c].id)return c;return-1},setCurrentNodeData:function(b){a.currentNodeData=
b;a.currentNode=b.node;a.currentNodeUid=b.node.uid;a.currentNodeId=b.node.id;a.currentNodePath=b.node.path},anonPageLoadResponse:function(b){b.renderNodeResponse?(util.setVisibility("mainNodeContent",!0),util.setVisibility("mainNodeStatusBar",!0),render.renderPageFromData(b.renderNodeResponse),a.refreshAllGuiEnablement()):(util.setVisibility("mainNodeContent",!1),util.setVisibility("mainNodeStatusBar",!1),console.log("setting listview to: "+b.content),util.setHtmlEnhanced("listView",b.content));render.renderMainPageControls()},
removeBinaryByUid:function(b){for(var c=0;c<a.currentNodeData.children.length;c++){var e=a.currentNodeData.children[c];if(e.uid===b){e.hasBinary=!1;break}}},initNode:function(b){b?(b.uid=util.getUidForId(a.identToUidMap,b.id),b.properties=props.setPreferredPropertyOrder(b.properties),b.createdBy=props.getNodePropertyVal(jcrCnst.CREATED_BY,b),b.lastModified=props.getNodePropertyVal(jcrCnst.LAST_MODIFIED,b),a.uidToNodeMap[b.uid]=b,a.idToNodeMap[b.id]=b):console.log("initNode has null node")},initConstants:function(){util.addAll(a.simpleModePropertyBlackList,
[jcrCnst.MIXIN_TYPES,jcrCnst.PRIMARY_TYPE,jcrCnst.POLICY,jcrCnst.IMG_WIDTH,jcrCnst.IMG_HEIGHT,jcrCnst.BIN_VER,jcrCnst.BIN_DATA,jcrCnst.BIN_MIME,jcrCnst.COMMENT_BY,jcrCnst.PUBLIC_APPEND]);util.addAll(a.readOnlyPropertyList,[jcrCnst.PRIMARY_TYPE,jcrCnst.UUID,jcrCnst.MIXIN_TYPES,jcrCnst.CREATED,jcrCnst.CREATED_BY,jcrCnst.LAST_MODIFIED,jcrCnst.LAST_MODIFIED_BY,jcrCnst.IMG_WIDTH,jcrCnst.IMG_HEIGHT,jcrCnst.BIN_VER,jcrCnst.BIN_DATA,jcrCnst.BIN_MIME,jcrCnst.COMMENT_BY,jcrCnst.PUBLIC_APPEND]);util.addAll(a.binaryPropertyList,
[jcrCnst.BIN_DATA])},initApp:function(){d||(console.log("initApp running."),d=!0,a.initConstants(),a.displaySignupMessage(),$(window).bind("beforeunload",function(){return"Leave Meta64 ?"}),a.deviceWidth=$(window).width(),a.deviceHeight=$(window).height(),user.refreshLogin(),a.updateMainMenuPanel(),a.refreshAllGuiEnablement())},displaySignupMessage:function(){"ok"===$("#signupCodeResponse").text()&&messagePg.alert("Signup complete. You may now login.")},screenSizeChange:function(){a.currentNodeData&&
(meta64.currentNode.imgId&&render.adjustImageSize(meta64.currentNode),$.each(a.currentNodeData.children,function(a,c){c.imgId&&render.adjustImageSize(c)}))},orientationHandler:function(a){},loadAnonPageHome:function(b){util.json("anonPageLoad",{ignoreUrl:b},a.anonPageLoadResponse)}};console.log("Module ready: meta64.js");return a}();console.log("running module: util.js");
var util=function(){var d=!1,a=!1;Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)});"function"!=typeof String.prototype.contains&&(String.prototype.contains=function(a){return-1!=
this.indexOf(a)});"function"!=typeof String.prototype.replaceAll&&(String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),b)});"function"!=typeof String.prototype.escapeForAttrib&&(String.prototype.escapeForAttrib=function(){return this.replaceAll('"',"&quot;")});"function"!=typeof Array.prototype.indexOfObject&&(Array.prototype.indexOfObject=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1});var b=0,
c={daylightSavingsTime:(new Date).dst()?!0:!1,inherit:function(a,b){b.prototype=Object.create(a.prototype)},json:function(e,c,g){if(a)console.log("offline: ignoring call for "+e);else{var h=Polymer.dom(this.root).querySelector("#ironAjax");h.url=postTargetUrl+e;h.verbose=!0;h.body=JSON.stringify(c);h.method="POST";h.contentType="application/json";h.handleAs="json";h.debounceDuration="300";b++;var l=h.generateRequest();l.completes.then(function(){b--;"function"==typeof g&&g(l.response)},function(){b--;
console.log("Error in util.json");if("403"==l.status)console.log("Not logged in detected in util."),a=!0,d||(d=!0,messagePg.alert("Session timed out. Page will refresh.")),$(window).off("beforeunload"),window.location.href=window.location.origin;else{var e="Server request failed.\n\n";try{e+="Status: "+l.statusText+"\n",e+="Code: "+l.status+"\n"}catch(c){}messagePg.alert(e)}});return l}},ajaxReady:function(a){return 0<b?(console.log("Ignoring requests: "+a+". Ajax currently in progress."),!1):!0},
isAjaxWaiting:function(){return 0<b},delayedFocus:function(a){setTimeout(function(){$(a).focus()},1E3)},checkSuccess:function(a,b){b.success||messagePg.alert(a+" failed: "+b.message);return b.success},addAll:function(a,b){for(var c=0;c<b.length;c++)b[c]?a[b[c]]=!0:console.error("null element in addAll at idx="+c)},nullOrUndef:function(a){return null===a||void 0===a},getUidForId:function(a,b){var c=a[b];c||(c=meta64.nextUid++,a[b]=c);return c},elementExists:function(a){a.startsWith("#")&&(a=a.substring(1));
return a.contains("#")?(console.log("Invalid # in domElm"),null):null!=document.getElementById(a)},getTextAreaValById:function(a){return c.domElm(a).value},domElm:function(a){a.startsWith("#")&&(a=a.substring(1));if(a.contains("#"))return console.log("Invalid # in domElm"),null;var b=document.getElementById(a);b&&0!=b.length||console.log("domElm Error. Required element id not found: "+a);return b},polyElm:function(a){a.startsWith("#")&&(a=a.substring(1));if(a.contains("#"))return console.log("Invalid # in domElm"),
null;var b=document.getElementById(a);b&&0!=b.length||console.log("domElm Error. Required element id not found: "+a);return Polymer.dom(b)},getRequiredElement:function(a){var b=$(a);null==b&&console.log("getRequiredElement. Required element id not found: "+a);return b},setCheckboxVal:function(a,b){$(a).prop("checked",b).checkboxradio("refresh")},isObject:function(a){return a&&0!=a.length},currentTimeMillis:function(){return(new Date).getMilliseconds()},emptyString:function(a){return!a||0==a.length},
getInputVal:function(a){return c.polyElm(a).node.value},setInputVal:function(a,b){null==b&&(b="");var d=c.polyElm(a);d&&(d.node.value=b);return null!=d},bindEnterKey:function(a,b){c.bindKey(a,b,13)},bindKey:function(a,b,c){$(a).keypress(function(a){if(a.which==c)return b(),!1})},anyEmpty:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!b||0==b.length)return!0}return!1},changeOrAddClass:function(a,b,c){a=$(a);a.toggleClass(b,!1);a.toggleClass(c,!0)},verifyType:function(a,b,c){return typeof a!==
b?(messagePg.alert(c),!1):!0},setHtmlEnhanced:function(a,b){null==b&&(b="");var d=c.domElm(a);Polymer.dom(d).node.innerHTML=b;Polymer.dom.flush();Polymer.updateStyles()},setHtml:function(a,b){null==b&&(b="");var d=c.domElm(a);Polymer.dom(d).node.innerHTML=b},getPropertyCount:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},printObject:function(a){var b="";$.each(a,function(a,c){b+=a+" , "+c+"\n"});return b},printProperties:function(a){if(a){var b="";$.each(a,function(a,c){b+=a+
"\n"});return b}console.error("printProperties recieved null.")},printKeys:function(a){var b="";$.each(a,function(a,c){0<b.length&&(b+=",");b+=a});return b},setEnablement:function(a,b){var d=null,d="string"==typeof a?c.domElm(a):a;null==d?console.log("setVisibility couldn't find item: "+a):d.disabled=b?!1:!0},setVisibility:function(a,b){var d=null,d="string"==typeof a?c.domElm(a):a;null==d?console.log("setVisibility couldn't find item: "+a):d.style.display=b?"block":"none"}};console.log("Module ready: util.js");
return c}();console.log("running module: searchResultsPg.js");var searchResultsPg=function(){var d={domId:"searchResultsPg",tabId:"searchTabName",visible:!1,build:function(){util.setHtmlEnhanced(d.domId,"<h2 id='searchPageTitle'></h2><div id='searchResultsView'></div>")},init:function(){$("#searchPageTitle").html(srch.searchPageTitle);srch.populateSearchResultsPage(srch.searchResults,"searchResultsView")}};console.log("Module ready: searchResultsPg.js");return d}();console.log("running module: prefsPg.js");
var prefsPg=function(){var d={domId:"prefsPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Account Peferences"),b=render.makeRadioButton("Simple","editModeSimple")+render.makeRadioButton("Advanced","editModeAdvanced"),b=render.tag("paper-radio-group",{id:"simpleModeRadioGroup",selected:"editModeSimple"},b),b=render.makeHorzControlGroup("<legend>Edit Mode:</legend>"+b),c=render.makeButton("Save","savePreferencesButton","prefs.savePreferences();"),e=render.makeBackButton("Cancel",
"cancelPreferencesPgButton",d.domId),c=render.centeredButtonBar(c+e),e=render.makeButton("Close Account","closeAccountButton","prefs.closeAccount();"),e=render.centeredButtonBar(e),e=render.tag("div",{"class":"close-account-bar"},e),b=render.tag("div",{},b+c),b=render.tag("div",{},""+b);util.setHtmlEnhanced(d.domId,a+b+e)}};console.log("Module ready: prefsPg.js");return d}();console.log("running module: confirmPg.js");
var confirmPg=function(){var d={domId:"confirmPg",tabId:"popup",areYouSure:function(a,b,c,d){var f={};f.title=a;f.message=b;f.buttonText=c;f.callback=d;meta64.registerDataObject(f);meta64.changePage(confirmPg,f)},build:function(a){var b="<h2 id='confirmPgTitle-"+a.guid+"'></h2><p id='confirmPgMessage-"+a.guid+"'></p>",c=render.makePopupBackButton("Yes","confirmPgYesButton-"+a.guid,d.domId,"meta64.runCallback("+a.guid+");")+render.makePopupBackButton("No","confirmPgNoButton-"+a.guid,d.domId),b=b+render.centeredButtonBar(c);
util.setHtmlEnhanced(d.domId+"-"+a.guid,b)},init:function(a){util.setHtml("confirmPgTitle-"+a.guid,a.title);util.setHtml("confirmPgMessage-"+a.guid,a.message);util.setHtml("confirmPgYesButton-"+a.guid,a.buttonText)}};console.log("Module ready: confirmPg.js");return d}();console.log("running module: popupMenuPg.js");
var popupMenuPg=function(){function d(a,b){return render.tag("paper-submenu",{},"<paper-item class='menu-trigger'>"+a+"</paper-item>"+render.tag("paper-menu",{"class":"menu-content my-menu-section",multi:"multi"},b,!0),!0)}function a(a,b,d){return render.tag("paper-item",{id:b,onclick:d},a,!0)}var b={domId:"mainNavBar",build:function(){var c=a("Attachments","manageAttachmentsButton","attachment.openUploadPg();")+a("Move","moveSelNodesButton","edit.moveSelNodes();")+a("Finish Moving","finishMovingSelNodesButton",
"edit.finishMovingSelNodes();")+a("Rename","renameNodePgButton","edit.openRenameNodePg();")+a("Delete","deleteSelNodesButton","edit.deleteSelNodes();")+a("Clear Selections","clearSelectionsButton","edit.clearSelections();"),c=d("Edit",c),e=a("Edit Node Sharing","editNodeSharingButton","share.editNodeSharing();")+a("Find Shared Subnodes","findSharedNodesButton","share.findSharedNodes();"),e=d("Sharing",e),f=a("Text Search","searchPgButton","srch.searchPg();")+a("Timeline","timelineButton","srch.timeline();"),
f=d("Search",f),g=render.tag("paper-item",{id:"propsToggleButton",onclick:"props.propsToggle();"},"Toggle Properties",!0)+a("Refresh","refreshPageButton","meta64.goToMainPage(true,true);")+a("Show URL","showFullNodeUrlButton","render.showNodeUrl();")+a("Server Info","showServerInfoButton","view.showServerInfo();"),g=d("View Options",g),h=a("Change Password","changePasswordPgButton","(new ChangePasswordDlg()).open();")+a("Preferences","accountPreferencesPgButton","prefs.accountPreferencesPg();")+a("Insert Book: War and Peace",
"insertBookWarAndPeaceButton"," edit.insertBookWarAndPeace();")+a("Donate","donatePgButton","donatePg.open();"),h=d("My Account",h);util.setHtmlEnhanced(b.domId,c+e+g+f+h)},init:function(){meta64.refreshAllGuiEnablement()}};console.log("Module ready: popupMenuPg.js");return b}();console.log("running module: donatePg.js");var donatePg=function(){var d={domId:"donatePg",tabId:"popup",open:function(){var a={};meta64.registerDataObject(a);meta64.changePage(donatePg,a)},build:function(a){var b;b="<donate-panel></donate-panel>"+render.centeredButtonBar(render.makePopupBackButton("Close","donatePgCloseButton-"+a.guid,d.domId));console.log("fields="+b);util.setHtmlEnhanced(d.domId+"-"+a.guid,b)},init:function(a){}};console.log("Module ready: donatePg.js");return d}();console.log("running module: editPropertyPg.js");
var editPropertyPg=function(){var d={domId:"editPropertyPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Edit Node Property"),b=render.makeBackButton("Save","savePropertyButton",d.domId,"props.saveProperty();"),c=render.makeBackButton("Cancel","editPropertyPgCloseButton",d.domId),b=render.centeredButtonBar(b+c);util.setHtmlEnhanced(d.domId,a+("<div id='editPropertyPathDisplay' class='path-display-in-editor'></div><div id='addPropertyFieldContainer' class='ui-field-contain'></div>"+b))},
init:function(){props.populatePropertyEdit()}};console.log("Module ready: editPropertyPg.js");return d}();console.log("running module: exportPg.js");
var exportPg=function(){var d={domId:"exportPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Export to XML"),b=render.makeEditField("Export to File Name","exportTargetNodeName"),c=render.makeButton("Export","exportNodesButton"),e=render.makeBackButton("Close","cancelExportButton",d.domId),c=render.centeredButtonBar(c+e);util.setHtmlEnhanced(d.domId,a+(""+(b+c)));$("#exportNodesButton").on("click",edit.exportNodes)}};console.log("Module ready: exportPg.js");return d}();console.log("running module: renameNodePg.js");
var renameNodePg=function(){var d={domId:"renameNodePg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Rename Node"),b=render.makeEditField("Enter new name for the node","newNodeNameEditField"),c=render.makeButton("Rename","renameNodeButton","edit.renameNode();"),e=render.makeBackButton("Close","cancelRenameNodeButton",d.domId),c=render.centeredButtonBar(c+e);util.setHtmlEnhanced(d.domId,a+("<h3 id='curNodeNameDisplay'></h3>"+(b+c)))},init:function(){var a=meta64.getHighlightedNode();
a&&$("#curNodeNameDisplay").html("Path: "+a.path+"<br/>Name: "+a.name)}};console.log("Module ready: renameNodePg.js");return d}();console.log("running module: sharingPg.js");
var sharingPg=function(){var d={domId:"sharingPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Node Sharing"),b=render.makeButton("Share with Person","shareNodeToPersonPgButton","share.shareNodeToPersonPg();"),c=render.makeButton("Share to Public","shareNodeToPublicButton","share.shareNodeToPublic();"),e=render.makeBackButton("Close","closeSharingButton",d.domId,"share.closeSharingDlg();"),b=render.centeredButtonBar(b+c+e);util.setHtmlEnhanced(d.domId,a+("<div id='shareNodeNameDisplay'></div><div id='sharingListFieldContainer'></div>"+
b))},init:function(){share.reload()}};console.log("Module ready: sharingPg.js");return d}();console.log("running module: importPg.js");
var importPg=function(){var d={domId:"importPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Import from XML"),b=render.makeEditField("Import Target Node Name","importTargetNodeName"),c=render.makeButton("Import","importNodesButton"),e=render.makeBackButton("Close","cancelImportButton",d.domId),c=render.centeredButtonBar(c+e);util.setHtmlEnhanced(d.domId,a+(""+(b+c)));$("#importNodesButton").on("click",edit.importNodes)}};console.log("Module ready: importPg.js");
return d}();console.log("running module: uploadPg.js");
var uploadPg=function(){var d={domId:"uploadPg",tabId:"dialogsTabName",visible:!1,build:function(){for(var a=render.makeDialogHeader("Upload File Attachment"),b=render.tag("div",{id:"uploadPathDisplay","class":"path-display-in-editor"},""),c="",e=0;7>e;e++)var f=render.tag("input",{type:"file",name:"files"},"",!0),c=c+render.tag("div",{style:"margin-bottom: 10px;"},f);var c=c+render.tag("input",{id:"uploadFormNodeId",type:"hidden",name:"nodeId"},"",!0),c=render.tag("form",{id:"uploadForm",method:"POST",
enctype:"multipart/form-data","data-ajax":"false"},c),c=render.tag("div",{id:"uploadFieldContainer"},"<p>Upload from your computer</p>"+c),e=render.makeEditField("Upload From URL","uploadFromUrl"),e=render.tag("div",{},e),f=render.makeButton("Upload","uploadButton","attachment.uploadFileNow();"),g=render.makeButton("Delete","deleteAttachmentButton","attachment.deleteAttachment();"),h=render.makeBackButton("Close","closeUploadButton",d.domId),f=render.centeredButtonBar(f+g+h);util.setHtmlEnhanced(d.domId,
a+(b+c+"<div><h3>-- OR --</h3>Enter URL to a file on the web...</div>"+e+f))},init:function(){util.setInputVal("uploadFromUrl","");$("#uploadPathDisplay").html("Path: "+render.formatPath(attachment.uploadNode))}};console.log("Module ready: uploadPg.js");return d}();console.log("running module: shareToPersonPg.js");
var shareToPersonPg=function(){var d={domId:"shareToPersonPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Share Node to Person"),b=render.makeEditField("User to Share With","shareToUserName"),c=render.makeBackButton("Share","shareNodeToPersonButton",d.domId,"share.shareNodeToPerson();"),e=render.makeBackButton("Close","cancelShareNodeToPersonButton",d.domId),c=render.centeredButtonBar(c+e);util.setHtmlEnhanced(d.domId,a+("Enter the username of the person you want to share this node with:"+
(b+c)))}};console.log("Module ready: shareToPersonPg.js");return d}();console.log("running module: signupPg.js");
var signupPg=function(){var d={domId:"signupPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader(BRANDING_TITLE+" Signup"),b=render.makeEditField("User","signupUserName")+render.makePasswordField("Password","signupPassword")+render.makeEditField("Email","signupEmail")+render.makeEditField("Captcha","signupCaptcha"),c=render.tag("div",{"class":"captcha-image"},render.tag("img",{id:"captchaImage","class":"captcha",src:""},"",!1)),e=render.makeButton("Signup","signupButton",
"user.signup();"),f=render.makeButton("Try Different Image","tryAnotherCaptchaButton","user.tryAnotherCaptcha();"),g=render.makeBackButton("Close","cancelSignupButton",d.domId),e=render.centeredButtonBar(e+f+g),b=render.tag("div",{id:d.domId+"-main"},b+c+e);util.setHtmlEnhanced(d.domId,a+b)},init:function(){user.pageInitSignupPg();util.delayedFocus("#signupUserName")}};console.log("Module ready: signupPg.js");return d}();console.log("running module: timelinePg.js");var timelinePg=function(){var d={domId:"timelinePg",tabId:"timelineTabName",visible:!1,build:function(){util.setHtmlEnhanced(d.domId,"<h2 id='timelinePageTitle'></h2><div id='timelineView'></div>")},init:function(){$("#timelinePageTitle").html(srch.timelinePageTitle);srch.populateSearchResultsPage(srch.timelineResults,"timelineView")}};console.log("Module ready: timelinePg.js");return d}();console.log("running module: ChangePasswordDlg.js");var ChangePasswordDlg=function(){Dialog.call(this);this.domId="ChangePasswordDlg"};ChangePasswordDlg.prototype.constructor=ChangePasswordDlg;util.inherit(Dialog,ChangePasswordDlg);
ChangePasswordDlg.prototype.build=function(){var d=render.makeDialogHeader("Change Password"),a=this.makePasswordField("Password","changePassword1")+this.makePasswordField("Repeat Password","changePassword2"),b=this.makeCloseButton("Change Password","changePasswordActionButton","user.changePassword();"),c=this.makeCloseButton("Close","cancelChangePasswordButton"),b=render.centeredButtonBar(b+c);return d+a+b};ChangePasswordDlg.prototype.init=function(){};console.log("running module: loginPg.js");
var loginPg=function(){var d={domId:"loginPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Login"),b=render.makeEditField("User","userName")+render.makePasswordField("Password","password"),c=render.makeButton("Login","loginButton","user.login();"),e=render.makeBackButton("Close","cancelLoginButton",d.domId),c=render.centeredButtonBar(c+e),e=render.makeButton("Twitter","twitterLoginButton","user.twitterLogin();");render.makeHorzControlGroup(e);util.setHtmlEnhanced(d.domId,
a+(b+c));util.bindEnterKey("#userName",user.login);util.bindEnterKey("#password",user.login)},init:function(){d.populateFromCookies()},populateFromCookies:function(){var a=$.cookie(cnst.COOKIE_LOGIN_USR),b=$.cookie(cnst.COOKIE_LOGIN_PWD);a&&util.setInputVal("userName",a);b&&util.setInputVal("password",b)}};console.log("Module ready: loginPg.js");return d}();console.log("running module: editNodePg.js");
var editNodePg=function(){var d={domId:"editNodePg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Edit Node"),b=render.makeBackButton("Save","saveNodeButton",d.domId,"edit.saveNode();"),c=render.makeButton("Add Property","addPropertyButton","props.addProperty();"),e=render.makeButton("Make Node Referencable","makeNodeReferencableButton","edit.makeNodeReferencable();"),f=render.makeButton("Split Content","splitContentButton","edit.splitContent();"),g=render.makeBackButton("Close",
"cancelEditButton",d.domId,"edit.cancelEdit();"),b=render.centeredButtonBar(b+c+e+f+g);util.setHtmlEnhanced(d.domId,a+"<div id='editNodePathDisplay' class='path-display-in-editor'></div><div id='editNodeInstructions'></div><div id='propertyEditFieldContainer'>Loading propertyEditFieldContainer...</div>"+b)},init:function(){edit.populateEditNodePg()}};console.log("Module ready: editNodePg.js");return d}();console.log("running module: ConfirmDlg.js");var ConfirmDlg=function(d,a,b,c){Dialog.call(this);this.domId="ConfirmDlg";this.title=d;this.message=a;this.buttonText=b;this.callback=c;meta64.registerDataObject(this.callback);alert("function guid: "+this.callback.guid)};ConfirmDlg.prototype.constructor=ConfirmDlg;util.inherit(Dialog,ConfirmDlg);
ConfirmDlg.prototype.build=function(){var d="<h2 id='"+this.id("ConfirmDlgTitle")+"'></h2><p id='"+this.id("ConfirmDlgMessage")+"'></p>",a=this.makeCloseButton("Yes","ConfirmDlgYesButton","meta64.runCallback("+this.callback.guid+");")+this.makeCloseButton("No","ConfirmDlgNoButton");return d+=render.centeredButtonBar(a)};ConfirmDlg.prototype.init=function(){this.setHtml(this.title,"ConfirmDlgTitle");this.setHtml(this.message,"ConfirmDlgMessage");this.setHtml(this.buttonText,"ConfirmDlgYesButton")};console.log("running module: Dialog.js");var Dialog=function(){this.data={};meta64.registerDataObject(this.data)};Dialog.prototype.constructor=Dialog;
Dialog.prototype.open=function(){var d=util.polyElm("modalsContainer"),a=this.domId+"-"+this.data.guid,b=document.createElement("paper-dialog");b.setAttribute("modal","modal");b.setAttribute("id",a);d.node.appendChild(b);Polymer.dom.flush();Polymer.updateStyles();d=this.build();util.setHtmlEnhanced(this.domId+"-"+this.data.guid,d);this.built=!0;this.init&&this.init();console.log("Showing dialog: "+a);a=util.polyElm(a);a.node.refit();a.node.constrain();a.node.center();a.node.open()};
Dialog.prototype.id=function(d){return d+"-"+this.data.guid};Dialog.prototype.makePasswordField=function(d,a){return render.makePasswordField(d,this.id(a))};Dialog.prototype.makeCloseButton=function(d,a,b){void 0===b&&(b="");return render.tag("paper-button",{raised:"raised","dialog-confirm":"dialog-confirm",id:this.id(a),onClick:b},d,!0)};Dialog.prototype.setHtml=function(d,a){util.setHtml(this.id(a),d)};console.log("running module: messagePg.js");
var messagePg=function(){var d={domId:"messagePg",tabId:"popup",alert:function(a){d.showMessage(null,a,null)},showMessage:function(a,b,c){var d={};d.title=a;d.message=b;d.callback=c;meta64.registerDataObject(d);meta64.changePage(messagePg,d)},build:function(a){var b="<h2 id='messagePgTitle-"+a.guid+"'></h2><p id='messagePgMessage-"+a.guid+"'></p>",b=b+render.centeredButtonBar(render.makePopupBackButton("Ok","messagePgOkButton-"+a.guid,d.domId,"meta64.runCallback("+a.guid+");"));util.setHtmlEnhanced(d.domId+
"-"+a.guid,b)},init:function(a){a.title&&util.setHtml("messagePgTitle-"+a.guid,a.title);util.setHtml("messagePgMessage-"+a.guid,a.message)}};console.log("Module ready: messagePg.js");return d}();console.log("running module: searchPg.js");
var searchPg=function(){var d={domId:"searchPg",tabId:"dialogsTabName",visible:!1,build:function(){var a=render.makeDialogHeader("Search"),b=render.makeEditField("Search","searchText"),c=render.makeButton("Search","searchNodesButton","srch.searchNodes();"),e=render.makeBackButton("Close","cancelSearchButton",d.domId),c=render.centeredButtonBar(c+e);util.setHtmlEnhanced(d.domId,a+(""+(b+c)));util.bindEnterKey("#searchText",srch.searchNodes)},init:function(){util.delayedFocus("#searchText")}};console.log("Module ready: searchPg.js");
return d}();console.log("running module: props.js");
var props=function(){var d=function(a){util.checkSuccess("Save properties",a);edit.editNode.properties.push(a.propertySaved);meta64.changePage(editNodePg);meta64.treeDirty=!0},a={propsToggle:function(){meta64.showProperties=meta64.showProperties?!1:!0;render.renderPageFromData();view.scrollToSelectedNode();meta64.selectTab("mainTabName")},deleteProperty:function(b){(new ConfirmDlg("Confirm Delete","Delete the Property","Yes, delete.",function(){a.deletePropertyImmediate(b)})).open()},deletePropertyImmediate:function(a){var c=
util.json("deleteProperty",{nodeId:edit.editNode.id,propName:a});c.completes.then(function(){util.checkSuccess("Delete property",c.response)&&(props.deletePropertyFromLocalData(a),meta64.changePage(editNodePg),meta64.treeDirty=!0)})},addProperty:function(){meta64.changePage(editPropertyPg)},populatePropertyEdit:function(){var a;a=""+render.tag("paper-textarea",{name:"addPropertyNameTextContent",id:"addPropertyNameTextContent",placeholder:"Enter property name",label:"Name"},"",!0);a+=render.tag("paper-textarea",
{name:"addPropertyValueTextContent",id:"addPropertyValueTextContent",placeholder:"Enter property text",label:"Value"},"",!0);view.initEditPathDisplayById("#editPropertyPathDisplay");util.setHtmlEnhanced("addPropertyFieldContainer",a)},saveProperty:function(){var a=util.getInputVal("addPropertyNameTextContent"),c=util.getInputVal("addPropertyValueTextContent");util.json("saveProperty",{nodeId:edit.editNode.id,propertyName:a,propertyValue:c},d)},addSubProperty:function(a){a=meta64.fieldIdToPropMap[a];
util.isObject(a.values)||(a.values=[],a.values.push(a.value),a.value=null);a.values.push("");edit.populateEditNodePg()},clearProperty:function(a){util.setInputVal(a,"");for(var c=0;1E3>c&&util.setInputVal(a+"_subProp"+c,"");)c++},deletePropertyFromLocalData:function(a){for(var c=0;c<edit.editNode.properties.length;c++)if(a===edit.editNode.properties[c].name){edit.editNode.properties.splice(c,1);break}},makeMultiPropEditor:function(a,c,d,f){console.log("************* Making Multi Editor: Property multi-type: name="+
c.name+" count="+c.values.length);var g="",h=c.values;h&&0!=h.length||(h=[],h.push(""));for(var l=0;l<h.length;l++){console.log("prop multi-val["+l+"]="+h[l]);var m=a+"_subProp"+l,n=f?"[binary]":h[l],p=n?n:"",p=n.escapeForAttrib(),n=(0==l?c.name:"*")+"."+l;console.log("Creating textarea with id="+m);g=f||d?g+render.tag("paper-textarea",{id:m,readonly:"readonly",disabled:"disabled",label:n,value:p},"",!0):g+render.tag("paper-textarea",{id:m,label:n,value:p},"",!0)}return g},makeSinglePropEditor:function(a,
c,d,f){console.log("Property single-type: "+c.name);var g="",h=f?"[binary]":c.value,l=render.sanitizePropertyName(c.name),h=(h?h:"").escapeForAttrib();console.log("editing: prop["+c.name+"] val["+c.val+"]");return g=d||f?g+render.tag("paper-textarea",{id:a,readonly:"readonly",disabled:"disabled",label:l,value:h},"",!0):g+render.tag("paper-textarea",{id:a,label:l,value:h},"",!0)},setPreferredPropertyOrder:function(a){if(a){var c=[];$.each(a,function(a,b){b.name===jcrCnst.CONTENT?c.unshift(b):c.push(b)});
return c}},renderProperties:function(a){if(a){var c="<table class='property-text'>",d=0,c=c+"<thead><tr><th></th><th></th></tr></thead>",c=c+"<tbody>";$.each(a,function(a,b){if(render.allowPropertyToDisplay(b.name)){var h=render.isBinaryProperty(b.name);d++;c+="<tr class='prop-table-row'>";c+="<td class='prop-table-name-col'>"+render.sanitizePropertyName(b.name)+"</td>";c=h?c+"<td class='prop-table-val-col'>[binary]</td>":b.values?c+("<td class='prop-table-val-col'>"+props.renderPropertyValues(b.values)+
"</td>"):c+("<td class='prop-table-val-col'>"+render.wrapHtml(b.htmlValue?b.htmlValue:b.value)+"</td>");c+="</tr>"}else console.log("Hiding property: "+b.name)});return 0==d?"":c+="</tbody></table>"}},getNodeProperty:function(a,c){if(!c||!c.properties)return null;for(var d=0;d<c.properties.length;d++){var f=c.properties[d];if(f.name===a)return f}return null},getNodePropertyVal:function(b,c){var d=a.getNodeProperty(b,c);return d?d.value:null},isNonOwnedNode:function(b){b=a.getNodePropertyVal(jcrCnst.CREATED_BY,
b);return null!=b&&b!=meta64.userName},isNonOwnedCommentNode:function(b){b=a.getNodePropertyVal(jcrCnst.COMMENT_BY,b);return null!=b&&b!=meta64.userName},renderProperty:function(b){return b.values?a.renderPropertyValues(b.values):b.value&&0!=b.value.length?render.wrapHtml(b.htmlValue):""},renderPropertyValues:function(a){var c="<div>";$.each(a,function(a,b){c+=render.wrapHtml(b)+cnst.BR});return c+="</div>"}};console.log("Module ready: props.js");return a}();console.log("running module: render.js");
var render=function(){var d={buildPage:function(a,b){console.log("buildPage: pg.domId="+a.domId);if(!a.built||b)a.build(b),a.built=!0;b||meta64.registerDialog(a);a.init&&a.init(b)},renderNodeContent:function(a,b,c,e,f){var g="",h;h=""+d.getTopRightImageTag(a);var l=props.getNodePropertyVal(jcrCnst.COMMENT_BY,a);b=!0;g+="<div class='path-display'>Path: "+d.formatPath(a)+"</div>";g+="<div>";if(l)var m=l===meta64.userName?"created-by-me":"created-by-other",g=g+("<span class='"+m+"'>Comment By: "+l+"</span>");
else a.createdBy&&(m=a.createdBy===meta64.userName?"created-by-me":"created-by-other",g+="<span class='"+m+"'>Created By: "+a.createdBy+"</span>");g+="<span id='ownerDisplay"+a.uid+"'></span>";a.lastModified&&(g+="  Modified: "+a.lastModified);g+="</div>";c&&!b&&a.name&&(g+="Name: "+a.name+" [uid="+a.uid+"]");g&&(h+=d.tag("div",{"class":"header-text"},g));if(meta64.showProperties)(f=props.renderProperties(a.properties))&&(h+=f);else if(b=props.getNodeProperty(jcrCnst.CONTENT,a))b=props.renderProperty(b),
0<b.length&&(h=f?h+d.tag("div",{"class":"jcr-content"},b):h+d.tag("div",{"class":"jcr-root-content"},b));e&&a.hasBinary&&(a.binaryIsImage?e=d.makeImageTag(a):(e=d.tag("a",{href:d.getUrlForNodeAttachment(a)},"[Download Attachment]"),e=d.tag("div",{"class":"binary-link"},e)),h=h.contains(cnst.INSERT_ATTACHMENT)?h.replaceAll(cnst.INSERT_ATTACHMENT,e):h+e);l&&l!=meta64.userName?(a=d.tag("a",{onClick:"edit.replyToComment('"+a.uid+"');"},"Reply"),h+=a):props.getNodePropertyVal(jcrCnst.PUBLIC_APPEND,a)&&
l!=meta64.userName&&(a=d.tag("a",{onClick:"edit.replyToComment('"+a.uid+"');"},"Add Comment"),a=d.tag("div",{},a),h+=a);return h},renderNodeAsListItem:function(a,b,c,e){var f=a.uid;e=0<b&&1<e;b=b<c-1;c=a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");var g=(meta64.isAdminUser||!c)&&!props.isNonOwnedCommentNode(a)&&!props.isNonOwnedNode(a);c=(c=meta64.getHighlightedNode())&&c.uid===f;e=d.makeRowButtonBarHtml(f,e,b,g);b=d.getNodeBkgImageStyle(a);return d.tag("div",{"class":"node-table-row"+
(c?" active-row":" inactive-row"),onClick:"nav.clickOnNodeRow(this, '"+f+"');",id:f+"_row",style:b},e+d.tag("div",{id:f+"_content"},d.renderNodeContent(a,!0,!0,!0,!0)))},showNodeUrl:function(){var a=meta64.getHighlightedNode();if(a){var b=window.location.origin+"?id="+a.path;meta64.selectTab("mainTabName");b="URL using path: <br>"+b;(a=props.getNodePropertyVal("jcr:uuid",a))&&(b+="<p>URL for UUID: <br>"+window.location.origin+"?id="+a);messagePg.showMessage("URL of Node",b)}else messagePg.alert("You must first click on a node.")},
getTopRightImageTag:function(a){a=props.getNodePropertyVal("img.top.right",a);var b="";a&&(b=d.tag("img",{src:a,"class":"top-right-image"},"",!1));return b},getNodeBkgImageStyle:function(a){a=props.getNodePropertyVal("img.node.bkg",a);var b="";a&&(b="background-image: url("+a+");");return b},centeredButtonBar:function(a){return d.tag("div",{"class":"horizontal center-justified layout"},a)},makeRowButtonBarHtml:function(a,b,c,e){var f=selButton=createSubNodeButton=editNodeButton=moveNodeUpButton=moveNodeDownButton=
insertNodeButton="";d.nodeHasChildren(a)&&(f=d.tag("paper-button",{"class":"highlight-button",raised:"raised",onClick:"nav.openNode('"+a+"');"},"Open"));if(meta64.editMode){var g=1==meta64.selectedNodes[a]?"true":"false";console.log("      nodeId "+a+" selected="+g);selButton=d.tag("paper-button",{"class":"custom-toggle",toggles:"toggles",raised:"raised",id:a+"_sel",onClick:"nav.toggleNodeSel('"+a+"');",active:g},"Sel");cnst.NEW_ON_TOOLBAR&&(createSubNodeButton=d.tag("paper-button",{raised:"raised",
onClick:"edit.createSubNode('"+a+"');"},"Add"));cnst.INS_ON_TOOLBAR&&(insertNodeButton=d.tag("paper-button",{raised:"raised",onClick:"edit.insertNode('"+a+"');"},"Ins"))}meta64.editMode&&e&&(editNodeButton=d.tag("paper-button",{raised:"raised",onClick:"edit.runEditNode('"+a+"');"},"Edit"),meta64.currentNode.childrenOrdered&&(b&&(moveNodeUpButton=d.tag("paper-button",{raised:"raised",onClick:"edit.moveNodeUp('"+a+"');"},"Up")),c&&(moveNodeDownButton=d.tag("paper-button",{raised:"raised",onClick:"edit.moveNodeDown('"+
a+"');"},"Dn"))));a=selButton+f+insertNodeButton+createSubNodeButton+editNodeButton+moveNodeUpButton+moveNodeDownButton;return 0<a.length?d.makeHorizontalFieldSet(a):""},makeDialogHeader:function(a){return d.tag("h2",{},a)},makeHorizontalFieldSet:function(a,b){return d.tag("div",{"class":"horizontal layout"+(b?" "+b:"")},a,!0)},makeHorzControlGroup:function(a){return d.tag("div",{"class":"horizontal layout"},a,!0)},makeRadioButton:function(a,b){return d.tag("paper-radio-button",{id:b,name:b},a)},
nodeHasChildren:function(a){var b=meta64.uidToNodeMap[a];if(b)return b.hasChildren;console.log("Unknown nodeId in nodeHasChildren: "+a);return!1},formatPath:function(a){var b=a.path,b=meta64.isAdminUser?b:b.replaceAll("/root","");return b+=" ["+a.primaryTypeName+"]"},wrapHtml:function(a){return"<div>"+a+"</div>"},renderMainPageControls:function(){util.setVisibility("#mainPageControls",!1)},renderPageFromData:function(a){console.log("render.renderPageFromData()");var b=!1;a?b=!0:a=meta64.currentNodeData;
if(a&&a.node){util.setVisibility("#listView",!0);d.renderMainPageControls();meta64.treeDirty=!1;b&&(meta64.uidToNodeMap={},meta64.idToNodeMap={},meta64.selectedNodes={},meta64.initNode(a.node),meta64.setCurrentNodeData(a));var c="";d.getNodeBkgImageStyle(a.node);var e=d.renderNodeContent(a.node,!0,!0,!0,!1);if(0<e.length){var f=a.node.uid,g=f+"_row",h="",l="",m="";!meta64.editMode||"/"==a.node.path||props.isNonOwnedCommentNode(a.node)||props.isNonOwnedNode(a.node)||(m=d.tag("paper-button",{raised:"raised",
onClick:"edit.runEditNode('"+f+"');"},"Edit"));var n=meta64.getHighlightedNode(),n=n&&n.uid===f;meta64.currentNode&&nav.parentVisibleToUser()&&(l=d.tag("paper-button",{"class":"highlight-button",raised:"raised",onClick:"nav.navUpLevel();"},"Up Level"));if(l||m)h=d.makeHorizontalFieldSet(l+m);e=d.tag("div",{"class":n?"mainNodeContentStyle active-row":"mainNodeContentStyle inactive-row",onClick:"nav.clickOnNodeRow(this, '"+f+"');",id:g},h+e);$("#mainNodeContent").show();$("#mainNodeContent").html(e)}else $("#mainNodeContent").hide();
view.updateStatusBar();d.renderMainPageControls();if(a.children)for(e=a.children.length,g=f=0;g<a.children.length;g++)h=d.generateRow(g,a.children[g],b,e,f),0!=h.length&&(c+=h,f++);0!=c.length||meta64.isAnonUser||(c=d.tag("paper-button",{raised:"raised",onClick:"edit.createSubNode();"},"Create Content"));util.setHtmlEnhanced("listView",c);meta64.screenSizeChange();meta64.getHighlightedNode()?view.scrollToSelectedNode():view.scrollToTop()}else util.setVisibility("#listView",!1),$("#mainNodeContent").html("No content is available here.")},
generateRow:function(a,b,c,e,f){if(meta64.isNodeBlackListed(b))return"";c&&meta64.initNode(b);f++;return d.renderNodeAsListItem(b,a,e,f)},getUrlForNodeAttachment:function(a){return postTargetUrl+"bin/file-name?nodeId="+encodeURIComponent(a.path)+"&ver="+a.binVer},adjustImageSize:function(a){var b=$("#"+a.imgId);b&&a.width&&a.height&&(a.width>meta64.deviceWidth-80?(b.attr("width","100%"),b.attr("height","auto")):(b.attr("width",a.width),b.attr("height",a.height)))},makeImageTag:function(a){var b=d.getUrlForNodeAttachment(a);
a.imgId="imgUid_"+a.uid;if(a.width&&a.height){if(a.width>meta64.deviceWidth-50){var c=meta64.deviceWidth-50;return d.tag("img",{src:b,id:a.imgId,width:c+"px",height:c*a.height/a.width+"px"},null,!1)}return d.tag("img",{src:b,id:a.imgId,width:a.width+"px",height:a.height+"px"},null,!1)}return d.tag("img",{src:b,id:a.imgId},null,!1)},tag:function(a,b,c,d){"undefined"===typeof d&&(d=!0);var f="<"+a;b&&(f+=" ",$.each(b,function(a,b){f=b?b.contains("'")?f+(a+'="'+b+'" '):f+(a+"='"+b+"' "):f+(a+" ")}));
return f=d?f+(">"+c+"</"+a+">"):f+"/>"},makeTextArea:function(a,b){return d.tag("paper-textarea",{name:b,label:a,id:b},"",!0)},makeEditField:function(a,b){return d.tag("paper-input",{name:b,label:a,id:b},"",!0)},makePasswordField:function(a,b){return d.tag("paper-input",{type:"password",name:b,label:a,id:b},"",!0)},makeButton:function(a,b,c){b={raised:"raised",id:b};void 0!=c&&(b.onClick=c);return d.tag("paper-button",b,a,!0)},makeBackButton:function(a,b,c,e){void 0===e&&(e="");return d.tag("paper-button",
{raised:"raised",id:b,onClick:"meta64.cancelDialog('"+c+"');"+e},a,!0)},makePopupBackButton:function(a,b,c,e){void 0===e&&(e="");return d.tag("paper-button",{raised:"raised","dialog-confirm":"dialog-confirm",id:b,onClick:e},a,!0)},allowPropertyToDisplay:function(a){return meta64.inSimpleMode()?null==meta64.simpleModePropertyBlackList[a]:!0},isReadOnlyProperty:function(a){return meta64.readOnlyPropertyList[a]},isBinaryProperty:function(a){return meta64.binaryPropertyList[a]},sanitizePropertyName:function(a){return"simple"===
meta64.editModeOption?a===jcrCnst.CONTENT?"Content":a:a}};console.log("Module ready: render.js");return d}();console.log("running module: jcrCnst.js");
var jcrCnst=function(){console.log("Module ready: jcrCnst.js");return{COMMENT_BY:"commentBy",PUBLIC_APPEND:"publicAppend",PRIMARY_TYPE:"jcr:primaryType",POLICY:"rep:policy",MIXIN_TYPES:"jcr:mixinTypes",EMAIL_CONTENT:"jcr:content",EMAIL_RECIP:"recip",EMAIL_SUBJECT:"subject",CREATED:"jcr:created",CREATED_BY:"jcr:createdBy",CONTENT:"jcr:content",UUID:"jcr:uuid",LAST_MODIFIED:"jcr:lastModified",LAST_MODIFIED_BY:"jcr:lastModifiedBy",USER:"user",PWD:"pwd",EMAIL:"email",CODE:"code",BIN_VER:"binVer",BIN_DATA:"jcrData",
BIN_MIME:"jcr:mimeType",IMG_WIDTH:"imgWidth",IMG_HEIGHT:"imgHeight"}}();console.log("running module: prefs.js");
var prefs=function(){var d={savePreferencesResponse:function(a){util.checkSuccess("Saving Preferences",a)&&(meta64.selectTab("mainTabName"),view.scrollToSelectedNode())},closeAccountResponse:function(){$(window).off("beforeunload");window.location.href=window.location.origin},closeAccount:function(){(new ConfirmDlg("Oh No!","Close your Account? Are you sure? This was so unexpected!","Yes, Close Account.",function(){util.json("closeAccount",{},d.closeAccountResponse)})).open()},savePreferences:function(){var a=
util.polyElm("simpleModeRadioGroup");meta64.editModeOption="editModeSimple"==a.node.selected?meta64.MODE_SIMPLE:meta64.MODE_ADVANCED;util.json("saveUserPreferences",{userPreferences:{advancedMode:meta64.editModeOption===meta64.MODE_ADVANCED}},d.savePreferencesResponse)},populatePreferencesPg:function(){util.polyElm("simpleModeRadioGroup").node.select(meta64.editModeOption==meta64.MODE_SIMPLE?"editModeSimple":"editModeAdvanced");Polymer.dom.flush()},accountPreferencesPg:function(){meta64.openDialog(prefsPg);
d.populatePreferencesPg()}};console.log("Module ready: prefs.js");return d}();console.log("running module: edit.js");
var edit=function(){var d,a,b=function(a){util.checkSuccess("Save node",a)&&(view.refreshTree(null,!1),meta64.selectTab("mainTabName"),view.scrollToSelectedNode())},c=function(a){util.checkSuccess("Export",a)&&(messagePg.alert("Export Successful."),meta64.selectTab("mainTabName"),view.scrollToSelectedNode())},e=function(a){util.checkSuccess("Import",a)&&(messagePg.alert("Import Successful."),view.refreshTree(null,!1),meta64.selectTab("mainTabName"),view.scrollToSelectedNode())},f=function(a){console.log("insertBookResponse running.");
util.checkSuccess("Insert Book",a);view.refreshTree(null,!1);meta64.selectTab("mainTabName");view.scrollToSelectedNode()},g=function(a){util.checkSuccess("Delete node",a)&&(meta64.clearSelectedNodes(),view.refreshTree(null,!1))},h=function(a){util.checkSuccess("Editing node",a)&&(console.log("Changing to editNodePg."),k.editNode=a.nodeInfo,meta64.openDialog(editNodePg))},l=function(a){util.checkSuccess("Move nodes",a)&&(k.nodesToMove=null,view.refreshTree(null,!1))},m=function(a){util.checkSuccess("Change node position",
a)&&meta64.goToMainPage(!0,!0)},n=function(a){util.checkSuccess("Insert node",a)&&(meta64.initNode(a.newNode),meta64.highlightNode(a.newNode,!0),k.runEditNode(a.newNode.uid))},p=function(a){util.checkSuccess("Make node referencable",a)&&messagePg.alert("This node is now referencable, and can be accessed by unique ID");view.refreshTree(null,!1)},q=function(a){util.checkSuccess("Split content",a)&&(view.refreshTree(null,!1),meta64.selectTab("mainTabName"),view.scrollToSelectedNode())},r=function(a){util.checkSuccess("Create subnode",
a)&&(meta64.initNode(a.newNode),k.runEditNode(a.newNode.uid))},k={nodesToMove:null,editingUnsavedNode:!1,editNode:null,nodeInsertTarget:null,startEditingNewNode:function(){k.editingUnsavedNode=!1;k.editNode=null;k.saveNewNode("")},startEditingNewNodeWithName:function(){k.editingUnsavedNode=!0;k.editNode=null;meta64.changePage(editNodePg)},editMode:function(){meta64.editMode=meta64.editMode?!1:!0;var a=$("#editModeButton");a.toggleClass("ui-icon-edit",meta64.editMode);a.toggleClass("ui-icon-forbidden",
!meta64.editMode);render.renderPageFromData();view.scrollToSelectedNode()},makeNodeReferencable:function(){util.json("makeNodeReferencable",{nodeId:k.editNode.id},p)},splitContent:function(){var a=k.getNodeBelow(k.editNode);util.json("splitNode",{nodeId:k.editNode.id,nodeBelowId:null==a?null:a.id},q)},cancelEdit:function(){meta64.treeDirty?meta64.goToMainPage(!0):(meta64.selectTab("mainTabName"),view.scrollToSelectedNode())},saveNode:function(){k.editingUnsavedNode?k.saveNewNode():k.saveExistingNode()},
saveNewNode:function(b){b||(b=util.getInputVal("newNodeNameId"));meta64.userName!=d.createdBy&&"admin"!=d.createdBy&&(a=!0);meta64.treeDirty=!0;k.nodeInsertTarget?util.json("insertNode",{parentId:d.id,targetName:k.nodeInsertTarget.name,newNodeName:b},n):util.json("createSubNode",{nodeId:d.id,newNodeName:b},r)},saveExistingNode:function(){console.log("**************** saveExistingNode");for(var c=[],d=0,e=0;;){var f="editNodeTextContent"+d;if(meta64.fieldIdToPropMap.hasOwnProperty(f))if(console.log("Saving property field: "+
f),util.elementExists(f)){console.log("Element exists: "+f);var g=meta64.fieldIdToPropMap[f],h=util.getTextAreaValById(f);console.log("prop name: "+g.name);g.values&&0<g.values.length?alert("multi prop not handled: fieldId="+f):h!==g.value?(console.log("Prop change: "+f+" newVal="+h),c.push({name:g.name,value:h}),e++):console.log("Prop didn't change: "+f)}else{console.log("Element doesn't exist: "+f+" trying subprops");for(var l=0,m=[],g=meta64.fieldIdToPropMap[f];;){h=f+"_subProp"+l;if(util.elementExists(h))console.log("Element subprop exists: "+
h),h=util.getTextAreaValById(h),console.log("prop: "+g.name+" val["+l+"]="+h),m.push(h);else{console.log("Element subprop does not exist: "+h);break}l++}c.push({name:g.name,values:m});e++}else break;d++}0<e?(util.json("saveNode",{nodeId:k.editNode.id,properties:c,sendNotification:a},b),a=!1):console.log("nothing chaged. Nothing to save.")},moveNodeUp:function(a){var b=meta64.uidToNodeMap[a];b?(a=k.getNodeAbove(b),null!=a&&util.json("setNodePosition",{parentNodeId:meta64.currentNodeId,nodeId:b.name,
siblingId:a.name},m)):console.log("idToNodeMap does not contain "+a)},moveNodeDown:function(a){var b=meta64.uidToNodeMap[a];b?(a=k.getNodeBelow(b),null!=a&&util.json("setNodePosition",{parentNodeId:meta64.currentNodeData.node.id,nodeId:a.name,siblingId:b.name},m)):console.log("idToNodeMap does not contain "+a)},getNodeAbove:function(a){a=meta64.getOrdinalOfNode(a);return 0>=a?null:meta64.currentNodeData.children[a-1]},getNodeBelow:function(a){a=meta64.getOrdinalOfNode(a);console.log("ordinal = "+
a);return-1==a||a>=meta64.currentNodeData.children.length-1?null:meta64.currentNodeData.children[a+1]},fullRepositoryExport:function(){util.json("exportToXml",{nodeId:"/"},c)},openExportPg:function(){meta64.changePage(exportPg)},openRenameNodePg:function(){meta64.changePage(renameNodePg)},renameNode:function(){var a=util.getInputVal("newNodeNameEditField");if(util.emptyString(a))messagePg.alert("Please enter a new node name.");else{var b=meta64.getHighlightedNode();if(b){k.getNodeBelow(b);var c=b.id===
meta64.currentNodeId,d=util.json("renameNode",{nodeId:b.id,newName:a});d.completes.then(function(){var a=d.response;util.checkSuccess("Rename node",a)&&(c?view.refreshTree(a.newId,!0):view.refreshTree(null,!1,a.newId),meta64.selectTab("mainTabName"))})}else messagePg.alert("Select a node to rename.")}},exportNodes:function(){var a=meta64.getHighlightedNode(),b=util.getInputVal("exportTargetNodeName");util.emptyString(b)?messagePg.alert("Please enter a name for the export file."):a&&util.json("exportToXml",
{nodeId:a.id,targetFileName:b},c)},openImportPg:function(){meta64.changePage(importPg)},importNodes:function(){var a=meta64.getHighlightedNode(),b=util.getInputVal("importTargetNodeName");util.emptyString(b)?messagePg.alert("Please enter a name for the import file."):a&&util.json("import",{nodeId:a.id,sourceFileName:b},e)},runEditNode:function(a){var b=meta64.uidToNodeMap[a];b?(k.editingUnsavedNode=!1,util.json("initNodeEdit",{nodeId:b.id},h)):(k.editNode=null,messagePg.alert("Unknown nodeId in editNodeClick: "+
a))},populateEditNodePg:function(){view.initEditPathDisplayById("#editNodePathDisplay");var a="",b=0;meta64.fieldIdToPropMap={};if(k.editNode)$.each(k.editNode.properties,function(c,d){if(render.allowPropertyToDisplay(d.name)){var e="editNodeTextContent"+b;console.log("Creating edit field "+e+" for property "+d.name);meta64.fieldIdToPropMap[e]=d;var f=d.values&&0<d.values.length,g=render.isReadOnlyProperty(d.name),h=render.isBinaryProperty(d.name);if(g||h)e="RdOnly_"+e;var l="";g||h||(l=k.makePropertyEditButtonBar(d,
e));l=f?l+props.makeMultiPropEditor(e,d,g,h):l+props.makeSinglePropEditor(e,d,g,h);a+=render.tag("div",{"class":"genericListItem"},l);b++}else console.log("Hiding property: "+d.name)});else var c=render.tag("paper-textarea",{id:"newNodeNameId",label:"New Node Name"},"",!0),a=a+render.tag("div",{},c);util.setHtmlEnhanced("propertyEditFieldContainer",a);c=k.editingUnsavedNode?"You may leave this field blank and a unique ID will be assigned. You only need to provide a name if you want this node to have a more meaningful URL.":
"";$("#editNodeInstructions").html(c);util.setVisibility("#addPropertyButton",!k.editingUnsavedNode);c=k.editNode&&k.editNode.id&&!k.editNode.id.startsWith("/");util.setVisibility("#makeNodeReferencableButton",k.editNode&&!c&&!k.editingUnsavedNode)},makePropertyEditButtonBar:function(a,b){var c="",c=render.tag("paper-button",{raised:"raised",onClick:"props.clearProperty('"+b+"');"},"Clear"),d="",e="";a.name!==jcrCnst.CONTENT&&(e=render.tag("paper-button",{raised:"raised",onClick:"props.deleteProperty('"+
a.name+"');"},"Del"),d=render.tag("paper-button",{raised:"raised",onClick:"props.addSubProperty('"+b+"');"},"Add Multi"));c=d+c+e;return c=0<c.length?render.makeHorizontalFieldSet(c,"property-edit-button-bar"):""},insertNode:function(a){if(d=meta64.currentNode){var b=null;if(b=a?meta64.uidToNodeMap[a]:meta64.getHighlightedNode())k.nodeInsertTarget=b,k.startEditingNewNode()}else console.log("Unknown parent")},createSubNodeUnderHighlight:function(){(d=meta64.getHighlightedNode())?(k.nodeInsertTarget=
null,k.startEditingNewNode()):messagePg.alert("Tap a node to insert under.")},replyToComment:function(a){k.createSubNode(a)},createSubNode:function(a){if(a){if(d=meta64.uidToNodeMap[a],!d){console.log("Unknown nodeId in createSubNode: "+a);return}}else d=meta64.currentNode;k.nodeInsertTarget=null;k.startEditingNewNode()},clearSelections:function(){meta64.clearSelectedNodes();render.renderPageFromData();meta64.selectTab("mainTabName")},deleteSelNodes:function(){var a=meta64.getSelectedNodeIdsArray();
a&&0!=a.length?(new ConfirmDlg("Confirm Delete","Delete "+a.length+" node(s) ?","Yes, delete.",function(){util.json("deleteNodes",{nodeIds:a},g)})).open():messagePg.alert("You have not selected any nodes. Select nodes to delete first.")},moveSelNodes:function(){var a=meta64.getSelectedNodeIdsArray();a&&0!=a.length?(new ConfirmDlg("Confirm Move","Move "+a.length+" node(s) to a new location ?","Yes, move.",function(){k.nodesToMove=a;meta64.selectedNodes={};messagePg.alert("Ok, ready to move nodes. To finish moving, go select the target location, then click 'Finish Moving'");
meta64.refreshAllGuiEnablement()})).open():messagePg.alert("You have not selected any nodes. Select nodes to move first.")},finishMovingSelNodes:function(){(new ConfirmDlg("Confirm Move","Move "+k.nodesToMove.length+" node(s) to selected location ?","Yes, move.",function(){var a=meta64.getHighlightedNode();util.json("moveNodes",{targetNodeId:a.id,targetChildId:null!=a?a.id:null,nodeIds:k.nodesToMove},l)})).open()},insertBookWarAndPeace:function(){(new ConfirmDlg("Confirm","Insert book War and Peace?",
"Yes, insert book.",function(){var a=meta64.getHighlightedNode();a?util.json("insertBook",{nodeId:a.id,bookName:"War and Peace"},f):messagePg.alert("No node is selected.")})).open()}};console.log("Module ready: edit.js");return k}();console.log("running module: view.js");
var view=function(){var d=!1,a={updateStatusBar:function(){if(meta64.currentNodeData){var a="";meta64.editModeOption===meta64.MODE_ADVANCED&&(a+="count: "+meta64.currentNodeData.children.length);meta64.editMode&&(a+=" Selections: "+util.getPropertyCount(meta64.selectedNodes));var c=0<a.length;util.setVisibility("mainNodeStatusBar",c);c&&util.setHtmlEnhanced("mainNodeStatusBar",a)}},refreshTreeResponse:function(b,c,d,f){render.renderPageFromData(b);f?meta64.highlightRowById(f,!0):c&&d&&b.displayedParent?
meta64.highlightRowById(c,!0):a.scrollToSelectedNode();meta64.refreshAllGuiEnablement()},refreshTree:function(b,c,d){b||(b=meta64.currentNodeId);console.log("Refreshing tree: nodeId="+b);var f=util.json("renderNode",{nodeId:b,renderParentIfLeaf:c?!0:!1});f.completes.then(function(){a.refreshTreeResponse(f.response,b,c,d)})},scrollToSelectedNode:function(){d=!0;setTimeout(function(){d=!1;var a=nav.getSelectedPolyElement();a?a.node.scrollIntoView?a.node.scrollIntoView():alert("selected element didn't have scrollIntoView function"):
(a=util.polyElm("mainPaperTabs"))&&a.node.scrollIntoView()},1E3)},scrollToTop:function(){d||setTimeout(function(){if(!d){var a=util.polyElm("mainPaperTabs");a&&a.node.scrollIntoView()}},1E3)},initEditPathDisplayById:function(a){var c=edit.editNode;a=$(a);if(edit.editingUnsavedNode)a.html(""),a.hide();else{var d="Path: "+render.formatPath(c),d=d+("<br>ID: "+c.id);c.lastModified&&(d+="<br>Modified: "+c.lastModified);a.html(d);a.show()}},showServerInfo:function(){var a=util.json("getServerInfo",{});
a.completes.then(function(){messagePg.showMessage("Server Info",a.response.serverInfo,null)})}};console.log("Module ready: view.js");return a}();console.log("running module: attachment.js");
var attachment=function(){function d(a){util.checkSuccess("Delete attachment",a)&&(meta64.removeBinaryByUid(b.uploadNode.uid),console.log("removed attachment from node uid: "+b.uploadNode.uid),meta64.goToMainPage(!0))}function a(a){util.checkSuccess("Upload from URL",a)&&meta64.goToMainPage(!0,!0)}var b={uploadNode:null,deleteAttachment:function(){(new ConfirmDlg("Confirm Delete Attachment","Delete the Attachment on the Node?","Yes, delete.",function(){util.json("deleteAttachment",{nodeId:b.uploadNode.id},
d)})).open()},uploadFileNow:function(){var c=util.getInputVal("uploadFromUrl");c?util.json("uploadFromUrl",{nodeId:b.uploadNode.id,sourceUrl:c},a):($("#uploadFormNodeId").attr("value",b.uploadNode.id),c=$.ajax({url:postTargetUrl+"upload",type:"POST",data:new FormData($("#uploadForm")[0]),enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1}),c.done(function(){meta64.goToMainPage(!0,!0)}),c.fail(function(){messagePg.alert("Upload failed.")}))},openUploadPg:function(){var a=meta64.getHighlightedNode();
a?(b.uploadNode=a,meta64.changePage(uploadPg)):(b.uploadNode=null,messagePg.alert("No node is selected."))}};console.log("Module ready: attachment.js");return b}();
