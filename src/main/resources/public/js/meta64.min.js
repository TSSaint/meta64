console.log("running module: attachment.js");
var attachment=function(){function d(a){util.checkSuccess("Delete attachment",a)&&(view.refreshTree(null,!1),b.closeUploadPg())}function a(a){util.checkSuccess("Upload from URL",a)&&(view.refreshTree(null,!1),b.closeUploadPg())}var b={uploadNode:null,deleteAttachment:function(){confirmPg.areYouSure("Confirm Delete Attachment","Delete the Attachment on the Node?","Yes, delete.",function(){util.json("deleteAttachment",{nodeId:b.uploadNode.id},d)})},uploadFileNow:function(){var c=$("#uploadFromUrl").val();
c?util.json("uploadFromUrl",{nodeId:b.uploadNode.id,sourceUrl:c},a):($("#uploadFormNodeId").attr("value",b.uploadNode.id),c=$.ajax({url:postTargetUrl+"upload",type:"POST",data:new FormData($("#uploadForm")[0]),enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1}),c.done(function(){view.refreshTree(null,!1);b.closeUploadPg()}),c.fail(function(){alert("Upload failed.")}))},openUploadPg:function(){var a=meta64.getHighlightedNode();a?(b.uploadNode=a,meta64.changePage(uploadPg)):(b.uploadNode=
null,alert("No node is selected."))},closeUploadPg:function(){meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()}};console.log("Module ready: attachment.js");return b}();console.log("running module: cnst.js");var cnst=function(){var d={ANON:"anonymous",COOKIE_LOGIN_USR:cookiePrefix+"loginUsr",COOKIE_LOGIN_PWD:cookiePrefix+"loginPwd",COOKIE_LOGIN_STATE:cookiePrefix+"loginState",BR:"<div class='vert-space'></div>",INSERT_ATTACHMENT:"{{insert-attachment}}",NEW_ON_TOOLBAR:!1,INS_ON_TOOLBAR:!1};console.log("Module ready: cnst.js");return d}();console.log("running module: edit.js");
var edit=function(){var d,a,b=function(a){util.checkSuccess("Save node",a)&&(view.refreshTree(null,!1),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},c=function(a){util.checkSuccess("Rename node",a)&&(view.refreshTree(null,!1),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},e=function(a){util.checkSuccess("Export",a)&&(alert("Export Successful."),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},f=function(a){util.checkSuccess("Import",a)&&(alert("Import Successful."),
view.refreshTree(null,!1),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},g=function(a){console.log("insertBookResponse running.");util.checkSuccess("Insert Book",a);view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},l=function(a){util.checkSuccess("Delete node",a)&&(meta64.clearSelectedNodes(),view.refreshTree(null,!1))},h=function(a){util.checkSuccess("Editing node",a)&&(k.editNode=a.nodeInfo,meta64.changePage(editNodePg))},m=function(a){util.checkSuccess("Move nodes",
a)&&(k.nodesToMove=null,view.refreshTree(null,!1))},n=function(a){util.checkSuccess("Change node position",a)&&(view.refreshTree(null,!1),meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},p=function(a){util.checkSuccess("Insert node",a)&&(meta64.newChildNodeId=a.newNode.id,meta64.initNode(a.newNode),meta64.highlightNode(a.newNode,!0),k.runEditNode(a.newNode.uid))},q=function(a){util.checkSuccess("Make node referencable",a)&&alert("This node is now referencable, and can be accessed by unique ID")},
r=function(a){util.checkSuccess("Create subnode",a)&&(meta64.newChildNodeId=a.newNode.id,console.log("new child identifier: "+meta64.newChildNodeId),meta64.initNode(a.newNode),k.runEditNode(a.newNode.uid))},k={nodesToMove:null,editingUnsavedNode:!1,editNode:null,nodeInsertTarget:null,startEditingNewNode:function(){k.editingUnsavedNode=!1;k.editNode=null;k.saveNewNode("")},startEditingNewNodeWithName:function(){k.editingUnsavedNode=!0;k.editNode=null;meta64.changePage(editNodePg)},editMode:function(){meta64.editMode=
meta64.editMode?!1:!0;var a=$("#editModeButton");a.toggleClass("ui-icon-edit",meta64.editMode);a.toggleClass("ui-icon-forbidden",!meta64.editMode);render.renderPageFromData();view.scrollToSelectedNode()},makeNodeReferencable:function(){util.json("makeNodeReferencable",{nodeId:k.editNode.id},q)},cancelEdit:function(){meta64.treeDirty&&view.refreshTree(null,!1);meta64.jqueryChangePage("#mainPage");view.scrollToSelectedNode()},saveNode:function(){k.editingUnsavedNode?k.saveNewNode():k.saveExistingNode()},
saveNewNode:function(b){b||(b=util.getRequiredElement("#newNodeNameId").val());meta64.userName!=d.createdBy&&"admin"!=d.createdBy&&(a=!0);meta64.treeDirty=!0;k.nodeInsertTarget?util.json("insertNode",{parentId:d.id,targetName:k.nodeInsertTarget.name,newNodeName:b},p):util.json("createSubNode",{nodeId:d.id,newNodeName:b},r)},saveExistingNode:function(){for(var c=[],e=0,f=0;;){var d="editNodeTextContent"+e;if(meta64.fieldIdToPropMap.hasOwnProperty(d)){var g=meta64.fieldIdToPropMap[d],d=$("#"+d).val();
d!==g.value&&(c.push({name:g.name,value:d}),f++)}else break;e++}0<f?(util.json("saveNode",{nodeId:k.editNode.id,properties:c,sendNotification:a},b),a=!1):alert("You didn't change any information!")},moveNodeUp:function(a){var b=meta64.uidToNodeMap[a];b?(a=meta64.getOrdinalOfNode(b),console.log("ordinal="+a),-1==a&&0>=a||util.json("setNodePosition",{parentNodeId:meta64.currentNodeId,nodeId:b.name,siblingId:meta64.currentNodeData.children[a-1].name},n)):console.log("idToNodeMap does not contain "+a)},
moveNodeDown:function(a){var b=meta64.uidToNodeMap[a];b?(a=meta64.getOrdinalOfNode(b),console.log("ordinal="+a),-1==a&&a>=meta64.currentNodeData.children.length-1||util.json("setNodePosition",{parentNodeId:meta64.currentNodeData.node.id,nodeId:meta64.currentNodeData.children[a+1].name,siblingId:b.name},n)):console.log("idToNodeMap does not contain "+a)},fullRepositoryExport:function(){util.json("exportToXml",{nodeId:"/"},e)},openExportPg:function(){meta64.changePage(exportPg)},openRenameNodePg:function(){meta64.changePage(renameNodePg)},
renameNode:function(){var a=$("#newNodeNameEditField").val();if(util.emptyString(a))alert("Please enter a new node name.");else{var b=meta64.getHighlightedNode();b?util.json("renameNode",{nodeId:b.id,newName:a},c):alert("Select a node to rename.")}},exportNodes:function(){var a=meta64.getHighlightedNode(),b=util.getRequiredElement("#exportTargetNodeName").val();util.emptyString(b)?alert("Please enter a name for the export file."):a&&util.json("exportToXml",{nodeId:a.id,targetFileName:b},e)},openImportPg:function(){meta64.changePage(importPg)},
importNodes:function(){var a=meta64.getHighlightedNode(),b=util.getRequiredElement("#importTargetNodeName").val();util.emptyString(b)?alert("Please enter a name for the import file."):a&&util.json("import",{nodeId:a.id,sourceFileName:b},f)},runEditNode:function(a){var b=meta64.uidToNodeMap[a];b?(k.editingUnsavedNode=!1,util.json("initNodeEdit",{nodeId:b.id},h)):(k.editNode=null,alert("Unknown nodeId in editNodeClick: "+a))},populateEditNodePg:function(){view.initEditPathDisplayById("#editNodePathDisplay");
var a="",b=0;meta64.fieldIdToPropMap={};if(k.editNode)$.each(k.editNode.properties,function(c,e){if(render.allowPropertyToDisplay(e.name)){var f="editNodeTextContent"+b;meta64.fieldIdToPropMap[f]=e;var d=e.values&&0<e.values.length,g=render.isReadOnlyProperty(e.name),l=render.isBinaryProperty(e.name);if(g||l)f="RdOnly_"+f;var h="";if(!g&&!l){var h=render.makeTag("a",{onClick:"props.clearProperty('"+f+"');","class":"ui-btn ui-btn-inline ui-icon-back ui-btn-icon-left"},"Clear"),k="",m="";e.name!==jcrCnst.CONTENT&&
(m=render.makeTag("a",{onClick:"props.deleteProperty('"+e.name+"');","class":"ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left"},"Del"),k=render.makeTag("a",{onClick:"props.addSubProperty('"+f+"');","class":"ui-btn ui-btn-inline ui-icon-star ui-btn-icon-left"},"Add Multi"));h=k+h+m;h=0<h.length?render.makeHorizontalFieldSet(h,"property-edit-button-bar"):""}d?(console.log("Property multi-type: name="+e.name+" count="+e.values.length),h+=props.makeMultiPropEditor(f,e,g,l)):(console.log("Property single-type: "+
e.name),h+=render.makeTag("label",{"for":f},render.sanitizePropertyName(e.name)),d=l?"[binary]":e.value,h=g||l?h+render.makeTag("textarea",{id:f,readonly:"readonly",disabled:"disabled"},d?d:""):h+render.makeTag("textarea",{id:f},d?d:""));a+=render.makeTag("div",{"class":"ui-field-contain property-edit-field"},h);b++}else console.log("Hiding property: "+e.name)});else var c=render.makeTag("label",{"for":"newNodeNameId"},"New Node Name")+render.makeTag("textarea",{id:"newNodeNameId"},""),a=a+render.makeTag("div",
{"class":"ui-field-contain property-edit-field"},c);util.setHtmlEnhanced($("#propertyEditFieldContainer"),a);c=k.editingUnsavedNode?"You may leave this field blank and a unique ID will be assigned. You only need to provide a name if you want this node to have a more meaningful URL.":"";$("#editNodeInstructions").html(c);util.setVisibility("#addPropertyButton",!k.editingUnsavedNode);c=k.editNode&&k.editNode.id&&!k.editNode.id.startsWith("/");util.setVisibility("#makeNodeReferencableButton",k.editNode&&
!c&&!k.editingUnsavedNode)},insertNode:function(a){if(d=meta64.currentNode){var b=null;if(b=a?meta64.uidToNodeMap[a]:meta64.getHighlightedNode())k.nodeInsertTarget=b,k.startEditingNewNode()}else console.log("Unknown parent")},createSubNodeUnderHighlight:function(){(d=meta64.getHighlightedNode())?(k.nodeInsertTarget=null,k.startEditingNewNode()):alert("Tap a node to insert under.")},replyToComment:function(a){k.createSubNode(a)},createSubNode:function(a){if(a){if(d=meta64.uidToNodeMap[a],!d){console.log("Unknown nodeId in createSubNode: "+
a);return}}else d=meta64.currentNode;k.nodeInsertTarget=null;k.startEditingNewNode()},clearSelections:function(){meta64.clearSelectedNodes();render.renderPageFromData();meta64.jqueryChangePage("#mainPage")},deleteSelNodes:function(){var a=meta64.getSelectedNodeIdsArray();a&&0!=a.length?confirmPg.areYouSure("Confirm Delete","Delete "+a.length+" node(s) ?","Yes, delete.",function(){util.json("deleteNodes",{nodeIds:a},l)}):alert("You have not selected any nodes. Select nodes to delete first.")},moveSelNodes:function(){var a=
meta64.getSelectedNodeIdsArray();a&&0!=a.length?confirmPg.areYouSure("Confirm Move","Move "+a.length+" node(s) to a new location ?","Yes, move.",function(){k.nodesToMove=a;meta64.selectedNodes={};alert("Ok, ready to move nodes. To finish moving, go select the target location, then click 'Finish Moving'");meta64.refreshAllGuiEnablement()}):alert("You have not selected any nodes. Select nodes to move first.")},finishMovingSelNodes:function(){confirmPg.areYouSure("Confirm Move","Move "+k.nodesToMove.length+
" node(s) to selected location ?","Yes, move.",function(){var a=meta64.getHighlightedNode();util.json("moveNodes",{targetNodeId:a.id,targetChildId:null!=a?a.id:null,nodeIds:k.nodesToMove},m)})},insertBookWarAndPeace:function(){confirmPg.areYouSure("Confirm","Insert book War and Peace?","Yes, insert book.",function(){var a=meta64.getHighlightedNode();a?util.json("insertBook",{nodeId:a.id,bookName:"War and Peace"},g):alert("No node is selected.")})}};console.log("Module ready: edit.js");return k}();console.log("running module: jcrCnst.js");
var jcrCnst=function(){console.log("Module ready: jcrCnst.js");return{COMMENT_BY:"commentBy",PUBLIC_APPEND:"publicAppend",PRIMARY_TYPE:"jcr:primaryType",POLICY:"rep:policy",MIXIN_TYPES:"jcr:mixinTypes",EMAIL_CONTENT:"jcr:content",EMAIL_RECIP:"recip",EMAIL_SUBJECT:"subject",CREATED:"jcr:created",CREATED_BY:"jcr:createdBy",CONTENT:"jcr:content",UUID:"jcr:uuid",LAST_MODIFIED:"jcr:lastModified",LAST_MODIFIED_BY:"jcr:lastModifiedBy",USER:"user",PWD:"pwd",EMAIL:"email",CODE:"code",BIN_VER:"binVer",BIN_DATA:"jcrData",
BIN_MIME:"jcr:mimeType",IMG_WIDTH:"imgWidth",IMG_HEIGHT:"imgHeight"}}();console.log("running module: meta64.js");
var meta64=function(){var d=!1,a={userName:"anonymous",deviceWidth:0,deviceHeight:0,homeNodeId:"",homeNodePath:"",isAdminUser:!1,isAnonUser:!0,anonUserLandingPageNode:null,treeDirty:!1,uidToNodeMap:{},idToNodeMap:{},nextUid:1,identToUidMap:{},parentUidToFocusNodeMap:{},editMode:!1,MODE_ADVANCED:"advanced",MODE_SIMPLE:"simple",editModeOption:"simple",showProperties:!1,simpleModeNodePrefixBlackList:{"rep:":!0},simpleModePropertyBlackList:{},readOnlyPropertyList:{},binaryPropertyList:{},fieldIdToPropMap:{},
selectedNodes:{},newChildNodeId:"",currentNodeData:null,currentNode:null,currentNodeUid:null,currentNodeId:null,currentNodePath:null,inSimpleMode:function(){return a.editModeOption===a.MODE_SIMPLE},jqueryChangePage:function(a){$.mobile.pageContainer.pagecontainer("change",a)},changePage:function(a){render.buildPage(a);$.mobile.pageContainer.pagecontainer("change","#"+a.domId)},openDialog:function(a){render.buildPage(a);$.mobile.changePage("#"+a.domId,{role:"dialog"})},popup:function(){render.buildPage(popupMenuPg);
$("#"+popupMenuPg.domId).popup("open")},isNodeBlackListed:function(b){if(!a.inSimpleMode())return!1;for(var c in a.simpleModeNodePrefixBlackList)if(a.simpleModeNodePrefixBlackList.hasOwnProperty(c)&&b.name.startsWith(c))return!0;return!1},getSelectedNodeUidsArray:function(){var b=[],c=0,e;for(e in a.selectedNodes)a.selectedNodes.hasOwnProperty(e)&&(b[c++]=e);return b},getSelectedNodeIdsArray:function(){var b=[],c=0,e;a.selectedNodes?console.log("selectedNode count: "+a.selectedNodes.length):console.log("no selected nodes.");
for(e in a.selectedNodes)if(a.selectedNodes.hasOwnProperty(e)){var f=a.uidToNodeMap[e];f?b[c++]=f.id:console.log("unable to find uidToNodeMap for uid="+e)}return b},getSelectedNodesArray:function(){var b=[],c=0,e;for(e in a.selectedNodes)a.selectedNodes.hasOwnProperty(e)&&(b[c++]=a.uidToNodeMap[e]);return b},clearSelectedNodes:function(){a.selectedNodes={}},updateNodeInfoResponse:function(a,c){var e="",f=!1;a.owners&&$.each(a.owners,function(a,b){0<e.length&&(e+=",");b===meta64.userName&&(f=!0);e+=
b});if(0<e.length){c.owner=e;var d=$("#ownerDisplay"+c.uid);d.html(" (Manager: "+e+")");f?util.changeOrAddClass(d,"created-by-other","created-by-me"):util.changeOrAddClass(d,"created-by-me","created-by-other")}},updateNodeInfo:function(b){util.json("getNodePrivileges",{nodeId:b.id,includeAcl:!1,includeOwners:!0}).done(function(c){a.updateNodeInfoResponse(c,b)})},getNodeFromId:function(b){return a.idToNodeMap[b]},getPathOfUid:function(b){var c=a.uidToNodeMap[b];return c?c.path:"[path error. invalid uid: "+
b+"]"},addClickListeners:function(){$("#openLoginPgButton").on("click",user.openLoginPg);$("#navHomeButton").on("click",nav.navHome);$("#navUpLevelButton").on("click",nav.navUpLevel);$("#deletePropertyButton").on("click",props.deleteProperty);$("#editModeButton").on("click",edit.editMode)},openDonatePg:function(){meta64.jqueryChangePage("#donatePg")},getHighlightedNode:function(){return a.parentUidToFocusNodeMap[a.currentNodeUid]},highlightRowById:function(b,c){var e=a.getNodeFromId(b);e?a.highlightNode(e,
c):console.log("highlightRowById failed to find id: "+b)},highlightNode:function(b,c){if(b){var e=!1,f=a.parentUidToFocusNodeMap[a.currentNodeUid];f&&(f.uid===b.uid?e=!0:(f=f.uid+"_row",f=$("#"+f),util.changeOrAddClass(f,"active-row","inactive-row")));e||(a.parentUidToFocusNodeMap[a.currentNodeUid]=b,f=b.uid+"_row",f=$("#"+f),util.changeOrAddClass(f,"inactive-row","active-row"));c&&view.scrollToSelectedNode()}},refreshAllGuiEnablement:function(){util.getPropertyCount(a.selectedNodes);var b=a.getHighlightedNode();
util.setEnablement($("#navHomeButton"),a.currentNode&&!nav.displayingHome());util.setEnablement($("#navUpLevelButton"),a.currentNode&&nav.parentVisibleToUser());var c=a.currentNode&&!a.isAnonUser;util.setEnablement($("#propsToggleButton"),c);util.setEnablement($("#deletePropertyButton"),!a.isAnonUser);c=a.currentNode&&!a.isAnonUser;util.setEnablement($("#editModeButton"),c);util.setEnablement($("#insNodeButton"),!a.isAnonUser&&null!=b);util.setEnablement($("#createNodeButton"),!a.isAnonUser&&null!=
b);util.setVisibility("#menuButton",!a.isAnonUser);util.setVisibility("#openSignupPgButton",a.isAnonUser);util.setVisibility("#mainMenuSearchButton",!a.isAnonUser&&null!=b);util.setVisibility("#mainMenuTimelineButton",!a.isAnonUser&&null!=b)},getSingleSelectedNode:function(){for(var b in a.selectedNodes)if(a.selectedNodes.hasOwnProperty(b))return a.uidToNodeMap[b];return null},getOrdinalOfNode:function(b){if(!a.currentNodeData||!a.currentNodeData.children)return-1;for(var c=0;c<a.currentNodeData.children.length;c++)if(b.id===
a.currentNodeData.children[c].id)return c;return-1},setCurrentNodeData:function(b){a.currentNodeData=b;a.currentNode=b.node;a.currentNodeUid=b.node.uid;a.currentNodeId=b.node.id;a.currentNodePath=b.node.path},anonPageLoadResponse:function(b){b.renderNodeResponse?(util.setVisibility("#mainNodeContent",!0),util.setVisibility("#mainNodeStatusBar",!0),render.renderPageFromData(b.renderNodeResponse),a.refreshAllGuiEnablement()):(util.setVisibility("#mainNodeContent",!1),util.setVisibility("#mainNodeStatusBar",
!1),console.log("setting listview to: "+b.content),util.setHtmlEnhanced($("#listView"),b.content));render.renderMainPageControls()},initNode:function(b){b?(b.uid=util.getUidForId(a.identToUidMap,b.id),b.properties=props.setPreferredPropertyOrder(b.properties),a.uidToNodeMap[b.uid]=b,a.idToNodeMap[b.id]=b):console.log("initNode has null node")},initConstants:function(){util.addAll(a.simpleModePropertyBlackList,[jcrCnst.MIXIN_TYPES,jcrCnst.PRIMARY_TYPE,jcrCnst.POLICY,jcrCnst.IMG_WIDTH,jcrCnst.IMG_HEIGHT,
jcrCnst.BIN_VER,jcrCnst.BIN_DATA,jcrCnst.BIN_MIME,jcrCnst.COMMENT_BY,jcrCnst.PUBLIC_APPEND]);util.addAll(a.readOnlyPropertyList,[jcrCnst.UUID,jcrCnst.MIXIN_TYPES,jcrCnst.CREATED,jcrCnst.CREATED_BY,jcrCnst.LAST_MODIFIED,jcrCnst.LAST_MODIFIED_BY,jcrCnst.IMG_WIDTH,jcrCnst.IMG_HEIGHT,jcrCnst.BIN_VER,jcrCnst.BIN_DATA,jcrCnst.BIN_MIME,jcrCnst.COMMENT_BY,jcrCnst.PUBLIC_APPEND]);util.addAll(a.binaryPropertyList,[jcrCnst.BIN_DATA])},initApp:function(){d||(console.log("initApp running."),d=!0,a.initConstants(),
a.displaySignupMessage(),$(window).on("orientationchange",a.orientationHandler),$(window).bind("beforeunload",function(){return"Leave Meta64 ?"}),a.addClickListeners(),a.deviceWidth=$(window).width(),a.deviceHeight=$(window).height(),user.refreshLogin(),setInterval(function(){var b=$(window).width();b!=a.deviceWidth&&(a.deviceWidth=b,a.deviceHeight=$(window).height(),a.screenSizeChange())},1500),a.refreshAllGuiEnablement())},displaySignupMessage:function(){"ok"===$("#signupCodeResponse").text()&&
alert("Signup complete. You may now login.")},screenSizeChange:function(){a.currentNodeData&&(meta64.currentNode.imgId&&render.adjustImageSize(meta64.currentNode),$.each(a.currentNodeData.children,function(a,c){c.imgId&&render.adjustImageSize(c)}))},orientationHandler:function(a){},loadAnonPageHome:function(b){util.json("anonPageLoad",{ignoreUrl:b},a.anonPageLoadResponse)}};console.log("Module ready: meta64.js");return a}();console.log("running module: nav.js");
var nav=function(){var d={displayingHome:function(){return meta64.isAnonUser?meta64.currentNodeId===meta64.anonUserLandingPageNode:meta64.currentNodeId===meta64.homeNodeId},parentVisibleToUser:function(){return!d.displayingHome()},showSearchPage:function(){meta64.changePage(searchResultsPg)},upLevelResponse:function(a,b){a&&a.node?(render.renderPageFromData(a),meta64.highlightRowById(b,!0),meta64.refreshAllGuiEnablement()):alert("No data is visible to you above this node.")},navUpLevel:function(){d.parentVisibleToUser()&&
util.json("renderNode",{nodeId:meta64.currentNodeId,upLevel:1}).done(function(a){d.upLevelResponse(a,meta64.currentNodeId)})},getSelectedDomElement:function(){var a=meta64.getHighlightedNode();return a&&(a=meta64.uidToNodeMap[a.uid])?util.domElm(a.uid+"_row"):null},clickOnNodeRow:function(a,b){var c=meta64.uidToNodeMap[b];c?(meta64.highlightNode(c,!1),meta64.editMode&&!c.owner&&(console.log("calling updateNodeInfo"),meta64.updateNodeInfo(c)),meta64.refreshAllGuiEnablement()):console.log("clickOnNodeRow recieved uid that doesn't map to any node. uid="+
b)},openNode:function(a){var b=meta64.uidToNodeMap[a];meta64.highlightNode(b,!0);b?view.refreshTree(b.id,!1):alert("Unknown nodeId in openNode: "+a)},toggleNodeSel:function(a){if(util.getRequiredElement()){var b=$("#"+a+"_sel"),c=b.attr("class").contains("ui-btn-b");c?(util.changeOrAddClass(b,"ui-btn-b","ui-btn-a"),c=!1):(util.changeOrAddClass(b,"ui-btn-a","ui-btn-b"),c=!0);c?meta64.selectedNodes[a]=!0:delete meta64.selectedNodes[a];b.enhanceWithin();view.updateStatusBar();meta64.refreshAllGuiEnablement()}else console.log("Unable to find Sel button for uid: "+
a)},navHomeResponse:function(a){meta64.clearSelectedNodes();render.renderPageFromData(a);util.scrollToTop();meta64.refreshAllGuiEnablement()},navHome:function(){meta64.isAnonUser?meta64.loadAnonPageHome(!0):util.json("renderNode",{nodeId:meta64.homeNodeId},d.navHomeResponse)}};console.log("Module ready: nav.js");return d}();console.log("running module: changePasswordPg.js");
var changePasswordPg=function(){console.log("Module ready: changePasswordPg.js");return{domId:"changePasswordPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Login</h2>"),a=render.makePasswordField("Password","changePassword1")+render.makePasswordField("Repeat Password","changePassword2"),b=render.makeButton("Change Password","changePasswordActionButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelChangePasswordButton",
"a"),b=render.makeHorzControlGroup(b+c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},""+a),d=d+a;util.setHtmlEnhanced($("#changePasswordPg"),d);$("#changePasswordActionButton").on("click",user.changePassword)},init:function(){util.delayedFocus("#changePassword1")}}}();console.log("running module: confirmPg.js");
var confirmPg=function(){var d,a,b,c,e={domId:"confirmPg",areYouSure:function(e,g,l,h){d=e;a=g;b=l;c=h;meta64.openDialog(confirmPg)},build:function(){var a;a="<h3 id='confirmPgTitle'></h3><p id='confirmPgMessage'></p>"+render.makeBackButton("Yes","confirmPgYesButton","b");a+=render.makeBackButton("No","confirmPgNoButton","a");a=render.makeTag("div",{"data-role":"content"},a);util.setHtmlEnhanced($("#confirmPg"),a);$("#confirmPgYesButton").on("click",e.runCallback)},runCallback:function(){c&&c()},
init:function(){$("#confirmPgTitle").text(d);$("#confirmPgMessage").text(a);$("#confirmPgYesButton").text(b)}};console.log("Module ready: confirmPg.js");return e}();console.log("running module: editNodePg.js");
var editNodePg=function(){console.log("Module ready: editNodePg.js");return{domId:"editNodePg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Edit Node</h2>"),a=render.makeButton("Save","saveNodeButton","b","ui-btn-icon-left ui-icon-check"),b=render.makeButton("Add Property","addPropertyButton","a"),c=render.makeButton("Make Node Referencable","makeNodeReferencableButton","a"),e=render.makeButton("Close","cancelEditButton","a"),a=render.makeHorzControlGroup(a+
b+c+e),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},"<div id='editNodePathDisplay' class='path-display-in-editor'></div><div id='editNodeInstructions'></div><div id='propertyEditFieldContainer'></div>"+a),d=d+a;util.setHtmlEnhanced($("#editNodePg"),d);$("#saveNodeButton").on("click",edit.saveNode);$("#cancelEditButton").on("click",edit.cancelEdit);$("#addPropertyButton").on("click",props.addProperty);$("#makeNodeReferencableButton").on("click",edit.makeNodeReferencable)},
init:function(){edit.populateEditNodePg()}}}();console.log("running module: editPropertyPg.js");
var editPropertyPg=function(){console.log("Module ready: editPropertyPg.js");return{domId:"editPropertyPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Edit Node Property</h2>"),a=render.makeButton("Save","savePropertyButton","b","ui-btn-icon-left ui-icon-check"),b=render.makeBackButton("Cancel","editPropertyPgCloseButton","a"),a=render.makeHorzControlGroup(a+b),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},"<div id='editPropertyPathDisplay' class='path-display-in-editor'></div><div id='addPropertyFieldContainer' class='ui-field-contain'></div>"+
a),d=d+a;util.setHtmlEnhanced($("#editPropertyPg"),d);$("#savePropertyButton").on("click",props.saveProperty)},init:function(){props.populatePropertyEdit()}}}();console.log("running module: exportPg.js");
var exportPg=function(){console.log("Module ready: exportPg.js");return{domId:"exportPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Export to XML</h2>"),a=render.makeEditField("Export to File Name","exportTargetNodeName"),b=render.makeButton("Export","exportNodesButton","b"),c=render.makeBackButton("Close","cancelExportButton","a"),b=render.makeHorzControlGroup(b+c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",{role:"main",
"class":"ui-content dialog-content"},""+a),d=d+a;util.setHtmlEnhanced($("#exportPg"),d);$("#exportNodesButton").on("click",edit.exportNodes)}}}();console.log("running module: importPg.js");
var importPg=function(){console.log("Module ready: importPg.js");return{domId:"importPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Import from XML</h2>"),a=render.makeEditField("Import Target Node Name","importTargetNodeName"),b=render.makeButton("Import","importNodesButton","b"),c=render.makeBackButton("Close","cancelImportButton","a"),b=render.makeHorzControlGroup(b+c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",
{role:"main","class":"ui-content dialog-content"},""+a),d=d+a;util.setHtmlEnhanced($("#importPg"),d);$("#importNodesButton").on("click",edit.importNodes)}}}();console.log("running module: loginPg.js");
var loginPg=function(){console.log("Module ready: loginPg.js");return{domId:"loginPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Login</h2>"),a=render.makeEditField("User","userName")+render.makePasswordField("Password","password"),b=render.makeButton("Login","loginButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelLoginButton","a"),b=render.makeHorzControlGroup(b+c),c=render.makeButton("Twitter","twitterLoginButton",
"a","ui-btn-icon-left ui-icon-user"),c=render.makeHorzControlGroup(c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},""+a+"<div><h3>Or Login With...</h3></div>"+c),d=d+a;util.setHtmlEnhanced($("#loginPg"),d);$("#loginButton").on("click",user.login);$("#twitterLoginButton").on("click",user.twitterLogin);util.bindEnterKey("#userName",user.login);util.bindEnterKey("#password",user.login)},init:function(){user.populateLoginPgFromCookies();
util.delayedFocus("#userName")}}}();console.log("running module: messagePg.js");
var messagePg=function(){var d,a,b,c={domId:"messagePg",showMessage:function(e,c,g){d=e;a=c;b=g;meta64.openDialog(messagePg)},build:function(){var a;a="<h3 id='messagePgTitle'></h3><p id='messagePgMessage'></p>"+render.makeBackButton("Ok","messagePgOkButton","b");a=render.makeTag("div",{"data-role":"content"},a);util.setHtmlEnhanced($("#messagePg"),a);$("#messagePgOkButton").on("click",c.runCallback)},runCallback:function(){b&&b()},init:function(){$("#messagePgTitle").text(d);$("#messagePgMessage").html(a)}};
console.log("Module ready: messagePg.js");return c}();console.log("running module: popupMenuPg.js");
var popupMenuPg=function(){function d(a,b){return render.makeTag("div",{style:"margin: 0px; padding: 0px;","data-role":"collapsible","data-iconpos":"right","data-shadow":"false","data-corners":"false"},"<h2 style='margin: 0px; padding: 0px;'>"+a+"</h2>"+render.makeTag("ul",{style:"margin: 0px; padding: 0px;","data-role":"listview","data-inset":"true","data-shadow":"false","data-corners":"false"},b))}function a(a,b,f){a=render.makeTag("a",{id:b,onclick:f},a);return render.makeTag("li",{"data-icon":"false"},
a)}var b={domId:"popupMenuPg",build:function(){var b=a("Change Password","changePasswordPgButton","user.changePasswordPg();")+a("Preferences","accountPreferencesPgButton","prefs.accountPreferencesPg();")+a("Insert Book: War and Peace","insertBookWarAndPeaceButton"," edit.insertBookWarAndPeace();")+a("Full Repository Export","fullRepositoryExport"," edit.fullRepositoryExport();")+a("Donate","donatePgButton","meta64.openDonatePg();"),b=d("My Account",b),e=a("Attachments","manageAttachmentsButton","attachment.openUploadPg();")+
a("Sharing","editNodeSharingButton","share.editNodeSharing();")+a("Move","moveSelNodesButton","edit.moveSelNodes();")+a("Finish Moving","finishMovingSelNodesButton","edit.finishMovingSelNodes();")+a("Rename","renameNodePgButton","edit.openRenameNodePg();")+a("Delete","deleteSelNodesButton","edit.deleteSelNodes();")+a("Clear Selections","clearSelectionsButton","edit.clearSelections();")+a("Import","openImportPgButton","edit.openImportPg();")+a("Export","openExportPgButton","edit.openExportPg();"),
e=d("Edit",e),f=a("Toggle Properties","propsToggleButton","props.propsToggle();")+a("Refresh","refreshPageButton","view.refreshPage();")+a("Show URL","showFullNodeUrlButton","render.showNodeUrl();")+a("Server Info","showServerInfoButton","view.showServerInfo();"),f=d("View Options",f),b=render.makeTag("div",{style:"margin: 0; min-width: 300px; position: fixed; top: 2em; left: 2em;","data-role":"collapsible-set"},b+e+f);util.setHtmlEnhanced($("#popupMenuPg"),b)},init:function(){var a=util.getPropertyCount(meta64.selectedNodes),
e=meta64.getHighlightedNode(),f=!util.nullOrUndef(edit.nodesToMove)&&!b.isAnonUser;util.setEnablement($("#changePasswordPgButton"),!meta64.isAnonUser);util.setEnablement($("#accountPreferencesPgButton"),!meta64.isAnonUser);util.setEnablement($("#insertBookWarAndPeaceButton"),meta64.isAdminUser&&null!=e,meta64.isAdminUser);util.setEnablement($("#fullRepositoryExport"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#donatePgButton"),!0);util.setEnablement($("#manageAttachmentsButton"),
null!=e&&!meta64.isAnonUser);util.setEnablement($("#editNodeSharingButton"),null!=e&&!meta64.isAnonUser);util.setEnablement($("#moveSelNodesButton"),null!=e&&!meta64.isAnonUser);util.setEnablement($("#renameNodePgButton"),null!=e&&!meta64.isAnonUser);util.setEnablement($("#finishMovingSelNodesButton"),f,f);util.setEnablement($("#openExportPgButton"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#openImportPgButton"),meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#showServerInfoButton"),
meta64.isAdminUser,meta64.isAdminUser);util.setEnablement($("#deleteSelNodesButton"),a)}};console.log("Module ready: popupMenuPg.js");return b}();console.log("running module: prefsPg.js");
var prefsPg=function(){console.log("Module ready: prefsPg.js");return{domId:"prefsPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Account Peferences</h2>"),a=render.makeRadioButton("Simple","editModeRadioGroup","editModeSimple",!0)+render.makeRadioButton("Advanced","editModeRadioGroup","editModeAdvanced",!1),a=render.makeHorzControlGroup("<legend>Edit Mode:</legend>"+a),b=render.makeButton("Save","savePreferencesButton","b","ui-btn-icon-left ui-icon-check"),
c=render.makeBackButton("Cancel","cancelPreferencesPgButton","a"),b=render.makeHorzControlGroup(b+c),c=render.makeButton("Close Account","closeAccountButton","a"),c=render.makeHorzControlGroup(c),c=render.makeTag("div",{"class":"close-account-bar"},c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},""+a),d=d+a+c;util.setHtmlEnhanced($("#prefsPg"),d);$("#savePreferencesButton").on("click",prefs.savePreferences);$("#closeAccountButton").on("click",
prefs.closeAccount)}}}();console.log("running module: renameNodePg.js");
var renameNodePg=function(){console.log("Module ready: renameNodePg.js");return{domId:"renameNodePg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Rename Node</h2>"),a=render.makeEditField("Enter new name for the node","newNodeNameEditField"),b=render.makeButton("Rename","renameNodeButton","b"),c=render.makeBackButton("Close","cancelRenameNodeButton","a"),b=render.makeHorzControlGroup(b+c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",
{role:"main","class":"ui-content dialog-content"},""+a),d=d+a;util.setHtmlEnhanced($("#renameNodePg"),d);$("#renameNodeButton").on("click",edit.renameNode)}}}();console.log("running module: searchPg.js");
var searchPg=function(){console.log("Module ready: searchPg.js");return{domId:"searchPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Search</h2>"),a=render.makeEditField("Search","searchText"),b=render.makeButton("Search","searchNodesButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelSearchButton","a"),b=render.makeHorzControlGroup(b+c),a=render.makeTag("div",{"class":"ui-field-contain"},a+b),a=render.makeTag("div",
{role:"main","class":"ui-content dialog-content"},""+a),d=d+a;util.setHtmlEnhanced($("#searchPg"),d);$("#searchNodesButton").on("click",srch.searchNodes);util.bindEnterKey("#searchText",srch.searchNodes)},init:function(){util.delayedFocus("#searchText")}}}();console.log("running module: searchResultsPg.js");
var searchResultsPg=function(){console.log("Module ready: searchResultsPg.js");return{domId:"searchResultsPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},render.makeButton("Back to Content","cancelSearchResultsButton","b")+"<h2>"+BRANDING_TITLE+" - Search Results</h2>"),a=render.makeTag("div",{role:"main","class":"ui-content"},"<div id='searchResultsView'></div>"),d=d+a;util.setHtmlEnhanced($("#searchResultsPg"),d);$("#cancelSearchResultsButton").on("click",function(){meta64.jqueryChangePage("#mainPage");
view.scrollToSelectedNode()})},init:function(){srch.populateSearchResultsPage()}}}();console.log("running module: shareToPersonPg.js");
var shareToPersonPg=function(){console.log("Module ready: shareToPersonPg.js");return{domId:"shareToPersonPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Share Node to Person</h2>"),a=render.makeEditField("User to Share With","shareToUserName"),b=render.makeButton("Share","shareNodeToPersonButton","b","ui-btn-icon-left ui-icon-check"),c=render.makeBackButton("Close","cancelShareNodeToPersonButton","a"),b=render.makeHorzControlGroup(b+c),a=render.makeTag("div",
{"class":"ui-field-contain"},a+b),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},"Enter the username of the person you want to share this node with:"+a),d=d+a;util.setHtmlEnhanced($("#shareToPersonPg"),d);$("#shareNodeToPersonButton").on("click",share.shareNodeToPerson)}}}();console.log("running module: sharingPg.js");
var sharingPg=function(){console.log("Module ready: sharingPg.js");return{domId:"sharingPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Node Sharing</h2>"),a=render.makeButton("Share with Person","shareNodeToPersonPgButton","a"),b=render.makeButton("Share to Public","shareNodeToPublicButton","a"),c=render.makeBackButton("Close","cancelSharingButton","a"),a=render.makeHorzControlGroup(a+b+c),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},
"<div id='shareNodeNameDisplay'></div><div id='sharingListFieldContainer'></div>"+a),d=d+a;util.setHtmlEnhanced($("#sharingPg"),d);$("#shareNodeToPersonPgButton").on("click",share.shareNodeToPersonPg);$("#shareNodeToPublicButton").on("click",share.shareNodeToPublic)},init:function(){share.reload()}}}();console.log("running module: signupPg.js");
var signupPg=function(){var d={domId:"signupPg",build:function(){var a=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Signup</h2>"),b=render.makeEditField("User","signupUserName")+render.makePasswordField("Password","signupPassword")+render.makeEditField("Email","signupEmail")+render.makeEditField("Captcha","signupCaptcha"),c=render.makeTag("div",{"class":"captcha-image"},render.makeTag("img",{id:"captchaImage","class":"captcha",src:""},"",!1)),e=render.makeButton("Signup",
"signupButton","b","ui-btn-icon-left ui-icon-check"),f=render.makeButton("Try Different Image","tryAnotherCaptchaButton","a"),g=render.makeBackButton("Close","cancelSignupButton","a"),e=render.makeHorzControlGroup(e+f+g),b=render.makeTag("div",{"class":"ui-field-contain"},b+c+e),b=render.makeTag("div",{role:"main","class":"ui-content dialog-content",id:d.domId+"-main"},""+b),a=a+b;util.setHtmlEnhanced($("#signupPg"),a);$("#tryAnotherCaptchaButton").on("click",user.tryAnotherCaptcha);$("#signupButton").on("click",
user.signup)},init:function(){user.pageInitSignupPg();util.delayedFocus("#signupUserName")}};console.log("Module ready: signupPg.js");return d}();console.log("running module: uploadPg.js");
var uploadPg=function(){console.log("Module ready: uploadPg.js");return{domId:"uploadPg",build:function(){var d=render.makeTag("div",{"data-role":"header"},"<h2>"+BRANDING_TITLE+" - Upload File Attachment</h2>"),a=render.makeTag("div",{id:"uploadPathDisplay","class":"path-display-in-editor"},""),b=render.makeTag("input",{type:"file",name:"file"},"",!0)+render.makeTag("input",{id:"uploadFormNodeId",type:"hidden",name:"nodeId"}),b=render.makeTag("form",{id:"uploadForm",method:"POST",enctype:"multipart/form-data"},
b),b=render.makeTag("div",{id:"uploadFieldContainer"},"<p>Upload from your computer</p>"+b),c=render.makeEditField("Upload From URL","uploadFromUrl"),c=render.makeTag("div",{},c),e=render.makeButton("Upload","uploadButton","b","ui-btn-icon-left ui-icon-check"),f=render.makeButton("Delete","deleteAttachmentButton","a"),g=render.makeBackButton("Close","closeUploadButton","a"),e=render.makeHorzControlGroup(e+f+g),a=render.makeTag("div",{role:"main","class":"ui-content dialog-content"},a+b+"<div><h3>-- OR --</h3></div>"+
c+e);util.setHtmlEnhanced($("#uploadPg"),d+a);$("#uploadButton").on("click",attachment.uploadFileNow);$("#deleteAttachmentButton").on("click",attachment.deleteAttachment)},init:function(){$("#uploadFromUrl").val("");$("#uploadPathDisplay").html("Path: "+render.formatPath(attachment.uploadNode))}}}();console.log("running module: prefs.js");
var prefs=function(){var d={savePreferencesResponse:function(a){util.checkSuccess("Saving Preferences",a)&&(meta64.jqueryChangePage("#mainPage"),view.scrollToSelectedNode())},closeAccountResponse:function(){$(window).off("beforeunload");window.location.href=window.location.origin},closeAccount:function(){confirmPg.areYouSure("Oh No!","Close your Account? Are you sure? This was so unexpected!","Yes, Close Account.",function(){util.json("closeAccount",{},d.closeAccountResponse)})},savePreferences:function(){meta64.editModeOption=
$("#editModeSimple").is(":checked")?meta64.MODE_SIMPLE:meta64.MODE_ADVANCED;util.json("saveUserPreferences",{userPreferences:{advancedMode:meta64.editModeOption===meta64.MODE_ADVANCED}},d.savePreferencesResponse)},populatePreferencesPg:function(){$("#editModeSimple").prop("checked",meta64.editModeOption===meta64.MODE_SIMPLE).checkboxradio("refresh");$("#editModeAdvanced").prop("checked",meta64.editModeOption===meta64.MODE_ADVANCED).checkboxradio("refresh")},accountPreferencesPg:function(){meta64.changePage(prefsPg);
d.populatePreferencesPg()}};console.log("Module ready: prefs.js");return d}();console.log("running module: props.js");
var props=function(){var d=function(a){util.checkSuccess("Save properties",a);edit.editNode.properties.push(a.propertySaved);meta64.changePage(editNodePg);meta64.treeDirty=!0},a={propsToggle:function(){meta64.showProperties=meta64.showProperties?!1:!0;var a=$("#propsToggleButton");a.toggleClass("ui-icon-grid",meta64.showProperties);a.toggleClass("ui-icon-forbidden",!meta64.showProperties);render.renderPageFromData();view.scrollToSelectedNode();meta64.jqueryChangePage("#mainPage")},deleteProperty:function(b){confirmPg.areYouSure("Confirm Delete",
"Delete the Property","Yes, delete.",function(){a.deletePropertyImmediate(b)})},deletePropertyImmediate:function(a){util.json("deleteProperty",{nodeId:edit.editNode.id,propName:a}).done(function(c){util.checkSuccess("Delete property",c)&&(props.deletePropertyFromLocalData(a),meta64.changePage(editNodePg),meta64.treeDirty=!0)})},addProperty:function(){meta64.changePage(editPropertyPg)},populatePropertyEdit:function(){var a;a=""+render.makeTag("label",{"for":"addPropertyNameTextContent"},"Name");a+=
render.makeTag("textarea",{name:"addPropertyNameTextContent",id:"addPropertyNameTextContent",placeholder:"Enter property name"},"");a+=render.makeTag("label",{"for":"addPropertyValueTextContent"},"Value");a+=render.makeTag("textarea",{name:"addPropertyValueTextContent",id:"addPropertyValueTextContent",placeholder:"Enter property text"},"");view.initEditPathDisplayById("#editPropertyPathDisplay");util.setHtmlEnhanced($("#addPropertyFieldContainer"),a)},saveProperty:function(){var a=$("#addPropertyNameTextContent").val(),
c=$("#addPropertyValueTextContent").val();util.json("saveProperty",{nodeId:edit.editNode.id,propertyName:a,propertyValue:c},d)},addSubProperty:function(a){a=meta64.fieldIdToPropMap[a];util.isObject(a.values)||(a.values=[],a.values.push(a.value),a.value=null);a.values.push("");edit.populateEditNodePg()},clearProperty:function(a){var c=$("#"+a);0!=c.length&&c.val("");for(var e=0;1E3>e;){c=$("#"+a+"_subProp"+e);if(0==c.length)break;c.val("");e++}},deletePropertyFromLocalData:function(a){for(var c=0;c<
edit.editNode.properties.length;c++)if(a===edit.editNode.properties[c].name){edit.editNode.properties.splice(c,1);break}},makeMultiPropEditor:function(a,c,e,f){var d="",l=c.values;l&&0!=l.length||(l=[],l.push(""));for(var h=0;h<l.length;h++){console.log("prop multi-val["+h+"]="+l[h]);var m=a+"_subProp"+h,d=d+render.makeTag("label",{"for":m},(0==h?c.name:"*")+"."+h),n=f?"[binary]":l[h],d=f||e?d+render.makeTag("textarea",{id:m,readonly:"readonly",disabled:"disabled"},n?n:""):d+render.makeTag("textarea",
{id:m},n?n:"")}return d},setPreferredPropertyOrder:function(a){if(a){var c=[];$.each(a,function(a,b){b.name===jcrCnst.CONTENT?c.unshift(b):c.push(b)});return c}},renderProperties:function(a){if(a){var c="<table data-role='table' class='prop-table ui-responsive ui-shadow table-stripe property-text'>",e=0,c=c+"<thead><tr><th></th><th></th></tr></thead>",c=c+"<tbody>";$.each(a,function(a,b){if(render.allowPropertyToDisplay(b.name)){var d=render.isBinaryProperty(b.name);e++;c+="<tr class='prop-table-row'>";
c+="<td class='prop-table-name-col'>"+render.sanitizePropertyName(b.name)+"</td>";c=d?c+"<td class='prop-table-val-col'>[binary]</td>":b.values?c+("<td class='prop-table-val-col'>"+props.renderPropertyValues(b.values)+"</td>"):c+("<td class='prop-table-val-col'>"+render.wrapHtml(b.htmlValue?b.htmlValue:b.value)+"</td>");c+="</tr>"}else console.log("Hiding property: "+b.name)});return 0==e?"":c+="</tbody></table>"}},getNodeProperty:function(a,c){if(!c||!c.properties)return null;for(var e=0;e<c.properties.length;e++){var f=
c.properties[e];if(f.name===a)return f}return null},getNodePropertyVal:function(b,c){var e=a.getNodeProperty(b,c);return e?e.value:null},renderProperty:function(b){return b.values?a.renderPropertyValues(b.values):b.value&&0!=b.value.length?render.wrapHtml(b.htmlValue):""},renderPropertyValues:function(a){var c="<div>";$.each(a,function(a,b){c+=render.wrapHtml(b)+cnst.BR});return c+="</div>"}};console.log("Module ready: props.js");return a}();console.log("running module: render.js");
var render=function(){var d={buildPage:function(a){a.built||(a.build(),a.built=!0);a.init&&a.init()},renderNodeContent:function(a,b,c,e){var f="",g;g=""+d.getTopRightImageTag(a);var l=props.getNodePropertyVal(jcrCnst.COMMENT_BY,a);if(b&&meta64.editMode){f+="<div class='path-display'>Path: "+d.formatPath(a)+"</div>";f+="<div>";if(l)var h=l===meta64.userName?"created-by-me":"created-by-other",f=f+("<span class='"+h+"'>Comment By: "+l+"</span>");else a.createdBy&&(h=a.createdBy===meta64.userName?"created-by-me":
"created-by-other",f+="<span class='"+h+"'>Created By: "+a.createdBy+"</span>");f+="<span id='ownerDisplay"+a.uid+"'></span>";a.lastModified&&(f+="  Modified: "+a.lastModified);f+="</div>"}c&&!b&&a.name&&(f+="Name: "+a.name+" [uid="+a.uid+"]");f&&(g+=d.makeTag("div",{"class":"header-text"},f));if(meta64.showProperties)(b=props.renderProperties(a.properties))&&(g+=b);else if(b=props.getNodeProperty(jcrCnst.CONTENT,a))b=props.renderProperty(b),0<b.length&&(g+=d.makeTag("div",{"class":"jcr-content"},
d.wrapHtml(b)));e&&a.hasBinary&&(a.binaryIsImage?e=d.makeImageTag(a):(e=d.makeTag("a",{href:d.getUrlForNodeAttachment(a)},"[Download Attachment]"),e=d.makeTag("div",{"class":"binary-link"},e)),g=g.contains(cnst.INSERT_ATTACHMENT)?g.replaceAll(cnst.INSERT_ATTACHMENT,e):g+e);l&&l!=meta64.userName?(a=d.makeTag("a",{onClick:"edit.replyToComment('"+a.uid+"');","class":"ui-btn ui-btn-b ui-btn-inline ui-icon-plus ui-mini ui-btn-icon-comment"},"Reply"),g+=a):props.getNodePropertyVal(jcrCnst.PUBLIC_APPEND,
a)&&l!=meta64.userName&&(a=d.makeTag("a",{onClick:"edit.replyToComment('"+a.uid+"');","class":"ui-btn ui-btn-b ui-btn-inline ui-icon-plus ui-mini ui-btn-icon-comment"},"Add Comment"),g+=a);return g},renderNodeAsListItem:function(a,b,c,e){var f=a.uid,g=a.id===meta64.newChildNodeId;e=0<b&&1<e;b=b<c-1;c=a.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");c=meta64.isAdminUser||!c;var l=meta64.getHighlightedNode();!g&&l&&l.uid===f&&(g=!0);e=d.makeRowButtonBarHtml(f,e,b,c);b=d.getNodeBkgImageStyle(a);
return d.makeTag("div",{"class":"node-table-row"+(g?" active-row":" inactive-row"),onClick:"nav.clickOnNodeRow(this, '"+f+"');",id:f+"_row",style:b},e+d.makeTag("div",{id:f+"_content"},d.renderNodeContent(a,!0,!0,!0)))},showNodeUrl:function(){var a=meta64.getHighlightedNode();if(a){var b=window.location.origin+"?id="+a.path;meta64.jqueryChangePage("#mainPage");b="URL using path: <br>"+b;(a=props.getNodePropertyVal("jcr:uuid",a))&&(b+="<p>URL for UUID: <br>"+window.location.origin+"?id="+a);messagePg.showMessage("URL of Node",
b)}else alert("You must first click on a node.")},getTopRightImageTag:function(a){a=props.getNodePropertyVal("img.top.right",a);var b="";a&&(b=d.makeTag("img",{src:a,"class":"top-right-image"},"",!1));return b},getNodeBkgImageStyle:function(a){a=props.getNodePropertyVal("img.node.bkg",a);var b="";a&&(b="background-image: url("+a+");");return b},makeRowButtonBarHtml:function(a,b,c,e){var f=selButton=createSubNodeButton=editNodeButton=moveNodeUpButton=moveNodeDownButton=insertNodeButton="";d.nodeHasChildren(a)&&
(f=d.makeTag("a",{onClick:"nav.openNode('"+a+"');","class":"ui-btn ui-btn-b ui-btn-inline ui-icon-plus ui-mini ui-btn-icon-left"},"Open"));meta64.editMode&&(selButton=d.makeTag("a",{id:a+"_sel",onClick:"nav.toggleNodeSel('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-check ui-mini ui-btn-icon-left "+(meta64.selectedNodes[a]?"ui-btn-b":"ui-btn-a")},"Sel"),cnst.NEW_ON_TOOLBAR&&(createSubNodeButton=d.makeTag("a",{onClick:"edit.createSubNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-star ui-mini ui-btn-icon-left"},
"New")),cnst.INS_ON_TOOLBAR&&(insertNodeButton=d.makeTag("a",{onClick:"edit.insertNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-bars ui-mini ui-btn-icon-left"},"Ins")));meta64.editMode&&e&&(editNodeButton=d.makeTag("a",{onClick:"edit.runEditNode('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-edit ui-mini ui-btn-icon-left"},"Edit"),meta64.currentNode.childrenOrdered&&(b&&(moveNodeUpButton=d.makeTag("a",{onClick:"edit.moveNodeUp('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-arrow-u ui-mini ui-btn-icon-left"},
"Up")),c&&(moveNodeDownButton=d.makeTag("a",{onClick:"edit.moveNodeDown('"+a+"');","class":"ui-btn ui-btn-inline ui-icon-arrow-d ui-mini ui-btn-icon-left"},"Dn"))));a=selButton+f+insertNodeButton+createSubNodeButton+editNodeButton+moveNodeUpButton+moveNodeDownButton;return 0<a.length?d.makeHorizontalFieldSet(a,"compact-field-contain"):""},makeHorizontalFieldSet:function(a,b){var c=d.makeTag("fieldset",{"data-role":"controlgroup","data-type":"horizontal"},a);return d.makeTag("div",{"class":"ui-field-contain"+
(b?" "+b:"")},c)},makeHorzControlGroup:function(a){return d.makeTag("div",{"data-role":"controlgroup","data-type":"horizontal"},a)},makeRadioButton:function(a,b,c,e){return d.makeTag("input",{type:"radio",name:b,id:c,checked:e?"checked":"unchecked"},"",!0)+d.makeTag("label",{"for":c},a)},nodeHasChildren:function(a){var b=meta64.uidToNodeMap[a];if(b)return b.hasChildren;console.log("Unknown nodeId in nodeHasChildren: "+a);return!1},formatPath:function(a){var b=a.path,b=meta64.isAdminUser?b:b.replaceAll("/root",
"");return b+=" ["+a.primaryTypeName+"]"},wrapHtml:function(a){return"<div data-ajax='false'>"+a+"</div>"},renderMainPageControls:function(){var a="";0<srch.numSearchResults()&&(a+=render.makeTag("a",{onClick:"nav.showSearchPage();","class":"ui-btn ui-btn-inline ui-icon-search ui-btn-icon-left"},"Back to Search Results"));var b=0<a.length;b&&util.setHtmlEnhanced($("#mainPageControls"),a);util.setVisibility("#mainPageControls",b)},renderPageFromData:function(a){var b=!1;a?b=!0:a=meta64.currentNodeData;
if(a&&a.node){util.setVisibility("#listView",!0);d.renderMainPageControls();meta64.treeDirty=!1;b&&(meta64.uidToNodeMap={},meta64.idToNodeMap={},meta64.selectedNodes={},meta64.initNode(a.node),meta64.setCurrentNodeData(a));var c="",e=d.getNodeBkgImageStyle(a.node),f=d.renderNodeContent(a.node,!0,!0,!0);if(0<f.length){var g=a.node.uid,l=g+"_row",h="";meta64.editMode&&"/"!=a.node.path&&(h=d.makeTag("a",{onClick:"edit.runEditNode('"+g+"');","class":"ui-btn ui-btn-inline ui-icon-edit ui-mini ui-btn-icon-left"},
"Edit"),h=d.makeHorizontalFieldSet(h,"compact-field-contain page-top-button-bar"));var m=meta64.getHighlightedNode(),e=d.makeTag("div",{"class":"node-table-row page-parent-node "+(m&&m.uid===g?" active-row":" inactive-row"),onClick:"nav.clickOnNodeRow(this, '"+g+"');",id:l,style:e},h+f);$("#mainNodeContent").show();$("#mainNodeContent").html(e)}else $("#mainNodeContent").hide();$("#mainNodeContent").trigger("updatelayout");view.updateStatusBar();d.renderMainPageControls();if(a.children){var n=a.children.length,
p=0;$.each(a.children,function(a,e){var f=d.generateRow(a,e,b,n,p);0!=f.length&&(c+=f,p++)})}0!=c.length||meta64.isAnonUser||(c=d.makeTag("a",{onClick:"edit.createSubNode();","class":"ui-btn ui-btn-inline ui-icon-star ui-btn-icon-left"},"Create Content"));util.setHtmlEnhancedById("#listView",c);meta64.screenSizeChange();meta64.getHighlightedNode()||util.scrollToTop()}else util.setVisibility("#listView",!1),$("#mainNodeContent").html("No content is available here.")},generateRow:function(a,b,c,e,f){if(meta64.isNodeBlackListed(b))return"";
c&&meta64.initNode(b);f++;return d.renderNodeAsListItem(b,a,e,f)},getUrlForNodeAttachment:function(a){return postTargetUrl+"bin/file-name?nodeId="+encodeURIComponent(a.path)+"&ver="+a.binVer},adjustImageSize:function(a){var b=$("#"+a.imgId);b&&a.width&&a.height&&(a.width>meta64.deviceWidth-80?(b.attr("width","100%"),b.attr("height","auto"),b.attr("style","max-width: "+maxWidth+"px;")):(b.attr("width",a.width),b.attr("height",a.height)))},makeImageTag:function(a){var b=d.getUrlForNodeAttachment(a);
a.imgId="imgUid_"+a.uid;if(a.width&&a.height){if(a.width>meta64.deviceWidth-50){var c=meta64.deviceWidth-50;return d.makeTag("img",{src:b,id:a.imgId,width:c+"px",height:c*a.height/a.width+"px"},null,!1)}return d.makeTag("img",{src:b,id:a.imgId,width:a.width+"px",height:a.height+"px"},null,!1)}return d.makeTag("img",{src:b,id:a.imgId},null,!1)},makeTag:function(a,b,c,e){"undefined"===typeof e&&(e=!0);var f="<"+a;b&&(f+=" ",$.each(b,function(a,b){f=b.contains("'")?f+(a+'="'+b+'" '):f+(a+"='"+b+"' ")}));
return f=e?f+(">"+c+"</"+a+">"):f+"/>"},makeEditField:function(a,b){return d.makeTag("label",{"for":b},a)+d.makeTag("input",{type:"text",name:b,id:b},"",!0)},makePasswordField:function(a,b){return d.makeTag("label",{"for":b},a)+d.makeTag("input",{type:"password",name:b,id:b},"",!0)},makeButton:function(a,b,c,e){c="ui-btn ui-btn-inline ui-btn-"+c;e&&(c+=" "+e);return render.makeTag("a",{id:b,"class":c},a)},makeBackButton:function(a,b,c){return render.makeTag("a",{id:b,"class":"ui-btn ui-icon-carat-l ui-btn-inline ui-btn-"+
c,"data-rel":"back"},a)},allowPropertyToDisplay:function(a){return meta64.inSimpleMode()?null==meta64.simpleModePropertyBlackList[a]:!0},isReadOnlyProperty:function(a){return meta64.readOnlyPropertyList[a]},isBinaryProperty:function(a){return meta64.binaryPropertyList[a]},sanitizePropertyName:function(a){return"simple"===meta64.editModeOption?a===jcrCnst.CONTENT?"Content":a:a}};console.log("Module ready: render.js");return d}();console.log("running module: search.js");
var srch=function(){var d=function(b){a.searchResults=b;meta64.changePage(searchResultsPg)},a={searchResults:null,highlightRowNode:null,identToUidMap:{},uidToNodeMap:{},numSearchResults:function(){return null!=srch.searchResults&&null!=srch.searchResults.searchResults&&null!=srch.searchResults.searchResults.length?srch.searchResults.searchResults.length:0},searchNodes:function(){if(util.ajaxReady("searchNodes")){var a=meta64.getHighlightedNode();if(a){var c=$.trim($("#searchText").val());util.emptyString(c)?
alert("Enter search text."):util.json("nodeSearch",{nodeId:a.id,searchText:c,modSortDesc:!1},d)}else alert("No node is selected to search under.")}},timeline:function(){var a=meta64.getHighlightedNode();a?util.json("nodeSearch",{nodeId:a.id,searchText:"",modSortDesc:!0},d):alert("No node is selected to search under.")},searchPg:function(){meta64.changePage(searchPg)},initSearchNode:function(b){b.uid=util.getUidForId(a.identToUidMap,b.id);a.uidToNodeMap[b.uid]=b},populateSearchResultsPage:function(b){b||
(b=a.searchResults);var c="",e=b.searchResults.length,f=0;$.each(b.searchResults,function(b,d){meta64.isNodeBlackListed(d)||(a.initSearchNode(d),f++,c+=a.renderSearchResultAsListItem(d,b,e,f))});util.setHtmlEnhanced($("#searchResultsView"),c)},renderSearchResultAsListItem:function(b,c,e,d){c=b.uid;b.name.startsWith("rep:")||meta64.currentNodeData.node.path.contains("/rep:");return render.makeTag("div",{"class":"node-table-row inactive-row",onClick:"srch.clickOnSearchResultRow(this, '"+c+"');",id:c+
"_srch_row"},a.makeButtonBarHtml(c)+render.makeTag("div",{id:c+"_srch_content"},render.renderNodeContent(b,!0,!0,!0)))},makeButtonBarHtml:function(a){a=render.makeTag("a",{onClick:"srch.clickSearchNode('"+a+"');","class":"ui-btn ui-mini ui-btn-b ui-btn-inline ui-icon-carat-l ui-btn-icon-left"},"Go to Node");return render.makeHorizontalFieldSet(a,"compact-field-contain")},clickOnSearchResultRow:function(b,c){a.unhighlightRow();a.highlightRowNode=a.uidToNodeMap[c];util.changeOrAddClass(b,"inactive-row",
"active-row")},clickSearchNode:function(a){srch.highlightRowNode=srch.uidToNodeMap[a];view.refreshTree(srch.highlightRowNode.id,!0);meta64.jqueryChangePage("#mainPage")},unhighlightRow:function(){if(a.highlightRowNode){var b=util.domElm(a.highlightRowNode.uid+"_srch_row");b&&util.changeOrAddClass(b,"active-row","inactive-row")}}};console.log("Module ready: search.js");return a}();console.log("running module: user.js");
var share=function(){var d=function(a){c.populateSharingPg(a)},a=function(a,b){var c="";$.each(b.privileges,function(b,d){var f=render.makeTag("a",{onClick:"share.removePrivilege('"+a+"', '"+d.privilegeName+"');","class":"ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left"},"Remove"),f=render.makeHorizontalFieldSet(f),f=f+("<b>"+a+"</b> has privilege <b>"+d.privilegeName+"</b> on this node.");c+=render.makeTag("div",{"class":"privilege-entry"},f)});return c},b=function(a){util.json("getNodePrivileges",
{nodeId:c.sharingNode.path,includeAcl:!0,includeOwners:!0},d)},c={sharingNode:null,populateSharingPg:function(b){var d="<h2>Node Share Settings</h2>";$.each(b.aclEntries,function(b,c){d+="<h4>User: "+c.principalName+"</h4>";d+=render.makeTag("div",{"class":"privilege-list"},a(c.principalName,c))});d+=render.makeTag("input",{type:"checkbox",name:"allowPublicCommenting",id:"allowPublicCommenting"},"",!1);d+=render.makeTag("label",{"for":"allowPublicCommenting"},"Allow public commenting under this node.",
!0);util.setHtmlEnhanced($("#sharingListFieldContainer"),d);util.setCheckboxVal("#allowPublicCommenting",b.publicAppend);$("#allowPublicCommenting").bind("change",c.publicCommentingChanged)},publicCommentingChanged:function(){var a=$("#allowPublicCommenting").is(":checked");util.json("addPrivilege",{nodeId:c.sharingNode.id,publicAppend:a?"true":"false"},null)},removePrivilege:function(a,d){util.json("removePrivilege",{nodeId:c.sharingNode.id,principal:a,privilege:d},b)},shareNodeToPersonPg:function(){meta64.changePage(shareToPersonPg)},
shareNodeToPerson:function(){var a=$("#shareToUserName").val();a?util.json("addPrivilege",{nodeId:c.sharingNode.id,principal:a,privileges:["read","write","addChildren","nodeTypeManagement"]},c.reloadFromShareWithPerson):alert("Please enter a username")},shareNodeToPublic:function(){console.log("Sharing node to public.");util.json("addPrivilege",{nodeId:c.sharingNode.id,principal:"everyone",privileges:["read"]},c.reload)},editNodeSharing:function(){var a=meta64.getHighlightedNode();a?(c.sharingNode=
a,meta64.changePage(sharingPg)):alert("No node is selected.")},reloadFromShareWithPerson:function(a){util.checkSuccess("Share Node with Person",a)&&meta64.changePage(sharingPg)},reload:function(){console.log("Loading node sharing info.");util.json("getNodePrivileges",{nodeId:c.sharingNode.id,includeAcl:!0,includeOwners:!0},d)}};console.log("Module ready: share.js");return c}();console.log("running module: user.js");
var user=function(){var d=function(a){var b=BRANDING_TITLE;meta64.isAnonUser||(b+=" - "+a.userName);$("#headerUserName").html(b);a=meta64.isAnonUser;$("#openLoginPgButton").text(a?"Login":"Logout")},a=function(a){a.rootNode&&(meta64.homeNodeId=a.rootNode.id,meta64.homeNodePath=a.rootNode.path);meta64.userName=a.userName;meta64.isAdminUser="admin"===a.userName;meta64.isAnonUser="anonymous"===a.userName;meta64.anonUserLandingPageNode=a.anonUserLandingPageNode;meta64.editModeOption=a.userPreferences.advancedMode?
meta64.MODE_ADVANCED:meta64.MODE_SIMPLE},b=function(b,c,e,f){util.checkSuccess("Login",b)?(console.log("info.usr="+c+" homeNodeOverride: "+b.homeNodeOverride),"anonymous"!=c&&(g.writeCookie(cnst.COOKIE_LOGIN_USR,c),g.writeCookie(cnst.COOKIE_LOGIN_PWD,e),g.writeCookie(cnst.COOKIE_LOGIN_STATE,"1")),meta64.jqueryChangePage("#mainPage"),a(b),b.userPreferences.lastNode?console.log("lastNode: "+b.userPreferences.lastNode):console.log("lastNode is null."),c=null,util.emptyString(b.homeNodeOverride)?b.userPreferences.lastNode?
(console.log("loading lastNode="+b.userPreferences.lastNode),c=b.userPreferences.lastNode):(console.log("loading homeNodeId="+meta64.homeNodeId),c=meta64.homeNodeId):(console.log("loading homeNodeOverride="+b.homeNodeOverride),c=b.homeNodeOverride),view.refreshTree(c,!1),d(b)):f&&(alert("Cookie login failed."),$.removeCookie(cnst.COOKIE_LOGIN_USR),$.removeCookie(cnst.COOKIE_LOGIN_PWD),$.writeCookie(cnst.COOKIE_LOGIN_STATE,"0"),location.reload())},c=function(a){window.location.href=window.location.origin},
e=function(a){util.checkSuccess("Change password",a)&&alert("Password changed successfully.")},f=function(a){util.checkSuccess("Signup new user",a)&&(user.populateLoginPgFromCookies(),meta64.changePage(loginPg),alert("User Information Accepted. \n\nCheck your email for signup confirmation. (Can take up to 1 minute)"))},g={twitterLogin:function(){$(window).off("beforeunload");window.location.href=window.location.origin+"/twitterLogin"},openSignupPg:function(){meta64.changePage(signupPg)},writeCookie:function(a,
b){$.cookie(a,b,{expires:365,path:"/"})},populateLoginPgFromCookies:function(){var a=$.cookie(cnst.COOKIE_LOGIN_USR),b=$.cookie(cnst.COOKIE_LOGIN_PWD);a&&$("#userName").val(a);b&&$("#password").val(b)},openLoginPg:function(){meta64.isAnonUser?meta64.changePage(loginPg):g.logout(!0)},signup:function(){var a=util.getRequiredElement("#signupUserName").val(),b=util.getRequiredElement("#signupPassword").val(),c=util.getRequiredElement("#signupEmail").val(),e=util.getRequiredElement("#signupCaptcha").val();
util.anyEmpty(a,b,c,e)?alert("Sorry, you cannot leave any fields blank."):util.json("signup",{userName:a,password:b,email:c,captcha:e},f)},pageInitSignupPg:function(){user.tryAnotherCaptcha()},tryAnotherCaptcha:function(){var a=util.currentTimeMillis(),a=postTargetUrl+"captcha?t="+a;$("#captchaImage").attr("src",a)},refreshLogin:function(){console.log("refreshLogin.");var c,e,f=!1;if("true"===$("#loginSessionReady").text())console.log("    loginSessionReady = true"),e=c="",f=!0;else{console.log("    loginSessionReady = false");
if("0"===$.cookie(cnst.COOKIE_LOGIN_STATE)){meta64.loadAnonPageHome(!1);return}var g=$.cookie(cnst.COOKIE_LOGIN_USR),p=$.cookie(cnst.COOKIE_LOGIN_PWD),f=!util.emptyString(g)&&!util.emptyString(p);console.log("cookieUser="+g+" usingCookies = "+f);c=g?g:"";e=p?p:""}console.log("refreshLogin with name: "+c);g=util.json("login",{userName:c,password:e,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime});f?g.done(function(a){b(a,c,e,f)}):g.done(function(b){console.log("refreshLoginResponse");
a(b);d(b);meta64.loadAnonPageHome(!1)})},login:function(){var a=$.trim($("#userName").val()),c=$.trim($("#password").val());util.json("login",{userName:a,password:c,tzOffset:(new Date).getTimezoneOffset(),dst:util.daylightSavingsTime}).done(function(e){b(e,a,c)})},logout:function(a){meta64.isAnonUser||($(window).off("beforeunload"),a&&user.writeCookie(cnst.COOKIE_LOGIN_STATE,"0"),util.json("logout",{},c))},changePassword:function(){var a=util.getRequiredElement("#changePassword1").val(),b=util.getRequiredElement("#changePassword2").val();
a&&4<=a.length&&a===b?util.json("changePassword",{newPassword:a},e):alert("Sorry, invalid password(s).")},changePasswordPg:function(){meta64.changePage(changePasswordPg)}};console.log("Module ready: user.js");return g}();console.log("running module: util.js");
var util=function(){var d=!1,a=!1;Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)});"function"!=typeof String.prototype.contains&&(String.prototype.contains=function(a){return-1!=
this.indexOf(a)});"function"!=typeof String.prototype.replaceAll&&(String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),b)});var b=0,c={daylightSavingsTime:(new Date).dst()?!0:!1,json:function(c,f,g){if(a)console.log("offline: ignoring call for "+c);else return b++,c=$.ajax({url:postTargetUrl+c,contentType:"application/json",type:"post",dataType:"json",cache:!1,data:JSON.stringify(f)}),c.done(function(a){"function"==typeof g&&
g(a)}),c.fail(function(b){if("403"==b.status)console.log("Not logged in detected in util."),a=!0,d||(d=!0,alert("Session timed out. Page will refresh.")),$(window).off("beforeunload"),window.location.href=window.location.origin;else{var c="Server request failed.\n\n";try{c+="Status: "+b.statusText+"\n",c+="Code: "+b.status+"\n"}catch(e){}alert(c)}}),c.complete(function(){b--}),c},ajaxReady:function(a){return 0<b?(console.log("Ignoring requests: "+a+". Ajax currently in progress."),!1):!0},isAjaxWaiting:function(){return 0<
b},delayedFocus:function(a){setTimeout(function(){$(a).focus()},500)},checkSuccess:function(a,b){b.success||alert(a+" failed: "+b.message);return b.success},addAll:function(a,b){for(var c=0;c<b.length;c++)b[c]?a[b[c]]=!0:console.error("null element in addAll at idx="+c)},nullOrUndef:function(a){return null===a||void 0===a},getUidForId:function(a,b){var c=a[b];c||(c=meta64.nextUid++,a[b]=c);return c},getPreviousPage:function(){var a="#"+$.mobile.activePage.prev('div[data-role="page"]')[0].id;alert("prevPage="+
a);return a},domElm:function(a){if(a.contains("#"))return console.log("do not use # in domElm"),null;var b=document.getElementById(a);b&&0!=b.length||console.log("domElm Error. Required element id not found: "+a);return b},getRequiredElement:function(a){var b=$(a);null==b&&console.log("getRequiredElement. Required element id not found: "+a);return b},setCheckboxVal:function(a,b){$(a).prop("checked",b).checkboxradio("refresh")},isObject:function(a){return a&&0!=a.length},currentTimeMillis:function(){return(new Date).getMilliseconds()},
emptyString:function(a){return!a||0==a.length},setEnablement:function(a,b,d){"undefined"===typeof d||d?c.setVisibility(a,!0):c.setVisibility(a,!1);b&&a.removeClass("ui-state-disabled");b||a.addClass("ui-state-disabled")},hookSliderChanges:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a]+"SliderChange",c=window[b];"function"!==typeof c&&alert("Function not found: "+b);if(!hookSlider("#"+arguments[a]+"Slider",c)){alert("Failed to hook slider: "+arguments[a]);break}}},hookSlider:function(a,
b){c.getRequiredElement(a).change(b);return!0},bindEnterKey:function(a,b){c.bindKey(a,b,13)},bindKey:function(a,b,c){$(a).keypress(function(a){if(a.which==c)return b(),!1})},anyEmpty:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!b||0==b.length)return!0}return!1},changeOrAddClass:function(a,b,c){a=$(a);a.toggleClass(b,!1);a.toggleClass(c,!0)},changeOrAddClass__mine:function(a,b,c){if(a.className&&0!=a.className.length){for(var d=a.className.split(" "),h="",m=!1,n=0;n<d.length;n++){var p=
d[n];if(p===c){if(m)continue;m=!0}else if(p===b){if(m)continue;p=c;m=!0}0<h.length&&(h+=" ");h+=p}m||(0<h.length&&(h+=" "),h+=c);a.className=h}else console.log("no existing className is available on element, so assigning to "+c),a.className=c},verifyType:function(a,b,c){return typeof a!==b?(alert(c),!1):!0},setHtmlEnhancedById:function(a,b){var d=c.getRequiredElement(a);d?($(d).html(b),$(d).enhanceWithin()):console.log("setting failed.")},setHtmlEnhanced:function(a,b){a.html(b);a.enhanceWithin()},
getPropertyCount:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},printObject:function(a){var b="";$.each(a,function(a,c){b+=a+" , "+c+"\n"});return b},printProperties:function(a){if(a){var b="";$.each(a,function(a,c){b+=a+"\n"});return b}console.error("printProperties recieved null.")},scrollToTop:function(){window.scrollTo(0,0)},printKeys:function(a){var b="";$.each(a,function(a,c){0<b.length&&(b+=",");b+=a});return b},setVisibility:function(a,b){b?$(a).show():$(a).hide();$(a).trigger("updatelayout")}};
console.log("Module ready: util.js");return c}();console.log("running module: view.js");
var view=function(){var d={updateStatusBar:function(){if(meta64.currentNodeData){var a="";meta64.editModeOption===meta64.MODE_ADVANCED&&(a+="count: "+meta64.currentNodeData.children.length);meta64.editMode&&(a+=" Selections: "+util.getPropertyCount(meta64.selectedNodes));var b=0<a.length;util.setVisibility("#mainNodeStatusBar",b);b&&util.setHtmlEnhanced($("#mainNodeStatusBar"),a)}},refreshTreeResponse:function(a,b,c){render.renderPageFromData(a);b&&c&&a.displayedParent?meta64.highlightRowById(b,!0):
d.scrollToSelectedNode();meta64.refreshAllGuiEnablement()},refreshTree:function(a,b){a||(a=meta64.currentNodeId);console.log("Refreshing tree: nodeId="+a);util.json("renderNode",{nodeId:a,renderParentIfLeaf:b?!0:!1}).done(function(c){d.refreshTreeResponse(c,a,b)})},refreshPage:function(){meta64.jqueryChangePage("#mainPage");view.refreshTree(null,!1)},scrollToSelectedNode:function(){setTimeout(function(){var a=nav.getSelectedDomElement();if(a){var b=meta64.getHighlightedNode(),a=0==meta64.getOrdinalOfNode(b)?
0:$("#"+a.id).offset().top-$("#mainPageHeader").height();$("html, body").animate({scrollTop:a})}},1E3)},initEditPathDisplayById:function(a){var b=edit.editNode;a=$(a);if(edit.editingUnsavedNode)a.html(""),a.hide();else{var c="Path: "+render.formatPath(b),c=c+("<br>ID: "+b.id),c=c+("<br>Modified: "+b.lastModified);a.html(c);a.show()}a.trigger("updatelayout")},showServerInfo:function(){util.json("getServerInfo",{}).done(function(a){messagePg.showMessage("Server Info",a.serverInfo,null)})}};console.log("Module ready: view.js");
return d}();
